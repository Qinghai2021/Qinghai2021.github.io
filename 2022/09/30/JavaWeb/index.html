<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>JavaWeb笔记</title><meta name="author" content="Qinghai2021"><meta name="copyright" content="Qinghai2021"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="课程体系设计 课件前端知识HTMLHTML中的基础标签 html语言是解释型语言，不是编译型浏览器是容错的  html页面中由一对标签组成：  称之为 开始标签 称之为 结束标签 title 表示网页的标题   1&lt;title&gt;这是我的第一个网页&lt;&#x2F;title&gt;  可以在meta标签中设置编码方式    表示换行 。br标签是一个单标签。单标签：开始标签和结束标签是同一个，">
<meta property="og:type" content="article">
<meta property="og:title" content="JavaWeb笔记">
<meta property="og:url" content="http://example.com/2022/09/30/JavaWeb/index.html">
<meta property="og:site_name" content="Qinghai2021·博客">
<meta property="og:description" content="课程体系设计 课件前端知识HTMLHTML中的基础标签 html语言是解释型语言，不是编译型浏览器是容错的  html页面中由一对标签组成：  称之为 开始标签 称之为 结束标签 title 表示网页的标题   1&lt;title&gt;这是我的第一个网页&lt;&#x2F;title&gt;  可以在meta标签中设置编码方式    表示换行 。br标签是一个单标签。单标签：开始标签和结束标签是同一个，">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/background.jpg">
<meta property="article:published_time" content="2022-09-29T16:00:00.000Z">
<meta property="article:modified_time" content="2022-10-05T10:59:13.056Z">
<meta property="article:author" content="Qinghai2021">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/background.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2022/09/30/JavaWeb/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":500},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Qinghai2021","link":"链接: ","source":"来源: Qinghai2021·博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://fastly.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://fastly.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'JavaWeb笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-10-05 18:59:13'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="Qinghai2021·博客" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Qinghai2021</div><div class="author-info__description">阳光宅男💛</div></div><div class="card-info-social-icons is-center"><a class="social-icon" href="//github.com/Qinghai2021?tab=repositories" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:xxxxxx@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-clock"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://www.bilibili.com/blackboard/fe/activity-HQjQSdd3L8.html"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-tools"></i><span> 工具</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://draw.xbyzs.cf"><span> Draw画布</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Qinghai2021·博客</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-clock"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://www.bilibili.com/blackboard/fe/activity-HQjQSdd3L8.html"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-tools"></i><span> 工具</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://draw.xbyzs.cf"><span> Draw画布</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">JavaWeb笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2022-09-29T16:00:00.000Z" title="发表于 2022-09-30 00:00:00">2022-09-30</time></span></div><div class="meta-secondline"></div></div></div><article class="post-content" id="article-container"><h1 id="课程体系设计"><a href="#课程体系设计" class="headerlink" title="课程体系设计"></a>课程体系设计</h1><p><img src="/2022/09/30/JavaWeb/image-20220608183738984.png" alt="image-20220608183738984"></p>
<h1 id="课件"><a href="#课件" class="headerlink" title="课件"></a>课件</h1><h1 id="前端知识"><a href="#前端知识" class="headerlink" title="前端知识"></a>前端知识</h1><h2 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h2><h3 id="HTML中的基础标签"><a href="#HTML中的基础标签" class="headerlink" title="HTML中的基础标签"></a>HTML中的基础标签</h3><ol>
<li><p>html语言是解释型语言，不是编译型<br>浏览器是容错的</p>
</li>
<li><p>html页面中由一对标签组成：<html></html></p>
<html> 称之为 开始标签
</html>称之为 结束标签</li>
<li><p>title 表示网页的标题</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;title&gt;这是我的第一个网页&lt;/title&gt;</span><br></pre></td></tr></table></figure>

<p>可以在meta标签中设置编码方式</p>
<meta charset="UTF-8">

<ol start="5">
<li><br>表示换行 。br标签是一个单标签。单标签：开始标签和结束标签是同一个，斜杠放在单词后面</li>
<li>p 表示段落标签</li>
<li>img 标签图片标签<br>  src属性表示图片文件的路径<br>  width和height表示图片的大小<br>  alt表示图片的提示</li>
<li>路径的问题：<ol>
<li>相对路径</li>
<li>绝对路径</li>
</ol>
</li>
<li>h1~h6 : 标题标签</li>
<li>列表标签:</li>
</ol>
<ul>
<li><p>ol 有序列表<br>  start 表示从*开始，type 显示的类型：A a I i 1(deafult)</p>
  <ol type="a" start="3">
              <li>扫地僧</li>
              <li>萧远山</li>
              <li>慕容博</li>
              <li>虚竹</li>
              <li>阿紫</li>
          </ol>
  </li>
<li><p>ul 无序列表<br>  type disc(default) , circle , square</p>
  <ul type="circle">
              <li>乔峰</li>
              <li>阿朱</li>
              <li>马夫人</li>
              <li>白世镜</li>
          </ul></li>
</ul>
<ol start="11">
<li><p>u 下划线 b 粗体  i 斜体</p>
<p>你是<b><i><u>喜欢</u></i></b>是<b>甜</b>月饼还是<i>咸</i><u>月饼</u>？</p>
</li>
<li><p>上标 sup   下标 sub</p>
<p>水分子的化学式： H<sub>2</sub>O<br>    氧气的化学式： O<sup>2</sup></p>
</li>
<li><p>HTML中的实体： 小于号 &amp;lt ; 大于等于号 &amp;ge ;  版权 &amp;copy ;</p>
</li>
<li><p>span 不换行的块标记</p>
</li>
</ol>
<ol start="15">
<li>a 表示超链接</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">href 链接的地址</span><br><span class="line">target:</span><br><span class="line">	_self 在本窗口打开</span><br><span class="line">	_blank 在一个新窗口打开</span><br><span class="line">	_parent 在父窗口打开</span><br><span class="line">	_top  在顶层窗口打开</span><br></pre></td></tr></table></figure>

<ol start="16">
<li><p>div  块级标签，会独占一行</p>
</li>
<li><p>表格	table<br>行		tr<br>列		td<br>表头列	th</p>
<p>table中有如下属性（虽然已经淘汰，但是最好了解一下）</p>
<ul>
<li>border：表格边框的粗细</li>
<li>width:表格的宽度</li>
<li>cellspacing：单元格间距</li>
<li>cellpadding：单元格填充</li>
</ul>
<p>tr中有一个属性： align -&gt; center , left , right </p>
<p>rowspan : 行合并<br>colspan : 列合并</p>
</li>
</ol>
<table border="1" width="600" cellspacing="0" cellpadding="4">
            <tr align="center">
                <th>姓名</th>
                <th>门派</th>
                <th>成名绝技</th>
                <th>内功值</th>
            </tr>
            <tr align="center">
                <td>乔峰</td>
                <td>丐帮</td>
                <td>少林长拳</td>
                <td>5000</td>
            </tr>
            <tr align="center">
                <td>虚竹</td>
                <td>灵鹫宫</td>
                <td>北冥神功</td>
                <td>15000</td>
            </tr>
            <tr align="center">
                <td>扫地僧</td>
                <td>少林寺</td>
                <td>七十二绝技</td>
                <td>未知</td>
            </tr>
        </table>

<table border="1" cellspacing="0" cellpadding="4" width="600">
            <tr>
                <th>名称</th>
                <th>单价</th>
                <th>数量</th>
                <th>小计</th>
                <th>操作</th>
            </tr>
            <tr align="center">
                <td>苹果</td>
                <td rowspan="2">5</td>
                <td>20</td>
                <td>100</td>
                <td><img src="/2022/09/30/JavaWeb/Learn_data\javaweb\代码素材资料\Day1-HTML\代码\02.HTML\imgs/del.jpg" width="24" height="24"></td>
            </tr>
            <tr align="center">
                <td>菠萝</td>
                <td>15</td>
                <td>45</td>
                <td><img src="/2022/09/30/JavaWeb/Learn_data\javaweb\代码素材资料\Day1-HTML\代码\02.HTML\imgs/del.jpg" width="24" height="24"></td>
            </tr>
            <tr align="center">
                <td>西瓜</td>
                <td>6</td>
                <td>6</td>
                <td>36</td>
                <td><img src="/2022/09/30/JavaWeb/Learn_data\javaweb\代码素材资料\Day1-HTML\代码\02.HTML\imgs/del.jpg" width="24" height="24"></td>
            </tr>
            <tr align="center">
                <td>总计</td>
                <td colspan="4">181</td>
            </tr>
        </table>



<ol start="18">
<li><p>表单	form</p>
<p>action：提交表单的目的地址</p>
<p>method：发送http使用的方法</p>
</li>
</ol>
<ol start="19">
<li><p>input type&#x3D;”text” 表示文本框 ， 其中 name属性必须要指定，否则这个文本框的数据将来是不会发送给服务器的<br>input type&#x3D;”password” 表示密码框<br>input type&#x3D;”radio” 表示单选按钮。需要注意的是，name属性值保持一致，这样才会有互斥的效果;可<strong>以通过checked属性设置默认选中的项</strong></p>
<blockquote>
<p>注意：属性名和属性值相同可以只写属性名</p>
</blockquote>
<p>input type&#x3D;”checkbox” 表示复选框。name属性值建议保持一致，这样将来我们服务器端获取值的时候获取的是一个数组<br>select 表示下拉列表。每一个选项是option，其中value属性是发送给服务器的值 , <strong>selected表示默认选中的项</strong><br>textarea 表示多行文本框（或者称之为文本域）,它的value值就是开始结束标签之间的内容<br>input type&#x3D;”submit” 表示提交按钮<br>input type&#x3D;”reset” 表示重置按钮<br>input type&#x3D;”button” 表示普通按钮</p>
</li>
</ol>
<form action="demo04.html" method="post"> 
            昵称：<input type="text" value="请输入你的昵称"><br>
            密码：<input type="password" name="pwd"><br>
            性别：<input type="radio" name="gender" value="male">男
      			  <input type="radio" name="gender" value="female" checked>女<br>
            爱好：<input type="checkbox" name="hobby" value="basketball">篮球
                  <input type="checkbox" name="hobby" value="football" checked>足球
                  <input type="checkbox" name="hobby" value="earth" checked>地球<br>
            星座：<select name="star">
                    <option value="1">白羊座</option>
                    <option value="2" selected>金牛座</option>
                    <option value="3">双子座</option>
                    <option value="4">天蝎座</option>
                    <option value="5">天秤座</option>
                  </select><br>
            备注：<textarea name="remark" rows="4" cols="50"></textarea><br>
            <input type="submit" value=" 注 册 ">
            <input type="reset" value="重置">
            <input type="button" value="这是一个普通按钮">
        </form>



<ol start="20">
<li><p>frameset 表示页面框架 ， 这个标签已经淘汰，了解，不需要掌握<br>frame表示框架中的具体页面引用</p>
<p>iframe 在一个页面嵌入一个子页面</p>
</li>
</ol>
<h2 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h2><h3 id="CSS的语法"><a href="#CSS的语法" class="headerlink" title="CSS的语法"></a>CSS的语法</h3><ol>
<li><p>为什么需要CSS</p>
<p>标签样式的太多，一个个写在标签上过于麻烦，冗余。</p>
</li>
<li><p>CSS的最基本的分类: 标签样式表、类样式表、ID样式表</p>
<p>标签样式表–以标签名作为名字</p>
<p>p{<br>            color:red;<br>        }<br>类样式表—“.”开头，匹配标签中属性class名为f20的</p>
<p>.f20{<br>            font-size:20px;<br>        }<br>ID样式表—-“#”号开头，匹配标签属性id名为p4的</p>
<p>#p4{<br>background-color:pink;<br>font-size:24px;<br>font-weight:bolder;<br>font-style:italic;<br>​			}</p>
<blockquote>
<p>id属性在整个HTML文档中，尽量保持唯一（虽然重复也不会报错）</p>
</blockquote>
<p>组合样式—某标签下的子标签</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> <span class="selector-tag">p</span>&#123;</span><br><span class="line">	<span class="attribute">color</span>:blue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span> <span class="selector-class">.f32</span>&#123;</span><br><span class="line">	<span class="attribute">font-size</span>:<span class="number">32px</span>;</span><br><span class="line">	<span class="attribute">font-family</span>:<span class="string">&quot;黑体&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>CSS从位置上的分类：嵌入式样式表、内部样式表、外部样式表</p>
</li>
</ol>
<p>嵌入式样式表—-嵌套在在标签内的样式</p>
<p><span style="font-size:60px;font-weight:bolder;color:yellow;">HELLO</span></p>

<p>内部样式表—即写在当前html文件中的</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">		<span class="comment">/* 被style标签包围的范围是CSS环境，可以写CSS代码 */</span></span><br><span class="line">		<span class="comment">/* 标签样式表 */</span></span><br><span class="line">		<span class="selector-tag">p</span>&#123;</span><br><span class="line">			<span class="attribute">color</span>:red;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* 类样式 */</span></span><br><span class="line">		<span class="selector-class">.f20</span>&#123;</span><br><span class="line">			<span class="attribute">font-size</span>:<span class="number">20px</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>外部样式表—-引入外部的样式表文件，文件以.css结尾</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引用外部的CSS样式表文件 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/demo01.css&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h3 id="盒子模型"><a href="#盒子模型" class="headerlink" title="盒子模型"></a>盒子模型</h3><p>IE浏览器：实际尺寸 &#x3D; width<br>chrome浏览器：实际尺寸&#x3D; width+左右borderwidth+padding</p>
<p>CSS盒子模型：<br>1.border 边框</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 1. border 边框样式 */</span></span><br><span class="line">				<span class="attribute">border-width</span>:<span class="number">1px</span>;			<span class="comment">/*边框粗细*/</span></span><br><span class="line">				<span class="attribute">border-style</span>:solid;		<span class="comment">/*边框样式：solid(实线) , dotted(点状线) ... */</span></span><br><span class="line">				<span class="attribute">border-color</span>:blue;			<span class="comment">/*边框颜色*/</span></span><br><span class="line">			<span class="comment">/* border:4px double blue;*/</span>  可合并</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* border-top : 4px dotted blue;*/</span></span><br></pre></td></tr></table></figure>



<p>2.margin 间距，是外边距，即盒子与盒子之间的距离	</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">margin-top</span>:<span class="number">100px</span>;<span class="comment">/*盒子与盒子之间的距离*/</span></span><br><span class="line"><span class="attribute">margin-left</span>:<span class="number">100px</span>;	</span><br><span class="line"><span class="comment">/*margin:100px 100px 50px 150px;*/</span> </span><br></pre></td></tr></table></figure>

<blockquote>
<p> 一个值，四个方向统一；两个值：上下、左右；三个值：上、左右、下；四个值：上右下左 </p>
</blockquote>
<p>3.padding 填充，是内边距，是盒子的边与盒子内部元素的距离</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* padding : 填充 */</span></span><br><span class="line">				<span class="attribute">padding-top</span>:<span class="number">50px</span>;  <span class="comment">/*本标签从顶部边框向内填充*/</span></span><br><span class="line">				<span class="attribute">padding-left</span>:<span class="number">50px</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>margin是用来隔开元素与元素的间距；padding是用来隔开元素与内容的间隔。margin使元素与元素互不相干；padding让内容（文字）与（包裹）元素之间有一段“呼吸距离”。</p>
</blockquote>
<p>补充：浏览器与盒子之间初始时会有微小间隔，可以通过body进行修改</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span>&#123;</span><br><span class="line">			<span class="attribute">margin</span>:<span class="number">0</span>;</span><br><span class="line">			<span class="attribute">padding</span>:<span class="number">0</span>;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>



<h3 id="CSS布局"><a href="#CSS布局" class="headerlink" title="CSS布局"></a>CSS布局</h3><p>position: absolute – 绝对定位 , 需要配合使用 left , top<br>relative – 相对定位 , 一般会和 float , margin , padding …. 一起使用</p>
<p>浮动可以理解为让某个div元素脱离标准流，漂浮在标准流之上，和标准流不是⼀个层次。</p>
<p>float 有left左浮动和right右浮动，默认是none不浮动</p>
<p><a target="_blank" rel="noopener" href="https://wenku.baidu.com/view/f7786fa780d049649b6648d7c1c708a1284a0ada.html">（图文详细）最通俗易懂的CSS浮动float属性详解 - 百度文库 (baidu.com)</a></p>
<h2 id="javascript"><a href="#javascript" class="headerlink" title="javascript"></a>javascript</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>Javascript : 客户端的一个脚本语言<br>js是一门弱类型的语言 , 变量的数据类型由后面赋的值的类型决定</p>
<p>有独立标签，javascript代码写入其中</p>
<script language="javascript"> </script>

<h3 id="JavaScript数据类型"><a href="#JavaScript数据类型" class="headerlink" title="JavaScript数据类型"></a>JavaScript数据类型</h3><ul>
<li><p>基本数据类型</p>
<ul>
<li><p>数值型：JavaScript不区分整数、小数</p>
</li>
<li><p>字符串：JavaScript不区分字符、字符串；单引号、双引号意思一样。</p>
</li>
<li><p>布尔型：true、false</p>
<p>在JavaScript中，其他类型和布尔类型的自动转换。</p>
<p>true：非零的数值，非空字符串，非空对象</p>
<p>false：零，空字符串，null，undefined</p>
<p>例如：”false”放在if判断中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &quot;false&quot;是一个非空字符串，直接放在if判断中会被当作『真』处理</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&quot;false&quot;</span>)&#123;</span><br><span class="line">	<span class="title function_">alert</span>(<span class="string">&quot;true&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="title function_">alert</span>(<span class="string">&quot;false&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>引用类型</p>
<ul>
<li><p>所有new出来的对象</p>
</li>
<li><p>用[]声明的数组</p>
</li>
<li><p>用{}声明的对象</p>
<pre><code>var str = &quot;hello world&quot;;  类型名称var匹配任意类型
    alert(typeof str);
    str= 9999 ;
    alert(typeof str);   //typeof str返回类型名称 //alter()警告框
var person = new Object();  //
    person.pid = &quot;p001&quot;;
    person.pname=&quot;鸠摩智&quot;;
    alert(person.pid+&quot;_&quot;+person.pname);
</code></pre>
</li>
</ul>
</li>
</ul>
<h3 id="函数声明"><a href="#函数声明" class="headerlink" title="函数声明"></a>函数声明</h3><p>相较于java灵活，约束少</p>
<p>一个函数可以有或没有返回值，取决于写不写，形参和实参没有具体类型和个数限制。从左往右一次赋值</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">	</span><br><span class="line">//java 方法</span><br><span class="line">public String hello(String name)&#123;</span><br><span class="line">	return &quot;hello to &quot; + name ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//js 方法</span><br><span class="line">function hello(num1 , num2 , name)&#123;</span><br><span class="line">	if(num1&gt;num2)&#123;</span><br><span class="line">		return &quot;hello to&quot; + name ;</span><br><span class="line">	&#125;else&#123;</span><br><span class="line">		alert(&quot;HELLO&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="鼠标悬浮和离开"><a href="#鼠标悬浮和离开" class="headerlink" title="鼠标悬浮和离开"></a>鼠标悬浮和离开</h3><h4 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h4><p>在此方法中调用JavaScript方法需要在html标签中显式的调用</p>
<p>html代码</p>
<div id="div_container">
            <div id="div_fruit_list">
                <table id="tbl_fruit">
                    <tr>
                        <th class="w20">名称</th>
                        <th class="w20">单价</th>
                        <th class="w20">数量</th>
                        <th class="w20">小计</th>
                        <th>操作</th>
                    </tr>
                    <tr onmouseover="showBGColor()" onmouseout="clearBGColor()">
                        <td>苹果</td>
                        <td onmouseover="showHand()">5</td>
                        <td>20</td>
                        <td>100</td>
                        <td><img src="/2022/09/30/JavaWeb/del.jpg" class="delImg"></td>
                    </tr>
                    <tr onmouseover="showBGColor()" onmouseout="clearBGColor()">
                        <td>西瓜</td>
                        <td onmouseover="showHand()">3</td>
                        <td>20</td>
                        <td>60</td>
                        <td><img src="/2022/09/30/JavaWeb/del.jpg" class="delImg"></td>
                    </tr>
                    <tr onmouseover="showBGColor()" onmouseout="clearBGColor()">
                        <td>菠萝</td>
                        <td onmouseover="showHand()">4</td>
                        <td>25</td>
                        <td>100</td>
                        <td><img src="/2022/09/30/JavaWeb/del.jpg" class="delImg"></td>
                    </tr>
                    <tr onmouseover="showBGColor()" onmouseout="clearBGColor()">
                        <td>榴莲</td>
                        <td onmouseover="showHand()">3</td>
                        <td>30</td>
                        <td>90</td>
                        <td><img src="/2022/09/30/JavaWeb/del.jpg" class="delImg"></td>
                    </tr>
                    <tr>
                        <td>总计</td>
                        <td colspan="4">999</td>
                    </tr>
                </table>
            </div>
        </div>

<p>对应javascript代码，在此方法中调用JavaScript方法需要在html标签中显式的调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//当鼠标悬浮时，显示背景颜色</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showBGColor</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="comment">//event : 当前发生的事件</span></span><br><span class="line">	<span class="comment">//event.srcElement : 事件源</span></span><br><span class="line">	<span class="comment">//alert(event.srcElement);</span></span><br><span class="line">	<span class="comment">//alert(event.srcElement.tagName);	--&gt; TD</span></span><br><span class="line">	<span class="keyword">if</span>(event &amp;&amp; event.<span class="property">srcElement</span> &amp;&amp; event.<span class="property">srcElement</span>.<span class="property">tagName</span>==<span class="string">&quot;TD&quot;</span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> td = event.<span class="property">srcElement</span> ;</span><br><span class="line">		<span class="comment">//td.parentElement 表示获取td的父元素 -&gt; TR</span></span><br><span class="line">		<span class="keyword">var</span> tr = td.<span class="property">parentElement</span> ;</span><br><span class="line">		<span class="comment">//如果想要通过js代码设置某节点的样式，则需要加上 .style</span></span><br><span class="line">		tr.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="string">&quot;navy&quot;</span> ;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//tr.cells表示获取这个tr中的所有的单元格</span></span><br><span class="line">		<span class="keyword">var</span> tds = tr.<span class="property">cells</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i&lt;tds.<span class="property">length</span> ; i++)&#123;</span><br><span class="line">			tds[i].<span class="property">style</span>.<span class="property">color</span>=<span class="string">&quot;white&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//当鼠标离开时，恢复原始样式</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">clearBGColor</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(event &amp;&amp; event.<span class="property">srcElement</span> &amp;&amp; event.<span class="property">srcElement</span>.<span class="property">tagName</span>==<span class="string">&quot;TD&quot;</span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> td = event.<span class="property">srcElement</span> ;</span><br><span class="line">		<span class="keyword">var</span> tr = td.<span class="property">parentElement</span> ;</span><br><span class="line">		tr.<span class="property">style</span>.<span class="property">backgroundColor</span>=<span class="string">&quot;transparent&quot;</span>;</span><br><span class="line">		<span class="keyword">var</span> tds = tr.<span class="property">cells</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i&lt;tds.<span class="property">length</span> ; i++)&#123;</span><br><span class="line">			tds[i].<span class="property">style</span>.<span class="property">color</span>=<span class="string">&quot;threeddarkshadow&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//当鼠标悬浮在单价单元格时，显示手势</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showHand</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(event &amp;&amp; event.<span class="property">srcElement</span> &amp;&amp; event.<span class="property">srcElement</span>.<span class="property">tagName</span>==<span class="string">&quot;TD&quot;</span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> td = event.<span class="property">srcElement</span> ;</span><br><span class="line">		<span class="comment">//cursor : 光标</span></span><br><span class="line">		td.<span class="property">style</span>.<span class="property">cursor</span>=<span class="string">&quot;hand&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h4><p>此方法无需在html代码标签中显式调用，使代码变得简洁</p>
<p>html<strong>代码</strong></p>
<div id="div_container">
            <div id="div_fruit_list">
                <table id="tbl_fruit">
                    <tr>
                        <th class="w20">名称</th>
                        <th class="w20">单价</th>
                        <th class="w20">数量</th>
                        <th class="w20">小计</th>
                        <th>操作</th>
                    </tr>
                    <tr>
                        <td>苹果</td>
                        <td>5</td>
                        <td>20</td>
                        <td>100</td>
                        <td><img src="/2022/09/30/JavaWeb/del.jpg" class="delImg"></td>
                    </tr>
                    <tr>	
                        <td>西瓜</td>
                        <td>3</td>
                        <td>20</td>
                        <td>60</td>
                        <td><img src="/2022/09/30/JavaWeb/del.jpg" class="delImg"></td>
                    </tr>
                    <tr>
                        <td>菠萝</td>
                        <td>4</td>
                        <td>25</td>
                        <td>100</td>
                        <td><img src="/2022/09/30/JavaWeb/del.jpg" class="delImg"></td>
                    </tr>
                    <tr>
                        <td>榴莲</td>
                        <td>3</td>
                        <td>30</td>
                        <td>90</td>
                        <td><img src="/2022/09/30/JavaWeb/del.jpg" class="delImg"></td>
                    </tr>
                    <tr>
                        <td>总计</td>
                        <td colspan="4">999</td>
                    </tr>
                </table>
            </div>
        </div>

<p>JavaScript<strong>代码</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">onload</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="comment">//当页面加载完成，我们需要绑定各种事件</span></span><br><span class="line">	<span class="comment">//根据id获取到表格</span></span><br><span class="line">	<span class="keyword">var</span> fruitTbl =  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;tbl_fruit&quot;</span>);</span><br><span class="line">	<span class="comment">//获取表格中的所有的行</span></span><br><span class="line">	<span class="keyword">var</span> rows = fruitTbl.<span class="property">rows</span> ;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">1</span> ; i&lt;rows.<span class="property">length</span>-<span class="number">1</span> ; i++)&#123;</span><br><span class="line">		<span class="keyword">var</span> tr = rows[i];</span><br><span class="line">		<span class="comment">//1.绑定鼠标悬浮以及离开时设置背景颜色事件</span></span><br><span class="line">		tr.<span class="property">onmouseover</span>=showBGColor; <span class="comment">//这里调用不用加()</span></span><br><span class="line">		tr.<span class="property">onmouseout</span>=clearBGColor;</span><br><span class="line">		<span class="comment">//获取tr这一行的所有单元格</span></span><br><span class="line">		<span class="keyword">var</span> cells = tr.<span class="property">cells</span>;</span><br><span class="line">		<span class="keyword">var</span> priceTD = cells[<span class="number">1</span>]; </span><br><span class="line">		<span class="comment">//2.绑定鼠标悬浮在单价单元格变手势的事件</span></span><br><span class="line">		priceTD.<span class="property">onmouseover</span> = showHand ;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//当鼠标悬浮时，显示背景颜色</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showBGColor</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="comment">//event : 当前发生的事件</span></span><br><span class="line">	<span class="comment">//event.srcElement : 事件源</span></span><br><span class="line">	<span class="comment">//alert(event.srcElement);</span></span><br><span class="line">	<span class="comment">//alert(event.srcElement.tagName);	--&gt; TD</span></span><br><span class="line">	<span class="keyword">if</span>(event &amp;&amp; event.<span class="property">srcElement</span> &amp;&amp; event.<span class="property">srcElement</span>.<span class="property">tagName</span>==<span class="string">&quot;TD&quot;</span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> td = event.<span class="property">srcElement</span> ;</span><br><span class="line">		<span class="comment">//td.parentElement 表示获取td的父元素 -&gt; TR</span></span><br><span class="line">		<span class="keyword">var</span> tr = td.<span class="property">parentElement</span> ;</span><br><span class="line">		<span class="comment">//如果想要通过js代码设置某节点的样式，则需要加上 .style</span></span><br><span class="line">		tr.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="string">&quot;navy&quot;</span> ;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//tr.cells表示获取这个tr中的所有的单元格</span></span><br><span class="line">		<span class="keyword">var</span> tds = tr.<span class="property">cells</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i&lt;tds.<span class="property">length</span> ; i++)&#123;</span><br><span class="line">			tds[i].<span class="property">style</span>.<span class="property">color</span>=<span class="string">&quot;white&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//当鼠标离开时，恢复原始样式</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">clearBGColor</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(event &amp;&amp; event.<span class="property">srcElement</span> &amp;&amp; event.<span class="property">srcElement</span>.<span class="property">tagName</span>==<span class="string">&quot;TD&quot;</span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> td = event.<span class="property">srcElement</span> ;</span><br><span class="line">		<span class="keyword">var</span> tr = td.<span class="property">parentElement</span> ;</span><br><span class="line">		tr.<span class="property">style</span>.<span class="property">backgroundColor</span>=<span class="string">&quot;transparent&quot;</span>;</span><br><span class="line">		<span class="keyword">var</span> tds = tr.<span class="property">cells</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i&lt;tds.<span class="property">length</span> ; i++)&#123;</span><br><span class="line">			tds[i].<span class="property">style</span>.<span class="property">color</span>=<span class="string">&quot;threeddarkshadow&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//当鼠标悬浮在单价单元格时，显示手势</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showHand</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(event &amp;&amp; event.<span class="property">srcElement</span> &amp;&amp; event.<span class="property">srcElement</span>.<span class="property">tagName</span>==<span class="string">&quot;TD&quot;</span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> td = event.<span class="property">srcElement</span> ;</span><br><span class="line">		<span class="comment">//cursor : 光标</span></span><br><span class="line">		td.<span class="property">style</span>.<span class="property">cursor</span>=<span class="string">&quot;hand&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="更新单价-小计-总计"><a href="#更新单价-小计-总计" class="headerlink" title="更新单价-小计-总计"></a>更新单价-小计-总计</h4><p>html代码同上</p>
<p>JavaScript代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">onload</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="title function_">updateZJ</span>();</span><br><span class="line">	<span class="comment">//当页面加载完成，我们需要绑定各种事件</span></span><br><span class="line">	<span class="comment">//根据id获取到表格</span></span><br><span class="line">	<span class="keyword">var</span> fruitTbl =  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;tbl_fruit&quot;</span>);</span><br><span class="line">	<span class="comment">//获取表格中的所有的行</span></span><br><span class="line">	<span class="keyword">var</span> rows = fruitTbl.<span class="property">rows</span> ;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">1</span> ; i&lt;rows.<span class="property">length</span>-<span class="number">1</span> ; i++)&#123;</span><br><span class="line">		<span class="keyword">var</span> tr = rows[i];</span><br><span class="line">		<span class="comment">//1.绑定鼠标悬浮以及离开时设置背景颜色事件</span></span><br><span class="line">		tr.<span class="property">onmouseover</span>=showBGColor;</span><br><span class="line">		tr.<span class="property">onmouseout</span>=clearBGColor;</span><br><span class="line">		<span class="comment">//获取tr这一行的所有单元格</span></span><br><span class="line">		<span class="keyword">var</span> cells = tr.<span class="property">cells</span>;</span><br><span class="line">		<span class="keyword">var</span> priceTD = cells[<span class="number">1</span>];</span><br><span class="line">		<span class="comment">//2.绑定鼠标悬浮在单价单元格变手势的事件</span></span><br><span class="line">		priceTD.<span class="property">onmouseover</span> = showHand ;</span><br><span class="line">		<span class="comment">//3.绑定鼠标点击单价单元格的事件</span></span><br><span class="line">		priceTD.<span class="property">onclick</span>=editPrice;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//当鼠标点击单价单元格时进行价格编辑</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">editPrice</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(event &amp;&amp; event.<span class="property">srcElement</span> &amp;&amp; event.<span class="property">srcElement</span>.<span class="property">tagName</span>==<span class="string">&quot;TD&quot;</span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> priceTD = event.<span class="property">srcElement</span> ;</span><br><span class="line">		<span class="comment">//目的是判断当前priceTD有子节点，而且第一个子节点是文本节点 ， TextNode对应的是3  ElementNode对应的是1</span></span><br><span class="line">		<span class="keyword">if</span>(priceTD.<span class="property">firstChild</span> &amp;&amp; priceTD.<span class="property">firstChild</span>.<span class="property">nodeType</span>==<span class="number">3</span>)&#123;</span><br><span class="line">			<span class="comment">//innerText 表示设置或者获取当前节点的内部文本</span></span><br><span class="line">			<span class="keyword">var</span> oldPrice = priceTD.<span class="property">innerText</span> ;</span><br><span class="line">			<span class="comment">//innerHTML 表示设置当前节点的内部HTML</span></span><br><span class="line">			priceTD.<span class="property">innerHTML</span>=<span class="string">&quot;&lt;input type=&#x27;text&#x27; size=&#x27;4&#x27;/&gt;&quot;</span>;</span><br><span class="line">			<span class="comment">// &lt;td&gt;&lt;input type=&#x27;text&#x27; size=&#x27;4&#x27;/&gt;&lt;/td&gt;</span></span><br><span class="line">			<span class="keyword">var</span> input = priceTD.<span class="property">firstChild</span>;</span><br><span class="line">			<span class="keyword">if</span>(input.<span class="property">tagName</span>==<span class="string">&quot;INPUT&quot;</span>)&#123;</span><br><span class="line">				input.<span class="property">value</span> = oldPrice ;</span><br><span class="line">				<span class="comment">//选中输入框内部的文本</span></span><br><span class="line">				input.<span class="title function_">select</span>();</span><br><span class="line">				<span class="comment">//4.绑定输入框失去焦点事件 , 失去焦点，更新单价</span></span><br><span class="line">				input.<span class="property">onblur</span>=updatePrice ;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updatePrice</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(event &amp;&amp; event.<span class="property">srcElement</span> &amp;&amp; event.<span class="property">srcElement</span>.<span class="property">tagName</span>==<span class="string">&quot;INPUT&quot;</span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> input = event.<span class="property">srcElement</span> ;</span><br><span class="line">		<span class="keyword">var</span> newPrice = input.<span class="property">value</span> ;</span><br><span class="line">		<span class="comment">//input节点的父节点是td</span></span><br><span class="line">		<span class="keyword">var</span> priceTD = input.<span class="property">parentElement</span> ;</span><br><span class="line">		priceTD.<span class="property">innerText</span> = newPrice ;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//更新当前行的小计这一个格子的值</span></span><br><span class="line">		<span class="comment">//priceTD.parentElement td的父元素是tr</span></span><br><span class="line">		<span class="title function_">updateXJ</span>(priceTD.<span class="property">parentElement</span>);</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//更新指定行的小计</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateXJ</span>(<span class="params">tr</span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(tr &amp;&amp; tr.<span class="property">tagName</span>==<span class="string">&quot;TR&quot;</span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> tds = tr.<span class="property">cells</span>;</span><br><span class="line">		<span class="keyword">var</span> price = tds[<span class="number">1</span>].<span class="property">innerText</span> ;</span><br><span class="line">		<span class="keyword">var</span> count = tds[<span class="number">2</span>].<span class="property">innerText</span> ;</span><br><span class="line">		<span class="comment">//innerText获取到的值的类型是字符串类型，因此需要类型转换，才能进行数学运算</span></span><br><span class="line">		<span class="keyword">var</span> xj = <span class="built_in">parseInt</span>(price) * <span class="built_in">parseInt</span>(count);</span><br><span class="line">		tds[<span class="number">3</span>].<span class="property">innerText</span> = xj ;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//更新总计</span></span><br><span class="line">		<span class="title function_">updateZJ</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//更新总计</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateZJ</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="keyword">var</span> fruitTbl = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;tbl_fruit&quot;</span>);</span><br><span class="line">	<span class="keyword">var</span> rows = fruitTbl.<span class="property">rows</span> ;</span><br><span class="line">	<span class="keyword">var</span> sum = <span class="number">0</span> ;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">1</span>; i&lt;rows.<span class="property">length</span>-<span class="number">1</span> ; i++)&#123;</span><br><span class="line">		<span class="keyword">var</span> tr = rows[i];</span><br><span class="line">		<span class="keyword">var</span> xj = <span class="built_in">parseInt</span>(tr.<span class="property">cells</span>[<span class="number">3</span>].<span class="property">innerText</span>);		<span class="comment">//NaN    not a number 不是一个数字</span></span><br><span class="line">		sum = sum + xj ;</span><br><span class="line">	&#125;</span><br><span class="line">	rows[rows.<span class="property">length</span>-<span class="number">1</span>].<span class="property">cells</span>[<span class="number">1</span>].<span class="property">innerText</span> = sum ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//当鼠标悬浮时，显示背景颜色</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showBGColor</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="comment">//event : 当前发生的事件</span></span><br><span class="line">	<span class="comment">//event.srcElement : 事件源</span></span><br><span class="line">	<span class="comment">//alert(event.srcElement);</span></span><br><span class="line">	<span class="comment">//alert(event.srcElement.tagName);	--&gt; TD</span></span><br><span class="line">	<span class="keyword">if</span>(event &amp;&amp; event.<span class="property">srcElement</span> &amp;&amp; event.<span class="property">srcElement</span>.<span class="property">tagName</span>==<span class="string">&quot;TD&quot;</span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> td = event.<span class="property">srcElement</span> ;</span><br><span class="line">		<span class="comment">//td.parentElement 表示获取td的父元素 -&gt; TR</span></span><br><span class="line">		<span class="keyword">var</span> tr = td.<span class="property">parentElement</span> ;</span><br><span class="line">		<span class="comment">//如果想要通过js代码设置某节点的样式，则需要加上 .style</span></span><br><span class="line">		tr.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="string">&quot;navy&quot;</span> ;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//tr.cells表示获取这个tr中的所有的单元格</span></span><br><span class="line">		<span class="keyword">var</span> tds = tr.<span class="property">cells</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i&lt;tds.<span class="property">length</span> ; i++)&#123;</span><br><span class="line">			tds[i].<span class="property">style</span>.<span class="property">color</span>=<span class="string">&quot;white&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//当鼠标离开时，恢复原始样式</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">clearBGColor</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(event &amp;&amp; event.<span class="property">srcElement</span> &amp;&amp; event.<span class="property">srcElement</span>.<span class="property">tagName</span>==<span class="string">&quot;TD&quot;</span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> td = event.<span class="property">srcElement</span> ;</span><br><span class="line">		<span class="keyword">var</span> tr = td.<span class="property">parentElement</span> ;</span><br><span class="line">		tr.<span class="property">style</span>.<span class="property">backgroundColor</span>=<span class="string">&quot;transparent&quot;</span>;</span><br><span class="line">		<span class="keyword">var</span> tds = tr.<span class="property">cells</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i&lt;tds.<span class="property">length</span> ; i++)&#123;</span><br><span class="line">			tds[i].<span class="property">style</span>.<span class="property">color</span>=<span class="string">&quot;threeddarkshadow&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//当鼠标悬浮在单价单元格时，显示手势</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showHand</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(event &amp;&amp; event.<span class="property">srcElement</span> &amp;&amp; event.<span class="property">srcElement</span>.<span class="property">tagName</span>==<span class="string">&quot;TD&quot;</span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> td = event.<span class="property">srcElement</span> ;</span><br><span class="line">		<span class="comment">//cursor : 光标</span></span><br><span class="line">		td.<span class="property">style</span>.<span class="property">cursor</span>=<span class="string">&quot;hand&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="删除指定行和控制键盘的输入"><a href="#删除指定行和控制键盘的输入" class="headerlink" title="删除指定行和控制键盘的输入"></a>删除指定行和控制键盘的输入</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">onload</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="title function_">updateZJ</span>();</span><br><span class="line">	<span class="comment">//当页面加载完成，我们需要绑定各种事件</span></span><br><span class="line">	<span class="comment">//根据id获取到表格</span></span><br><span class="line">	<span class="keyword">var</span> fruitTbl =  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;tbl_fruit&quot;</span>);</span><br><span class="line">	<span class="comment">//获取表格中的所有的行</span></span><br><span class="line">	<span class="keyword">var</span> rows = fruitTbl.<span class="property">rows</span> ;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">1</span> ; i&lt;rows.<span class="property">length</span>-<span class="number">1</span> ; i++)&#123;</span><br><span class="line">		<span class="keyword">var</span> tr = rows[i];</span><br><span class="line">		<span class="comment">//1.绑定鼠标悬浮以及离开时设置背景颜色事件</span></span><br><span class="line">		tr.<span class="property">onmouseover</span>=showBGColor;</span><br><span class="line">		tr.<span class="property">onmouseout</span>=clearBGColor;</span><br><span class="line">		<span class="comment">//获取tr这一行的所有单元格</span></span><br><span class="line">		<span class="keyword">var</span> cells = tr.<span class="property">cells</span>;</span><br><span class="line">		<span class="keyword">var</span> priceTD = cells[<span class="number">1</span>];</span><br><span class="line">		<span class="comment">//2.绑定鼠标悬浮在单价单元格变手势的事件</span></span><br><span class="line">		priceTD.<span class="property">onmouseover</span> = showHand ;</span><br><span class="line">		<span class="comment">//3.绑定鼠标点击单价单元格的事件</span></span><br><span class="line">		priceTD.<span class="property">onclick</span>=editPrice;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="comment">//7.绑定删除小图标的点击事件</span></span><br><span class="line">		<span class="keyword">var</span> img = cells[<span class="number">4</span>].<span class="property">firstChild</span>;</span><br><span class="line">		<span class="keyword">if</span>(img &amp;&amp; img.<span class="property">tagName</span>==<span class="string">&quot;IMG&quot;</span>)&#123;</span><br><span class="line">			<span class="comment">//绑定单击事件</span></span><br><span class="line">			img.<span class="property">onclick</span> = delFruit ;</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">delFruit</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(event &amp;&amp; event.<span class="property">srcElement</span> &amp;&amp; event.<span class="property">srcElement</span>.<span class="property">tagName</span>==<span class="string">&quot;IMG&quot;</span>)&#123;</span><br><span class="line">		<span class="comment">//alert表示弹出一个对话框，只有确定按钮</span></span><br><span class="line">		<span class="comment">//confirm表示弹出一个对话框，有确定和取消按钮。当点击确定，返回true，否则返回false</span></span><br><span class="line">		<span class="keyword">if</span>(<span class="variable language_">window</span>.<span class="title function_">confirm</span>(<span class="string">&quot;是否确认删除当前库存记录&quot;</span>))&#123;</span><br><span class="line">			<span class="keyword">var</span> img = event.<span class="property">srcElement</span> ;</span><br><span class="line">			<span class="keyword">var</span> tr = img.<span class="property">parentElement</span>.<span class="property">parentElement</span> ;</span><br><span class="line">			<span class="keyword">var</span> fruitTbl = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;tbl_fruit&quot;</span>);</span><br><span class="line">			fruitTbl.<span class="title function_">deleteRow</span>(tr.<span class="property">rowIndex</span>);</span><br><span class="line"></span><br><span class="line">			<span class="title function_">updateZJ</span>();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//当鼠标点击单价单元格时进行价格编辑</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">editPrice</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(event &amp;&amp; event.<span class="property">srcElement</span> &amp;&amp; event.<span class="property">srcElement</span>.<span class="property">tagName</span>==<span class="string">&quot;TD&quot;</span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> priceTD = event.<span class="property">srcElement</span> ;</span><br><span class="line">		<span class="comment">//目的是判断当前priceTD有子节点，而且第一个子节点是文本节点 ， TextNode对应的是3  ElementNode对应的是1</span></span><br><span class="line">		<span class="keyword">if</span>(priceTD.<span class="property">firstChild</span> &amp;&amp; priceTD.<span class="property">firstChild</span>.<span class="property">nodeType</span>==<span class="number">3</span>)&#123;</span><br><span class="line">			<span class="comment">//innerText 表示设置或者获取当前节点的内部文本</span></span><br><span class="line">			<span class="keyword">var</span> oldPrice = priceTD.<span class="property">innerText</span> ;</span><br><span class="line">			<span class="comment">//innerHTML 表示设置当前节点的内部HTML</span></span><br><span class="line">			priceTD.<span class="property">innerHTML</span>=<span class="string">&quot;&lt;input type=&#x27;text&#x27; size=&#x27;4&#x27;/&gt;&quot;</span>;</span><br><span class="line">			<span class="comment">// &lt;td&gt;&lt;input type=&#x27;text&#x27; size=&#x27;4&#x27;/&gt;&lt;/td&gt;</span></span><br><span class="line">			<span class="keyword">var</span> input = priceTD.<span class="property">firstChild</span>;</span><br><span class="line">			<span class="keyword">if</span>(input.<span class="property">tagName</span>==<span class="string">&quot;INPUT&quot;</span>)&#123;</span><br><span class="line">				input.<span class="property">value</span> = oldPrice ;</span><br><span class="line">				<span class="comment">//选中输入框内部的文本</span></span><br><span class="line">				input.<span class="title function_">select</span>();</span><br><span class="line">				<span class="comment">//4.绑定输入框失去焦点事件 , 失去焦点，更新单价</span></span><br><span class="line">				input.<span class="property">onblur</span>=updatePrice ;</span><br><span class="line"></span><br><span class="line">				<span class="comment">//8.在输入框上绑定键盘摁下的事件，此处我需要保证用户输入的是数字</span></span><br><span class="line">				input.<span class="property">onkeydown</span>=ckInput;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//检验键盘摁下的值的方法</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ckInput</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="keyword">var</span> kc = event.<span class="property">keyCode</span> ;</span><br><span class="line">	<span class="comment">// 0 ~ 9 : 48~57</span></span><br><span class="line">	<span class="comment">//backspace : 8</span></span><br><span class="line">	<span class="comment">//enter : 13</span></span><br><span class="line">	<span class="comment">//console.log(kc);</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(!( ( kc&gt;=<span class="number">48</span> &amp;&amp; kc&lt;=<span class="number">57</span> ) || kc==<span class="number">8</span> || kc==<span class="number">13</span> ))&#123;</span><br><span class="line">		event.<span class="property">returnValue</span>=<span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(kc==<span class="number">13</span>)&#123;</span><br><span class="line">		event.<span class="property">srcElement</span>.<span class="title function_">blur</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//更新单价的方法</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updatePrice</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(event &amp;&amp; event.<span class="property">srcElement</span> &amp;&amp; event.<span class="property">srcElement</span>.<span class="property">tagName</span>==<span class="string">&quot;INPUT&quot;</span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> input = event.<span class="property">srcElement</span> ;</span><br><span class="line">		<span class="keyword">var</span> newPrice = input.<span class="property">value</span> ;</span><br><span class="line">		<span class="comment">//input节点的父节点是td</span></span><br><span class="line">		<span class="keyword">var</span> priceTD = input.<span class="property">parentElement</span> ;</span><br><span class="line">		priceTD.<span class="property">innerText</span> = newPrice ;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//5. 更新当前行的小计这一个格子的值</span></span><br><span class="line">		<span class="comment">//priceTD.parentElement td的父元素是tr</span></span><br><span class="line">		<span class="title function_">updateXJ</span>(priceTD.<span class="property">parentElement</span>);</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//更新指定行的小计</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateXJ</span>(<span class="params">tr</span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(tr &amp;&amp; tr.<span class="property">tagName</span>==<span class="string">&quot;TR&quot;</span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> tds = tr.<span class="property">cells</span>;</span><br><span class="line">		<span class="keyword">var</span> price = tds[<span class="number">1</span>].<span class="property">innerText</span> ;</span><br><span class="line">		<span class="keyword">var</span> count = tds[<span class="number">2</span>].<span class="property">innerText</span> ;</span><br><span class="line">		<span class="comment">//innerText获取到的值的类型是字符串类型，因此需要类型转换，才能进行数学运算</span></span><br><span class="line">		<span class="keyword">var</span> xj = <span class="built_in">parseInt</span>(price) * <span class="built_in">parseInt</span>(count);</span><br><span class="line">		tds[<span class="number">3</span>].<span class="property">innerText</span> = xj ;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//6. 更新总计</span></span><br><span class="line">		<span class="title function_">updateZJ</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//更新总计</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateZJ</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="keyword">var</span> fruitTbl = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;tbl_fruit&quot;</span>);</span><br><span class="line">	<span class="keyword">var</span> rows = fruitTbl.<span class="property">rows</span> ;</span><br><span class="line">	<span class="keyword">var</span> sum = <span class="number">0</span> ;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">1</span>; i&lt;rows.<span class="property">length</span>-<span class="number">1</span> ; i++)&#123;</span><br><span class="line">		<span class="keyword">var</span> tr = rows[i];</span><br><span class="line">		<span class="keyword">var</span> xj = <span class="built_in">parseInt</span>(tr.<span class="property">cells</span>[<span class="number">3</span>].<span class="property">innerText</span>);		<span class="comment">//NaN    not a number 不是一个数字</span></span><br><span class="line">		sum = sum + xj ;</span><br><span class="line">	&#125;</span><br><span class="line">	rows[rows.<span class="property">length</span>-<span class="number">1</span>].<span class="property">cells</span>[<span class="number">1</span>].<span class="property">innerText</span> = sum ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//当鼠标悬浮时，显示背景颜色</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showBGColor</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="comment">//event : 当前发生的事件</span></span><br><span class="line">	<span class="comment">//event.srcElement : 事件源</span></span><br><span class="line">	<span class="comment">//alert(event.srcElement);</span></span><br><span class="line">	<span class="comment">//alert(event.srcElement.tagName);	--&gt; TD</span></span><br><span class="line">	<span class="keyword">if</span>(event &amp;&amp; event.<span class="property">srcElement</span> &amp;&amp; event.<span class="property">srcElement</span>.<span class="property">tagName</span>==<span class="string">&quot;TD&quot;</span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> td = event.<span class="property">srcElement</span> ;</span><br><span class="line">		<span class="comment">//td.parentElement 表示获取td的父元素 -&gt; TR</span></span><br><span class="line">		<span class="keyword">var</span> tr = td.<span class="property">parentElement</span> ;</span><br><span class="line">		<span class="comment">//如果想要通过js代码设置某节点的样式，则需要加上 .style</span></span><br><span class="line">		tr.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="string">&quot;navy&quot;</span> ;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//tr.cells表示获取这个tr中的所有的单元格</span></span><br><span class="line">		<span class="keyword">var</span> tds = tr.<span class="property">cells</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i&lt;tds.<span class="property">length</span> ; i++)&#123;</span><br><span class="line">			tds[i].<span class="property">style</span>.<span class="property">color</span>=<span class="string">&quot;white&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//当鼠标离开时，恢复原始样式</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">clearBGColor</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(event &amp;&amp; event.<span class="property">srcElement</span> &amp;&amp; event.<span class="property">srcElement</span>.<span class="property">tagName</span>==<span class="string">&quot;TD&quot;</span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> td = event.<span class="property">srcElement</span> ;</span><br><span class="line">		<span class="keyword">var</span> tr = td.<span class="property">parentElement</span> ;</span><br><span class="line">		tr.<span class="property">style</span>.<span class="property">backgroundColor</span>=<span class="string">&quot;transparent&quot;</span>;</span><br><span class="line">		<span class="keyword">var</span> tds = tr.<span class="property">cells</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i&lt;tds.<span class="property">length</span> ; i++)&#123;</span><br><span class="line">			tds[i].<span class="property">style</span>.<span class="property">color</span>=<span class="string">&quot;threeddarkshadow&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//当鼠标悬浮在单价单元格时，显示手势</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showHand</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(event &amp;&amp; event.<span class="property">srcElement</span> &amp;&amp; event.<span class="property">srcElement</span>.<span class="property">tagName</span>==<span class="string">&quot;TD&quot;</span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> td = event.<span class="property">srcElement</span> ;</span><br><span class="line">		<span class="comment">//cursor : 光标</span></span><br><span class="line">		td.<span class="property">style</span>.<span class="property">cursor</span>=<span class="string">&quot;hand&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="CS和BS的异同点"><a href="#CS和BS的异同点" class="headerlink" title="CS和BS的异同点"></a>CS和BS的异同点</h2><p>CS：客户端服务器架构模式</p>
<ul>
<li>优点：充分利用客户端机器的资源，减轻服务器的负荷（一部分安全要求不高的计算任务存储任务放在客户端执行，不需要把所有的计算和存储都在服务端执行，从而能够减轻服务器的压力，也能够减轻网络负荷）</li>
<li>缺点：需要安装；升级维护成本较高</li>
</ul>
<p>BS：浏览器服务器架构模式</p>
<ul>
<li>优点：客户端不许需要安装；维护成本较低</li>
<li>缺点：所有的计算和存储任务都是放在服务器端的，服务器的负荷较重；在服务器计算完成之后把结果在传输给客户端，因此客户端和服务器端会进行非常频繁的数据通信，从而网络负荷较重</li>
</ul>
<h2 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h2><h3 id="Tomcat的部署运行"><a href="#Tomcat的部署运行" class="headerlink" title="Tomcat的部署运行"></a>Tomcat的部署运行</h3><p><img src="/2022/09/30/JavaWeb/image-20220619142600475.png" alt="image-20220619142600475"></p>
<blockquote>
<p>baidu文件夹作为项目的存放位置</p>
</blockquote>
<h3 id="Tomcat部署运行在idea"><a href="#Tomcat部署运行在idea" class="headerlink" title="Tomcat部署运行在idea"></a>Tomcat部署运行在idea</h3><p>先创建一个java工程，在工程下创建一个java模块，再次java模块下添加web应用框架，就此web项目就创建成功</p>
<p><img src="/2022/09/30/JavaWeb/image-20220619142935124.png" alt="image-20220619142935124"></p>
<p>创建Tomcat模板</p>
<p><img src="/2022/09/30/JavaWeb/image-20220619143035494.png" alt="image-20220619143035494"></p>
<p><img src="/2022/09/30/JavaWeb/image-20220619143223910.png" alt="image-20220619143223910"></p>
<p>添加Tomcat</p>
<p><img src="/2022/09/30/JavaWeb/image-20220619143316111.png" alt="image-20220619143316111"></p>
<blockquote>
<p>URL是tomcat默认访问地址</p>
</blockquote>
<p>注意：</p>
<p><img src="/2022/09/30/JavaWeb/image-20220702143544183.png" alt="image-20220702143544183"></p>
<blockquote>
<p>Application context 地址要与URL中的context地址一致，这表示当前上下文的入口</p>
</blockquote>
<h1 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h1><h2 id="1、Servlet概述"><a href="#1、Servlet概述" class="headerlink" title="1、Servlet概述"></a>1、Servlet概述</h2><h3 id="1-Servlet名字"><a href="#1-Servlet名字" class="headerlink" title="1.Servlet名字"></a>1.Servlet名字</h3><p>Servlet&#x3D;Server+applet</p>
<p>Server：服务器</p>
<p>applet：小程序</p>
<p>Servlet含义是服务器端的小程序</p>
<h3 id="2-Servlet在整个Web应用中起到的作用"><a href="#2-Servlet在整个Web应用中起到的作用" class="headerlink" title="2.Servlet在整个Web应用中起到的作用"></a>2.Servlet在整个Web应用中起到的作用</h3><p><img src="/2022/09/30/JavaWeb/image-20220630195102715.png" alt="image-20220630195102715"></p>
<p>在整个Web应用中，Servlet主要负责处理请求、协调调度功能。我们可以把Servlet称为Web应用中的<strong>『控制器』</strong></p>
<h2 id="2、Servlet入门实例"><a href="#2、Servlet入门实例" class="headerlink" title="2、Servlet入门实例"></a>2、Servlet入门实例</h2><p>创建一个javaweb模块</p>
<p><img src="/2022/09/30/JavaWeb/image-20220630200546258.png" alt="image-20220630200546258"></p>
<blockquote>
<p>这里如果不能直接创建Javaweb模块这可以先创建Java模块，后右键模块文件—&gt;点击Add Framework Support 将Web加入到本模块中</p>
</blockquote>
<p>创建lib文件在工程下，导入jar包，即导入mysql驱动</p>
<p><img src="/2022/09/30/JavaWeb/image-20220630200721149.png" alt="image-20220630200721149"></p>
<blockquote>
<p>这里是tomcat9.0的，适配MySQL5.1.7，不知道为啥，MySQL8.0驱动不适配</p>
</blockquote>
<p>右键lib文件夹–&gt;as a library ，使之加入library</p>
<p>最上方File —&gt; Project Structure </p>
<ul>
<li>在页面框右边Modules，选择对应模块，选择Dependencies依赖，添加刚刚加入mysql驱动到依赖中</li>
<li>在页面框右边problem，解决出现的问题（将lib加入artifacts）</li>
</ul>
<p>编写网页html，表单用来提交发送数据到服务器</p>
<p><img src="/2022/09/30/JavaWeb/image-20220630202454142.png" alt="image-20220630202454142"></p>
<p>编写addServlet，获取请求中的数据，编写JDBC将数据保存到数据库</p>
<p><img src="/2022/09/30/JavaWeb/image-20220630203516754.png" alt="image-20220630203516754"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">fname</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fname&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">priceStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;price&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">price</span> <span class="operator">=</span> Integer.parseInt(priceStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">fcountStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fcount&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">fcount</span> <span class="operator">=</span> Integer.parseInt(fcountStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">remark</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;remark&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">FruitDAO</span> <span class="variable">fruitDAO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitDAOImpl</span>();</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> fruitDAO.addFruit(<span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="number">0</span> , fname , price , fcount , remark));</span><br><span class="line"></span><br><span class="line">        System.out.println(flag ? <span class="string">&quot;添加成功！&quot;</span> : <span class="string">&quot;添加失败！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置xml文件，因为用户将数据发送给add，那我们就得配置，使得服务器能够找到add对应的addServlet类</p>
<p><img src="/2022/09/30/JavaWeb/image-20220630202751833.png" alt="image-20220630202751833"></p>
<ol>
<li>用户发请求，action&#x3D;add</li>
<li>项目中，web.xml中找到url-pattern &#x3D; &#x2F;add   -&gt; 第12行</li>
<li>找第11行的servlet-name &#x3D; AddServlet</li>
<li>找和servlet-mapping中servlet-name一致的servlet ， 找到第7行</li>
<li>找第8行的servlet-class -&gt; com.atguigu.servlets.AddServlet</li>
<li>用户发送的是post请求（method&#x3D;post） ， 因此 tomcat会执行AddServlet中的doPost方法</li>
</ol>
<p>之后就可以运行tomcat，在出现的表单中填写数据，提交，发送到服务器，servlet进行数据处理之后加入数据库</p>
<h3 id="设置编码问题"><a href="#设置编码问题" class="headerlink" title="设置编码问题"></a>设置编码问题</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">设置编码</span><br><span class="line">tomcat8之前，设置编码：</span><br><span class="line">  1)get请求方式：</span><br><span class="line">    //get方式目前不需要设置编码（基于tomcat8）</span><br><span class="line">    //如果是get请求发送的中文数据，转码稍微有点麻烦（tomcat8之前）</span><br><span class="line">    String fname = request.getParameter(&quot;fname&quot;);</span><br><span class="line">    //1.将字符串打散成字节数组</span><br><span class="line">    byte[] bytes = fname.getBytes(&quot;ISO-8859-1&quot;);</span><br><span class="line">    //2.将字节数组按照设定的编码重新组装成字符串</span><br><span class="line">    fname = new String(bytes,&quot;UTF-8&quot;);</span><br><span class="line">  2)post请求方式：</span><br><span class="line">    request.setCharacterEncoding(&quot;UTF-8&quot;);</span><br><span class="line">tomcat8开始，设置编码，只需要针对post方式</span><br><span class="line">    request.setCharacterEncoding(&quot;UTF-8&quot;);</span><br><span class="line">注意：</span><br><span class="line">    需要注意的是，设置编码(post)这一句代码必须在所有的获取参数动作之前</span><br></pre></td></tr></table></figure>

<h2 id="3、Servlet的继承关系及核心方法"><a href="#3、Servlet的继承关系及核心方法" class="headerlink" title="3、Servlet的继承关系及核心方法"></a>3、Servlet的继承关系及核心方法</h2><h3 id="1-Servlet的继承关系"><a href="#1-Servlet的继承关系" class="headerlink" title="1.Servlet的继承关系"></a>1.Servlet的继承关系</h3><p>重点查看的是服务方法（service()）</p>
<ol>
<li><p>继承关系<br> javax.servlet.Servlet接口<br>   javax.servlet.GenericServlet抽象类<br>   javax.servlet.http.HttpServlet抽象子类</p>
</li>
<li><p>相关方法<br> javax.servlet.Servlet接口:<br> void init(config) - 初始化方法<br> void service(request,response) - 服务方法<br> void destory() - 销毁方法</p>
</li>
</ol>
<p>  javax.servlet.GenericServlet抽象类：<br>    void service(request,response) - 仍然是抽象的</p>
<p>  javax.servlet.http.HttpServlet 抽象子类：<br>    void service(request,response) - 不是抽象的</p>
<h3 id="2-service-方法"><a href="#2-service-方法" class="headerlink" title="2.service( )方法"></a>2.service( )方法</h3><ol>
<li><p>String method &#x3D; req.getMethod(); 获取请求的方式</p>
<ol>
<li>各种if判断，根据请求方式不同，决定去调用不同的do方法    <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">        <span class="keyword">if</span> (method.equals(<span class="string">&quot;GET&quot;</span>)) &#123;</span><br><span class="line">         <span class="built_in">this</span>.doGet(req,resp);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(<span class="string">&quot;HEAD&quot;</span>)) &#123;</span><br><span class="line">         <span class="built_in">this</span>.doHead(req, resp);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(<span class="string">&quot;POST&quot;</span>)) &#123;</span><br><span class="line">         <span class="built_in">this</span>.doPost(req, resp);</span><br><span class="line">         &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(<span class="string">&quot;PUT&quot;</span>)) &#123;</span><br><span class="line">         <span class="built_in">this</span>.doPut(req, resp); </span><br><span class="line">        &#125;  </span><br><span class="line"></span><br><span class="line">​    在HttpServlet这个抽象类中，<span class="keyword">do</span>方法都差不多:</span><br><span class="line">​    ```java</span><br><span class="line">​    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"><span class="type">String</span> <span class="variable">protocol</span> <span class="operator">=</span> req.getProtocol();</span><br><span class="line">​    <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> lStrings.getString(<span class="string">&quot;http.method_get_not_supported&quot;</span>);</span><br><span class="line">​    <span class="keyword">if</span> (protocol.endsWith(<span class="string">&quot;1.1&quot;</span>)) &#123;</span><br><span class="line">​     resp.sendError(<span class="number">405</span>, msg);</span><br><span class="line">​    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">​     resp.sendError(<span class="number">400</span>, msg);</span><br><span class="line">​    &#125;</span><br><span class="line">​     &#125;</span><br><span class="line">​    ```</span><br><span class="line"></span><br><span class="line">&gt;  HttpServlet中这些<span class="keyword">do</span>方法默认都是<span class="number">405</span>的实现风格-要我们子类去实现对应的方法，否则默认会报<span class="number">405</span>错误</span><br><span class="line"></span><br><span class="line">### <span class="number">3.</span>小结</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>) 继承关系： HttpServlet -&gt; GenericServlet -&gt; Servlet</span><br><span class="line"><span class="number">2</span>) Servlet中的核心方法： init() , service() , destroy()</span><br><span class="line"><span class="number">3</span>) 服务方法： 当有请求过来时，service方法会自动响应（其实是tomcat容器调用的）</span><br><span class="line">        在HttpServlet中我们会去分析请求的方式：到底是get、post、head还是delete等等</span><br><span class="line">        然后再决定调用的是哪个<span class="keyword">do</span>开头的方法</span><br><span class="line">        那么在HttpServlet中这些<span class="keyword">do</span>方法默认都是<span class="number">405</span>的实现风格-要我们子类去实现对应的方法，否则默认会报<span class="number">405</span>错误</span><br><span class="line"><span class="number">4</span>) 因此，我们在新建Servlet时，我们才会去考虑请求方法，从而决定重写哪个<span class="keyword">do</span>方法</span><br><span class="line"></span><br><span class="line">## <span class="number">4</span>、Servlet的生命周期</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>） 生命周期：从出生到死亡的过程就是生命周期。对应Servlet中的三个方法：init(),service(),destroy()</span><br><span class="line"><span class="number">2</span>） 默认情况下：</span><br><span class="line">    第一次接收请求时，这个Servlet会进行实例化(调用构造方法)、初始化(调用init())、然后服务(调用service())</span><br><span class="line">    从第二次请求开始，每一次都是服务</span><br><span class="line">    当容器关闭时，其中的所有的servlet实例会被销毁，调用销毁方法</span><br><span class="line"><span class="number">3</span>） 通过案例我们发现：</span><br><span class="line"></span><br><span class="line">- **Servlet实例tomcat只会创建一个，所有的请求都是这个实例去响应。**</span><br><span class="line">    - 默认情况下，第一次请求时，tomcat才会去实例化，初始化，然后再服务</span><br><span class="line">      * 这样的好处是什么？ 提高系统的启动速度  </span><br><span class="line">      * 这样的缺点是什么？ 第一次请求时，耗时较长。</span><br><span class="line">    - 因此得出结论：如果需要提高响应速度，我们应该设置Servlet的初始化时机。</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>） Servlet的初始化时机：</span><br><span class="line"></span><br><span class="line">- 默认是第一次接收请求时，实例化，初始化</span><br><span class="line">- 我们可以通过&lt;load-on-startup&gt;来设置servlet启动的先后顺序,数字越小，启动越靠前，最小值<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span>） Servlet在容器中是：单例的、线程不安全的</span><br><span class="line"></span><br><span class="line">- 单例：所有的请求都是同一个实例去响应</span><br><span class="line"></span><br><span class="line">- 线程不安全：一个线程需要根据这个实例中的某个成员变量值去做逻辑判断。但是在中间某个时机，另一个线程改变了这个成员变量的值，从而导致第一个线程的执行路径发生了变化</span><br><span class="line"></span><br><span class="line">- 我们已经知道了servlet是线程不安全的</span><br><span class="line"></span><br><span class="line">  * 给我们的启发是： 尽量的不要在servlet中定义成员变量。</span><br><span class="line"></span><br><span class="line">  * 如果不得不定义成员变量，那么不要去：</span><br><span class="line"></span><br><span class="line">    ①不要去修改成员变量的值</span><br><span class="line"></span><br><span class="line">    ②不要去根据成员变量的值做一些逻辑判断</span><br><span class="line"></span><br><span class="line">线程不安全图示：</span><br><span class="line"></span><br><span class="line">![image-<span class="number">20220701202330023</span>](JavaWeb/image-<span class="number">20220701202330023.</span>png)</span><br><span class="line"></span><br><span class="line">## <span class="number">5</span>、Http协议</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>） Http 称之为 超文本传输协议</span><br><span class="line"><span class="number">2</span>） Http是无状态的</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>） Http请求响应包含两个部分：请求和响应</span><br><span class="line"></span><br><span class="line">  - 请求：</span><br><span class="line">    请求包含三个部分：</span><br><span class="line">    * <span class="number">1.</span>请求行 ； </span><br><span class="line">    * <span class="number">2.</span>请求消息头 </span><br><span class="line">    * <span class="number">3.</span>请求主体</span><br><span class="line"></span><br><span class="line">  - <span class="number">1</span>)请求行包含是三个信息：</span><br><span class="line">    * <span class="number">1.</span>请求的方式 ； </span><br><span class="line">    * <span class="number">2.</span>请求的URL ； </span><br><span class="line">    * <span class="number">3.</span>请求的协议（一般都是HTTP1<span class="number">.1</span>）</span><br><span class="line">  - <span class="number">2</span>)请求消息头中包含了很多客户端需要告诉服务器的信息，比如：我的浏览器型号、版本、我能接收的内容的类型、我给你发的内容的类型、内容的长度等等</span><br><span class="line">  - <span class="number">3</span>)请求体，三种情况</span><br><span class="line">    * get方式，没有请求体，但是有一个queryString</span><br><span class="line">    * post方式，有请求体，form data</span><br><span class="line">    * json格式，有请求体，request payload</span><br><span class="line">  - 响应：</span><br><span class="line">    响应也包含三种： <span class="number">1.</span> 响应行 ； <span class="number">2.</span>响应头 ； <span class="number">3.</span>响应体</span><br><span class="line">    * <span class="number">1</span>)响应行包含三个信息：</span><br><span class="line">      * <span class="number">1.</span>协议 </span><br><span class="line">      * <span class="number">2.</span>响应状态码(<span class="number">200</span>) </span><br><span class="line">      * <span class="number">3.</span>响应状态(ok)</span><br><span class="line">    * <span class="number">2</span>)响应头：包含了服务器的信息；服务器发送给浏览器的信息（内容的媒体类型、编码、内容长度等）</span><br><span class="line">    * <span class="number">3</span>)响应体：响应的实际内容（比如请求add.html页面时，响应的内容就是&lt;html&gt;&lt;head&gt;&lt;body&gt;&lt;form....）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## <span class="number">6</span>、会话</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>） Http是无状态的</span><br><span class="line">    - HTTP 无状态 ：服务器无法判断这两次请求是同一个客户端发过来的，还是不同的客户端发过来的</span><br><span class="line">        - 无状态带来的现实问题：第一次请求是添加商品到购物车，第二次请求是结账；如果这两次请求服务器无法区分是同一个用户的，那么就会导致混乱</span><br><span class="line">        - 通过会话跟踪技术来解决无状态的问题。</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>） 会话跟踪技术</span><br><span class="line"></span><br><span class="line">    - 客户端第一次发请求给服务器，服务器获取session，获取不到，则创建新的，然后响应给客户端</span><br><span class="line">        - 下次客户端给服务器发请求时，会把sessionID带给服务器，那么服务器就能获取到了，那么服务器就判断这一次请求和上次某次请求是同一个客户端，从而能够区分开客户端</span><br><span class="line">        - 常用的API：</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">request.getSession() -&gt; 获取当前的会话，没有则创建一个新的会话</span><br><span class="line">request.getSession(<span class="literal">true</span>) -&gt; 效果和不带参数相同</span><br><span class="line">request.getSession(<span class="literal">false</span>) -&gt; 获取当前会话，没有则返回<span class="literal">null</span>，不会创建新的</span><br><span class="line">session.getId() -&gt; 获取sessionID</span><br><span class="line">session.isNew() -&gt; 判断当前session是否是新的</span><br><span class="line">session.getMaxInactiveInterval() -&gt; session的非激活间隔时长，默认<span class="number">1800</span>秒</span><br><span class="line">session.setMaxInactiveInterval()</span><br><span class="line">session.invalidate() -&gt; 强制性让会话立即失效</span><br><span class="line">  ....</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<p>会话图示：</p>
<p><img src="/2022/09/30/JavaWeb/image-20220701202434538.png" alt="image-20220701202434538"></p>
<p>3） session保存作用域</p>
<ul>
<li>session保存作用域是和具体的某一个session对应的，设置他的专属属性</li>
<li>常用的API：<br>void session.setAttribute(k,v)<br>Object session.getAttribute(k)<br>void removeAttribute(k)</li>
</ul>
<h2 id="7、服务器内部转发以及客户端重定向"><a href="#7、服务器内部转发以及客户端重定向" class="headerlink" title="7、服务器内部转发以及客户端重定向"></a>7、服务器内部转发以及客户端重定向</h2><p>1） 服务器内部转发 : request.getRequestDispatcher(“…”).forward(request,response);</p>
<ul>
<li>一次请求响应的过程，对于客户端而言，内部经过了多少次转发，客户端是不知道的</li>
<li>地址栏访问地址没有变化</li>
</ul>
<p>图示：</p>
<p><img src="/2022/09/30/JavaWeb/image-20220701204547620.png" alt="image-20220701204547620"></p>
<p>2）客户端重定向： response.sendRedirect(“….”);</p>
<ul>
<li>两次请求响应的过程。客户端肯定知道请求URL有变化</li>
<li>地址栏访问地址有变化</li>
</ul>
<p>图示：</p>
<p><img src="/2022/09/30/JavaWeb/image-20220701204618860.png" alt="image-20220701204618860"></p>
<h2 id="8、Thymeleaf-视图模板技术"><a href="#8、Thymeleaf-视图模板技术" class="headerlink" title="8、Thymeleaf - 视图模板技术"></a>8、Thymeleaf - 视图模板技术</h2><p>过程图示：</p>
<p><img src="/2022/09/30/JavaWeb/image-20220702132830048.png" alt="image-20220702132830048"></p>
<p>Thymeleaf中提供processTemplate( )方法将数据渲染到html页面</p>
<ol>
<li>添加thymeleaf的jar包</li>
</ol>
<p><img src="/2022/09/30/JavaWeb/image-20220702130459879.png" alt="image-20220702130459879"></p>
<ol start="2">
<li><p>在web.xml文件中添加配置</p>
<ul>
<li>配置前缀 view-prefix</li>
<li>配置后缀 view-suffix</li>
</ul>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置上下文参数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>view-prefix<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>view-suffix<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>.html<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>新建一个Servlet类ViewBaseServlet，本质上是搭建Thymeleaf所需的环境</p>
<p>ViewBaseServlet继承是HttpServlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ViewBaseServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> TemplateEngine templateEngine;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        <span class="comment">// 1.获取ServletContext对象</span></span><br><span class="line">        <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> <span class="built_in">this</span>.getServletContext();</span><br><span class="line">        <span class="comment">// 2.创建Thymeleaf解析器对象</span></span><br><span class="line">        <span class="type">ServletContextTemplateResolver</span> <span class="variable">templateResolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletContextTemplateResolver</span>(servletContext);</span><br><span class="line">        <span class="comment">// 3.给解析器对象设置参数</span></span><br><span class="line">        <span class="comment">// ①HTML是默认模式，明确设置是为了代码更容易理解</span></span><br><span class="line">        templateResolver.setTemplateMode(TemplateMode.HTML);</span><br><span class="line">        <span class="comment">// ②设置前缀</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">viewPrefix</span> <span class="operator">=</span> servletContext.getInitParameter(<span class="string">&quot;view-prefix&quot;</span>);</span><br><span class="line">        templateResolver.setPrefix(viewPrefix);</span><br><span class="line">        <span class="comment">// ③设置后缀</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">viewSuffix</span> <span class="operator">=</span> servletContext.getInitParameter(<span class="string">&quot;view-suffix&quot;</span>);</span><br><span class="line">        templateResolver.setSuffix(viewSuffix);</span><br><span class="line">        <span class="comment">// ④设置缓存过期时间（毫秒）</span></span><br><span class="line">        templateResolver.setCacheTTLMs(<span class="number">60000L</span>);</span><br><span class="line">        <span class="comment">// ⑤设置是否缓存</span></span><br><span class="line">        templateResolver.setCacheable(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// ⑥设置服务器端编码方式</span></span><br><span class="line">        templateResolver.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        <span class="comment">// 4.创建模板引擎对象</span></span><br><span class="line">        templateEngine = <span class="keyword">new</span> <span class="title class_">TemplateEngine</span>();</span><br><span class="line">        <span class="comment">// 5.给模板引擎对象设置模板解析器</span></span><br><span class="line">        templateEngine.setTemplateResolver(templateResolver);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">processTemplate</span><span class="params">(String templateName, HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1.设置响应体内容类型和字符集</span></span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">        <span class="comment">// 2.创建WebContext对象</span></span><br><span class="line">        <span class="type">WebContext</span> <span class="variable">webContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebContext</span>(req, resp, getServletContext());</span><br><span class="line">        <span class="comment">// 3.处理模板数据</span></span><br><span class="line">        templateEngine.process(templateName, webContext, resp.getWriter());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使得我们的Servlet继承ViewBaseServlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Servlet从3.0版本开始支持注解方式的注册，无需在xml文件中配置index与IndexServlet对应信息</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexServlet</span> <span class="keyword">extends</span> <span class="title class_">ViewBaseServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request , HttpServletResponse response)</span><span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">FruitDAO</span> <span class="variable">fruitDAO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitDAOImpl</span>();</span><br><span class="line">        List&lt;Fruit&gt; fruitList = fruitDAO.getFruitList();</span><br><span class="line">        <span class="comment">//保存到session作用域</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession() ;</span><br><span class="line">        session.setAttribute(<span class="string">&quot;fruitList&quot;</span>,fruitList);</span><br><span class="line">        <span class="comment">//此处的视图名称是 index</span></span><br><span class="line">        <span class="comment">//那么thymeleaf会将这个 逻辑视图名称 对应到 物理视图 名称上去</span></span><br><span class="line">        <span class="comment">//逻辑视图名称 ：   index</span></span><br><span class="line">        <span class="comment">//物理视图名称 ：   view-prefix + 逻辑视图名称 + view-suffix</span></span><br><span class="line">        <span class="comment">//所以真实的视图名称是：      /       index       .html</span></span><br><span class="line">        <span class="built_in">super</span>.processTemplate(<span class="string">&quot;index&quot;</span>,request,response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><blockquote>
<p>根据逻辑视图名称 得到 物理视图名称<br>此处的视图名称是 index<br>那么thymeleaf会将这个 逻辑视图名称 对应到 物理视图 名称上去<br>逻辑视图名称 ：   index<br>物理视图名称 ：   view-prefix + 逻辑视图名称 + view-suffix<br>所以真实的视图名称是：      &#x2F;       index       .html<br>super.processTemplate(“index”,request,response);</p>
</blockquote>
</li>
<li><p>使用thymeleaf的标签<br>  th:if   ,  th:unless   , th:each   ,   th:text</p>
</li>
<li><p>index.html水果库存页面</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/index.css&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_container&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_fruit_list&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;center f30&quot;</span>&gt;</span>欢迎使用水果库存后台管理系统<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">&quot;tbl_fruit&quot;</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>单价<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>库存<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;#lists.isEmpty(session.fruitList)&#125;&quot;</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;4&quot;</span>&gt;</span>对不起，库存为空！<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:unless</span>=<span class="string">&quot;$&#123;#lists.isEmpty(session.fruitList)&#125;&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;fruit : $&#123;session.fruitList&#125;&quot;</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;fruit.fname&#125;&quot;</span>&gt;</span>苹果<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;fruit.price&#125;&quot;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;fruit.fcount&#125;&quot;</span>&gt;</span>20<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;imgs/del.jpg&quot;</span> <span class="attr">class</span>=<span class="string">&quot;delImg&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>操作注意：</p>
</li>
</ol>
<img src="/2022/09/30/JavaWeb/image-20220702132012777.png" alt="image-20220702132012777" style="zoom:67%;">

<blockquote>
<p>URL：默认地址index后不加 .html</p>
</blockquote>
<p>&#x2F;&#x2F; 200 : 正常响应<br>&#x2F;&#x2F; 404 : 找不到资源<br>&#x2F;&#x2F; 405 : 请求方式不支持<br>&#x2F;&#x2F; 500 : 服务器内部错误</p>
<h2 id="9、保存作用域"><a href="#9、保存作用域" class="headerlink" title="9、保存作用域"></a>9、保存作用域</h2><p>原始情况下，保存作用域我们可以认为有四个： </p>
<ul>
<li>page（页面级别，现在几乎不用） </li>
<li>request（一次请求响应范围） </li>
<li>session（一次会话范围） </li>
<li>application（整个应用程序范围）</li>
</ul>
<p> 1） request：一次请求响应范围</p>
<p><img src="/2022/09/30/JavaWeb/image-20220702140400146.png" alt="image-20220702140400146"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//演示request保存作用域（demo01和demo02）</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/demo01&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01Servlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1.向request保存作用域保存数据</span></span><br><span class="line">        request.setAttribute(<span class="string">&quot;uname&quot;</span>,<span class="string">&quot;lili&quot;</span>);</span><br><span class="line">        <span class="comment">//2.客户端重定向</span></span><br><span class="line">        <span class="comment">//response.sendRedirect(&quot;demo02&quot;); 不可以</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.服务器端转发</span></span><br><span class="line">        request.getRequestDispatcher(<span class="string">&quot;demo02&quot;</span>).forward(request,response);  <span class="comment">//相当于一次请求</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/demo02&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo02Servlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1.获取request保存作用域保存的数据，key为uname</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">unameObj</span> <span class="operator">=</span> request.getAttribute(<span class="string">&quot;uname&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;unameObj = &quot;</span> + unameObj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p> 2） session：一次会话范围有效</p>
<p><img src="/2022/09/30/JavaWeb/image-20220702140443309.png" alt="image-20220702140443309"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//演示session保存作用域（demo03和demo04）</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/demo03&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo03Servlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1.向session保存作用域保存数据</span></span><br><span class="line">        request.getSession().setAttribute(<span class="string">&quot;uname&quot;</span>,<span class="string">&quot;lili&quot;</span>);</span><br><span class="line">        <span class="comment">//2.客户端重定向</span></span><br><span class="line">        response.sendRedirect(<span class="string">&quot;demo04&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.服务器端转发</span></span><br><span class="line">        <span class="comment">//request.getRequestDispatcher(&quot;demo04&quot;).forward(request,response);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/demo04&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo04Servlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1.获取session保存作用域保存的数据，key为uname</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">unameObj</span> <span class="operator">=</span> request.getSession().getAttribute(<span class="string">&quot;uname&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;unameObj = &quot;</span> + unameObj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 3） application： 一次应用程序范围有效</p>
<p><img src="/2022/09/30/JavaWeb/image-20220702140505247.png" alt="image-20220702140505247"></p>
<h2 id="10、路径问题"><a href="#10、路径问题" class="headerlink" title="10、路径问题"></a>10、路径问题</h2><p><img src="/2022/09/30/JavaWeb/image-20220702184941299.png" alt="image-20220702184941299"></p>
<p>. .  表示返回上一级</p>
<h1 id="水果系统项目"><a href="#水果系统项目" class="headerlink" title="水果系统项目"></a>水果系统项目</h1><h2 id="水果系统"><a href="#水果系统" class="headerlink" title="水果系统"></a>水果系统</h2><h3 id="1-建立数据库和表"><a href="#1-建立数据库和表" class="headerlink" title="1.建立数据库和表"></a>1.建立数据库和表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_fruit(</span><br><span class="line">	fid <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY,  #自增fid语句</span><br><span class="line">	fname <span class="type">VARCHAR</span>(<span class="number">15</span>) <span class="keyword">NULL</span>,</span><br><span class="line">	price <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">	fcount <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">	remark <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> t_fruit;  #删除表语句</span><br></pre></td></tr></table></figure>



<h3 id="2-创建JavaWbe项目模块"><a href="#2-创建JavaWbe项目模块" class="headerlink" title="2.创建JavaWbe项目模块"></a>2.创建JavaWbe项目模块</h3><ul>
<li>创建JavaWeb模块</li>
<li>将MySQL驱动lib依赖添加新模块中</li>
<li>将thyemleaf jar包依赖添加到新模块中</li>
<li>将新模块加入Tomcat中，并加入Tomcat依赖添加新模块中</li>
<li>在web.xml中，配置前缀和后缀，用于thyemleaf的逻辑地址转换为物理地址</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>view-prefix<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>view-suffix<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>.html<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="3、主索引index页面"><a href="#3、主索引index页面" class="headerlink" title="3、主索引index页面"></a>3、主索引index页面</h3><h4 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h4><ul>
<li>按5条库存记录展示在页面中</li>
<li>添加库存记录功能，跳转至add.html</li>
<li>首页、上一页、下一页、尾页功能，每页5条库存记录</li>
</ul>
<h4 id="1）编写index-html页面"><a href="#1）编写index-html页面" class="headerlink" title="1）编写index.html页面"></a>1）编写index.html页面</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/index.css&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;JavaScript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;js/index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_container&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_fruit_list&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;center f30&quot;</span>&gt;</span>欢迎使用水果库存后台管理系统<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;border:0px solid red;width:60%;margin-left:20%;text-align:right;&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/add.html&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;border:0px solid blue;margin-bottom:4px;&quot;</span>&gt;</span>添加新库存记录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">&quot;tbl_fruit&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>名称1<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>单价<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>库存<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;#lists.isEmpty(session.fruitList)&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;4&quot;</span>&gt;</span>对不起，库存为空！<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:unless</span>=<span class="string">&quot;$&#123;#lists.isEmpty(session.fruitList)&#125;&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;fruit : $&#123;session.fruitList&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- &lt;td&gt;&lt;a th:text=&quot;$&#123;fruit.fname&#125;&quot; th:href=&quot;@&#123;&#x27;/edit.do?fid=&#x27;+$&#123;fruit.fid&#125;&#125;&quot;&gt;苹果&lt;/a&gt;&lt;/td&gt; --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;fruit.fname&#125;&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/edit.do(fid=$&#123;fruit.fid&#125;)&#125;&quot;</span>&gt;</span>苹果<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;fruit.price&#125;&quot;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;fruit.fcount&#125;&quot;</span>&gt;</span>20<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- &lt;td&gt;&lt;img src=&quot;imgs/del.jpg&quot; class=&quot;delImg&quot; th:onclick=&quot;&#x27;delFruit(&#x27;+$&#123;fruit.fid&#125;+&#x27;)&#x27;&quot;/&gt;&lt;/td&gt; --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;imgs/del.jpg&quot;</span> <span class="attr">class</span>=<span class="string">&quot;delImg&quot;</span> <span class="attr">th:onclick</span>=<span class="string">&quot;|delFruit($&#123;fruit.fid&#125;)|&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;width:60%;margin-left:20%;border:0px solid red;padding-top:4px;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;首  页1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">th:onclick</span>=<span class="string">&quot;|page(1)|&quot;</span> <span class="attr">th:disabled</span>=<span class="string">&quot;$&#123;session.pageNo==1&#125;&quot;</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上一页&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">th:onclick</span>=<span class="string">&quot;|page($&#123;session.pageNo-1&#125;)|&quot;</span> <span class="attr">th:disabled</span>=<span class="string">&quot;$&#123;session.pageNo==1&#125;&quot;</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;下一页&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">th:onclick</span>=<span class="string">&quot;|page($&#123;session.pageNo+1&#125;)|&quot;</span> <span class="attr">th:disabled</span>=<span class="string">&quot;$&#123;session.pageNo==session.pageCount&#125;&quot;</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;尾  页&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">th:onclick</span>=<span class="string">&quot;|page($&#123;session.pageCount&#125;)|&quot;</span> <span class="attr">th:disabled</span>=<span class="string">&quot;$&#123;session.pageNo==session.pageCount&#125;&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="2）编写index-css"><a href="#2）编写index-css" class="headerlink" title="2）编写index.css"></a>2）编写index.css</h4><p>略</p>
<h4 id="3）编写index-js"><a href="#3）编写index-js" class="headerlink" title="3）编写index.js"></a>3）编写index.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">delFruit</span>(<span class="params">fid</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_">confirm</span>(<span class="string">&#x27;是否确认删除？&#x27;</span>))&#123;</span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&#x27;del.do?fid=&#x27;</span>+fid; </span><br><span class="line">        <span class="comment">//当前窗口地址+加上del.do?fid=fid ,即传输一个参数给del.do</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">page</span>(<span class="params">pageNo</span>)&#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&quot;index?pageNo=&quot;</span>+pageNo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4）编写indexServlet"><a href="#4）编写indexServlet" class="headerlink" title="4）编写indexServlet"></a>4）编写indexServlet</h4><p>在FruitDAO接口中添加方法，在FruitDAOImpl实现类中重写此方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Fruit&gt; <span class="title function_">getFruitList</span><span class="params">(Integer pageNo)</span> &#123; <span class="comment">//按一页5条数据的返回</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.executeQuery(<span class="string">&quot;select * from t_fruit limit ?, 5&quot;</span> ,(pageNo-<span class="number">1</span>)*<span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getFruitCount</span><span class="params">()</span> &#123;  <span class="comment">//查询总记录条数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select count(*) from t_fruit&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> ((Long)<span class="built_in">super</span>.executeComplexQuery(sql)[<span class="number">0</span>]).intValue();</span><br><span class="line">        <span class="comment">//executeComplexQuery返回的是一个Object[] ,数值为long类型，不能直接转成int类型，所以先转成Long引用类型之后在用intValue()转为int类型</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之后在编写indexServlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Servlet从3.0版本开始支持注解方式的注册</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexServlet</span> <span class="keyword">extends</span> <span class="title class_">ViewBaseServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request , HttpServletResponse response)</span><span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">pageNo</span> <span class="operator">=</span> <span class="number">1</span> ;</span><br><span class="line">        <span class="type">String</span> <span class="variable">pageNoStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;pageNo&quot;</span>);  <span class="comment">//js返回的页</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtil.isNotEmpty(pageNoStr))&#123;</span><br><span class="line">            pageNo = Integer.parseInt(pageNoStr);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession() ;</span><br><span class="line">        session.setAttribute(<span class="string">&quot;pageNo&quot;</span>,pageNo);</span><br><span class="line"></span><br><span class="line">        <span class="type">FruitDAO</span> <span class="variable">fruitDAO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitDAOImpl</span>();</span><br><span class="line">        List&lt;Fruit&gt; fruitList = fruitDAO.getFruitList(pageNo);</span><br><span class="line"></span><br><span class="line">        session.setAttribute(<span class="string">&quot;fruitList&quot;</span>,fruitList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//总记录条数</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">fruitCount</span> <span class="operator">=</span> fruitDAO.getFruitCount();</span><br><span class="line">        <span class="comment">//总页数</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">pageCount</span> <span class="operator">=</span> (fruitCount+<span class="number">5</span>-<span class="number">1</span>)/<span class="number">5</span> ;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        总记录条数       总页数</span></span><br><span class="line"><span class="comment">        1               1</span></span><br><span class="line"><span class="comment">        5               1</span></span><br><span class="line"><span class="comment">        6               2</span></span><br><span class="line"><span class="comment">        10              2</span></span><br><span class="line"><span class="comment">        11              3</span></span><br><span class="line"><span class="comment">        fruitCount      (fruitCount+5-1)/5</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;pageCount&quot;</span>,pageCount);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//此处的视图名称是 index</span></span><br><span class="line">        <span class="comment">//那么thymeleaf会将这个 逻辑视图名称 对应到 物理视图 名称上去</span></span><br><span class="line">        <span class="comment">//逻辑视图名称 ：   index</span></span><br><span class="line">        <span class="comment">//物理视图名称 ：   view-prefix + 逻辑视图名称 + view-suffix</span></span><br><span class="line">        <span class="comment">//所以真实的视图名称是：      /       index       .html</span></span><br><span class="line">        <span class="built_in">super</span>.processTemplate(<span class="string">&quot;index&quot;</span>,request,response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="问题一：Tomcat热部署"><a href="#问题一：Tomcat热部署" class="headerlink" title="问题一：Tomcat热部署"></a>问题一：Tomcat热部署</h4><p>Tomcat热部署原因导刚修改的数据加载不上来，因此需要删除Artifact的项目模块，重启Tomcat造次加载</p>
<h3 id="4、添加add操作"><a href="#4、添加add操作" class="headerlink" title="4、添加add操作"></a>4、添加add操作</h3><h4 id="1）编写add-html页面"><a href="#1）编写add-html页面" class="headerlink" title="1）编写add.html页面"></a>1）编写add.html页面</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span>    <span class="comment">&lt;!--thymeleaf的声明--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/add.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_container&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_fruit_list&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;center f30&quot;</span>&gt;</span>新增库存信息<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;add.do&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">&quot;tbl_fruit&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>名称：<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!-- &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;fname&quot; th:value=&quot;$&#123;fruit.fname&#125;&quot;/&gt;&lt;/td&gt; --&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;fname&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>单价：<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;price&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>库存：<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;fcount&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>备注：<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;remark&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">th</span> <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;添加&quot;</span> /&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2）编写add-css样式"><a href="#2）编写add-css样式" class="headerlink" title="2）编写add.css样式"></a>2）编写add.css样式</h4><p>略</p>
<h4 id="3）编写addServlet"><a href="#3）编写addServlet" class="headerlink" title="3）编写addServlet"></a>3）编写addServlet</h4><p>在FruitDAO接口中添加addFruit方法，在FruitDAOImpl实现类中重写此方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FruitDAOImpl</span> <span class="keyword">extends</span> <span class="title class_">BaseDAO</span>&lt;Fruit&gt; <span class="keyword">implements</span> <span class="title class_">FruitDAO</span> &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFruit</span><span class="params">(Fruit fruit)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into t_fruit values(0,?,?,?,?)&quot;</span>;</span><br><span class="line">    <span class="built_in">super</span>.executeUpdate(sql,fruit.getFname(),fruit.getPrice(),fruit.getFcount(),fruit.getRemark());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之后进行编写addServlet类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/add.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddServlet</span> <span class="keyword">extends</span> <span class="title class_">ViewBaseServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">FruitDAO</span> <span class="variable">fruitDAO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitDAOImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">fname</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;fname&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">priceStr</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;price&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">price</span> <span class="operator">=</span> Integer.parseInt(priceStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">fcountStr</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;fcount&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">fcount</span> <span class="operator">=</span> Integer.parseInt(fcountStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">remark</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;remark&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Fruit</span> <span class="variable">fruit</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="number">0</span>,fname,price,fcount,remark);</span><br><span class="line">        fruitDAO.addFruit(fruit);</span><br><span class="line">        </span><br><span class="line">        resp.sendRedirect(<span class="string">&quot;index&quot;</span>); <span class="comment">//跳转回主页面的操作，使客户端向index.html请求</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="问题一：反射类型转换失败"><a href="#问题一：反射类型转换失败" class="headerlink" title="问题一：反射类型转换失败"></a>问题一：反射类型转换失败</h3><p>java.lang.Class cannot be cast to java.lang.reflect.ParameterizedType</p>
<p>解决方法：</p>
<ul>
<li>instanceof是Java中的二元<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E8%BF%90%E7%AE%97%E7%AC%A6&spm=1001.2101.3001.7020">运算符</a>，左边是对象，右边是类；当对象是右边类或子类所创建对象时，返回true；否则，返回false。</li>
<li>在强制转化<code>参数化类型</code> 当参数类型可能有多个泛型参数的时候<br>需要多一层判断是否包含 （此一个对象是否为一个类的实例）， 然后再执行逻辑代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">BaseDAO</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//getClass() 获取Class对象，当前我们执行的是new FruitDAOImpl() , 创建的是FruitDAOImpl的实例</span></span><br><span class="line">    <span class="comment">//那么子类构造方法内部首先会调用父类（BaseDAO）的无参构造方法</span></span><br><span class="line">    <span class="comment">//因此此处的getClass()会被执行，但是getClass获取的是FruitDAOImpl的Class</span></span><br><span class="line">    <span class="comment">//所以getGenericSuperclass()获取到的是BaseDAO的Class</span></span><br><span class="line">    <span class="type">Type</span> <span class="variable">genericType</span> <span class="operator">=</span> getClass().getGenericSuperclass();</span><br><span class="line">    <span class="comment">//ParameterizedType 参数化类型</span></span><br><span class="line">    <span class="keyword">if</span>(genericType <span class="keyword">instanceof</span> ParameterizedType)&#123;  <span class="comment">//添加类型判断</span></span><br><span class="line">        Type[] actualTypeArguments = ((ParameterizedType) genericType).getActualTypeArguments();</span><br><span class="line">        <span class="comment">//获取到的&lt;T&gt;中的T的真实的类型</span></span><br><span class="line">        <span class="type">Type</span> <span class="variable">actualType</span> <span class="operator">=</span> actualTypeArguments[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            entityClass = Class.forName(actualType.getTypeName());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="5、编辑edit操作"><a href="#5、编辑edit操作" class="headerlink" title="5、编辑edit操作"></a>5、编辑edit操作</h3><h4 id="1）编写edit-html页面"><a href="#1）编写edit-html页面" class="headerlink" title="1）编写edit.html页面"></a>1）编写edit.html页面</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/edit.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_container&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_fruit_list&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;center f30&quot;</span>&gt;</span>编辑库存信息3<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/update.do&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">th:object</span>=<span class="string">&quot;$&#123;fruit&#125;&quot;</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- 隐藏域 ： 功能类似于文本框 ， 它的值会随着表单的发送也会发送给服务器，但是界面上用户看不到 --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;fid&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;*&#123;fid&#125;&quot;</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">&quot;tbl_fruit&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>名称：<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!-- &lt;td=&quot;w20&quot;&gt;单价：&lt;/th&gt;</span></span><br><span class="line"><span class="comment">               &lt;td&gt;&lt;inpu&gt;&lt;input type=&quot;text&quot; name=&quot;fname&quot; th:value=&quot;$&#123;fruit.fname&#125;&quot;/&gt;&lt;/td&gt; --&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;fname&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;*&#123;fname&#125;&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">th</span> <span class="attr">classt</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;price&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;*&#123;price&#125;&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>库存：<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;fcount&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;*&#123;fcount&#125;&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>备注：<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;remark&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;*&#123;remark&#125;&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">th</span> <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;修改&quot;</span> /&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>问题一：</p>
<p>th:object&#x3D;”${fruit}   表示以下的调用，都是调用这个对象</p>
<p>th:value&#x3D;”*{fid}</p>
<p>问题二：</p>
<p>value表示文本框中的值</p>
<p>问题三：</p>
<p>此form表单在edit页面，点击修改则将数据发送至update.do</p>
</blockquote>
<h4 id="2）编写edit-css"><a href="#2）编写edit-css" class="headerlink" title="2）编写edit.css"></a>2）编写edit.css</h4><p>略</p>
<h4 id="3）编写editServlet"><a href="#3）编写editServlet" class="headerlink" title="3）编写editServlet"></a>3）编写editServlet</h4><p>在FruitDAO接口中添加getFruitByFid方法，在FruitDAOImpl实现类中重写此方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Fruit <span class="title function_">getFruitByFid</span><span class="params">(Integer fid)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.load(<span class="string">&quot;select * from t_fruit where fid= ?&quot;</span>,fid); <span class="comment">//返回查询的个体对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写editServlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/edit.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EditServlet</span> <span class="keyword">extends</span> <span class="title class_">ViewBaseServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">FruitDAO</span> <span class="variable">fruitDAO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitDAOImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request , HttpServletResponse response)</span><span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fidStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fid&quot;</span>); <span class="comment">//客户端在index页面请求edit页面发送过来的</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtil.isNotEmpty(fidStr))&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">fid</span> <span class="operator">=</span> Integer.parseInt(fidStr);</span><br><span class="line">            <span class="type">Fruit</span> <span class="variable">fruit</span> <span class="operator">=</span> fruitDAO.getFruitByFid(fid);</span><br><span class="line">            </span><br><span class="line">            request.setAttribute(<span class="string">&quot;fruit&quot;</span>,fruit); <span class="comment">//在一次请求中有效，设置在请求中</span></span><br><span class="line">            <span class="built_in">super</span>.processTemplate(<span class="string">&quot;edit&quot;</span>,request,response); <span class="comment">//在服务器端内部请求转发request给edit</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="6、更新update操作"><a href="#6、更新update操作" class="headerlink" title="6、更新update操作"></a>6、更新update操作</h3><p>在FruitDAO接口中添加updateFruit方法，在FruitDAOImpl实现类中重写此方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFruit</span><span class="params">(Fruit fruit)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update t_fruit set fname = ? , price = ? , fcount = ? , remark = ? where fid = ? &quot;</span> ;</span><br><span class="line">    <span class="built_in">super</span>.executeUpdate(sql,fruit.getFname(),fruit.getPrice(),fruit.getFcount(),fruit.getRemark(),fruit.getFid());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写updateServlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/update.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UpdateServlet</span> <span class="keyword">extends</span> <span class="title class_">ViewBaseServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">FruitDAO</span> <span class="variable">fruitDAO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitDAOImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1.设置编码</span></span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.获取参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fidStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fid&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">fid</span> <span class="operator">=</span> Integer.parseInt(fidStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">fname</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fname&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">priceStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;price&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">price</span> <span class="operator">=</span> Integer.parseInt(priceStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">fcountStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fcount&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">fcount</span> <span class="operator">=</span> Integer.parseInt(fcountStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">remark</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;remark&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.执行更新</span></span><br><span class="line">        fruitDAO.updateFruit(<span class="keyword">new</span> <span class="title class_">Fruit</span>(fid,fname, price ,fcount ,remark ));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.资源跳转</span></span><br><span class="line">        <span class="comment">//super.processTemplate(&quot;index&quot;,request,response);</span></span><br><span class="line">        <span class="comment">//相当于下面这句话，即服务器内资源重定向</span></span><br><span class="line">        <span class="comment">//request.getRequestDispatcher(&quot;index.html&quot;).forward(request,response);</span></span><br><span class="line">        <span class="comment">//因为index是用session保存数据的，所以刚刚更新的数据此时index的session还没有，所以不能用这个句话</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//此处需要重定向，目的是重新给IndexServlet发请求，重新获取furitList，然后覆盖到session中，这样index.html页面上显示的session中的数据才是最新的</span></span><br><span class="line">        response.sendRedirect(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="7、删除delete操作"><a href="#7、删除delete操作" class="headerlink" title="7、删除delete操作"></a>7、删除delete操作</h3><p>在FruitDAO接口中添加delFruit方法，在FruitDAOImpl实现类中重写此方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delFruit</span><span class="params">(Integer fid)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.executeUpdate(<span class="string">&quot;delete from t_fruit where fid = ? &quot;</span> , fid) ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写delServlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/del.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DelServlet</span> <span class="keyword">extends</span> <span class="title class_">ViewBaseServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">FruitDAO</span> <span class="variable">fruitDAO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitDAOImpl</span>();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request , HttpServletResponse response)</span><span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fidStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fid&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtil.isNotEmpty(fidStr))&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">fid</span> <span class="operator">=</span> Integer.parseInt(fidStr);</span><br><span class="line">            fruitDAO.delFruit(fid);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//super.processTemplate(&quot;index&quot;,request,response);</span></span><br><span class="line">            response.sendRedirect(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="8、整体的目录和工具类"><a href="#8、整体的目录和工具类" class="headerlink" title="8、整体的目录和工具类"></a>8、整体的目录和工具类</h3><img src="/2022/09/30/JavaWeb/image-20220704151614586.png" alt="image-20220704151614586" style="zoom:50%;">

<h4 id="BaseDAO"><a href="#BaseDAO" class="headerlink" title="BaseDAO"></a>BaseDAO</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">BaseDAO</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DRIVER</span> <span class="operator">=</span> <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span> ;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">URL</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">USER</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PWD</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span> ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> Connection conn ;</span><br><span class="line">    <span class="keyword">protected</span> PreparedStatement psmt ;</span><br><span class="line">    <span class="keyword">protected</span> ResultSet rs ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//T的Class对象</span></span><br><span class="line">    <span class="keyword">private</span> Class entityClass ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BaseDAO</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//getClass() 获取Class对象，当前我们执行的是new FruitDAOImpl() , 创建的是FruitDAOImpl的实例</span></span><br><span class="line">        <span class="comment">//那么子类构造方法内部首先会调用父类（BaseDAO）的无参构造方法</span></span><br><span class="line">        <span class="comment">//因此此处的getClass()会被执行，但是getClass获取的是FruitDAOImpl的Class</span></span><br><span class="line">        <span class="comment">//所以getGenericSuperclass()获取到的是BaseDAO的Class</span></span><br><span class="line">        <span class="type">Type</span> <span class="variable">genericType</span> <span class="operator">=</span> getClass().getGenericSuperclass();</span><br><span class="line">        <span class="comment">//ParameterizedType 参数化类型</span></span><br><span class="line">        Type[] actualTypeArguments = ((ParameterizedType) genericType).getActualTypeArguments();</span><br><span class="line">        <span class="comment">//获取到的&lt;T&gt;中的T的真实的类型</span></span><br><span class="line">        <span class="type">Type</span> <span class="variable">actualType</span> <span class="operator">=</span> actualTypeArguments[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            entityClass = Class.forName(actualType.getTypeName());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> Connection <span class="title function_">getConn</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1.加载驱动</span></span><br><span class="line">            Class.forName(DRIVER);</span><br><span class="line">            <span class="comment">//2.通过驱动管理器获取连接对象</span></span><br><span class="line">            <span class="keyword">return</span> DriverManager.getConnection(URL, USER, PWD);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException | SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">(ResultSet rs , PreparedStatement psmt , Connection conn)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (rs != <span class="literal">null</span>) &#123;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(psmt!=<span class="literal">null</span>)&#123;</span><br><span class="line">                psmt.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(conn!=<span class="literal">null</span> &amp;&amp; !conn.isClosed())&#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//给预处理命令对象设置参数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setParams</span><span class="params">(PreparedStatement psmt , Object... params)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="keyword">if</span>(params!=<span class="literal">null</span> &amp;&amp; params.length&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; params.length; i++) &#123;</span><br><span class="line">                psmt.setObject(i+<span class="number">1</span>,params[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//执行更新，返回影响行数</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> <span class="title function_">executeUpdate</span><span class="params">(String sql , Object... params)</span>&#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">insertFlag</span> <span class="operator">=</span> <span class="literal">false</span> ;</span><br><span class="line">        insertFlag = sql.trim().toUpperCase().startsWith(<span class="string">&quot;INSERT&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = getConn();</span><br><span class="line">            <span class="keyword">if</span>(insertFlag)&#123;</span><br><span class="line">                psmt = conn.prepareStatement(sql,Statement.RETURN_GENERATED_KEYS);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                psmt = conn.prepareStatement(sql);</span><br><span class="line">            &#125;</span><br><span class="line">            setParams(psmt,params);</span><br><span class="line">            <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> psmt.executeUpdate() ;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(insertFlag)&#123;</span><br><span class="line">                rs = psmt.getGeneratedKeys();</span><br><span class="line">                <span class="keyword">if</span>(rs.next())&#123;</span><br><span class="line">                    <span class="keyword">return</span> ((Long)rs.getLong(<span class="number">1</span>)).intValue();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> count ;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            close(rs,psmt,conn);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//通过反射技术给obj对象的property属性赋propertyValue值</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Object obj ,  String property , Object propertyValue)</span>&#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> obj.getClass();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//获取property这个字符串对应的属性名 ， 比如 &quot;fid&quot;  去找 obj对象中的 fid 属性</span></span><br><span class="line">            <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> clazz.getDeclaredField(property);</span><br><span class="line">            <span class="keyword">if</span>(field!=<span class="literal">null</span>)&#123;</span><br><span class="line">                field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                field.set(obj,propertyValue);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException | IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//执行复杂查询，返回例如统计结果</span></span><br><span class="line">    <span class="keyword">protected</span> Object[] executeComplexQuery(String sql , Object... params)&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = getConn() ;</span><br><span class="line">            psmt = conn.prepareStatement(sql);</span><br><span class="line">            setParams(psmt,params);</span><br><span class="line">            rs = psmt.executeQuery();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//通过rs可以获取结果集的元数据</span></span><br><span class="line">            <span class="comment">//元数据：描述结果集数据的数据 , 简单讲，就是这个结果集有哪些列，什么类型等等</span></span><br><span class="line"></span><br><span class="line">            <span class="type">ResultSetMetaData</span> <span class="variable">rsmd</span> <span class="operator">=</span> rs.getMetaData();</span><br><span class="line">            <span class="comment">//获取结果集的列数</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">columnCount</span> <span class="operator">=</span> rsmd.getColumnCount();</span><br><span class="line">            Object[] columnValueArr = <span class="keyword">new</span> <span class="title class_">Object</span>[columnCount];</span><br><span class="line">            <span class="comment">//6.解析rs</span></span><br><span class="line">            <span class="keyword">if</span>(rs.next())&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i&lt;columnCount;i++)&#123;</span><br><span class="line">                    <span class="type">Object</span> <span class="variable">columnValue</span> <span class="operator">=</span> rs.getObject(i+<span class="number">1</span>);     <span class="comment">//33    苹果      5</span></span><br><span class="line">                    columnValueArr[i]=columnValue;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> columnValueArr ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            close(rs,psmt,conn);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//执行查询，返回单个实体对象</span></span><br><span class="line">    <span class="keyword">protected</span> T <span class="title function_">load</span><span class="params">(String sql , Object... params)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = getConn() ;</span><br><span class="line">            psmt = conn.prepareStatement(sql);</span><br><span class="line">            setParams(psmt,params);</span><br><span class="line">            rs = psmt.executeQuery();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//通过rs可以获取结果集的元数据</span></span><br><span class="line">            <span class="comment">//元数据：描述结果集数据的数据 , 简单讲，就是这个结果集有哪些列，什么类型等等</span></span><br><span class="line"></span><br><span class="line">            <span class="type">ResultSetMetaData</span> <span class="variable">rsmd</span> <span class="operator">=</span> rs.getMetaData();</span><br><span class="line">            <span class="comment">//获取结果集的列数</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">columnCount</span> <span class="operator">=</span> rsmd.getColumnCount();</span><br><span class="line">            <span class="comment">//6.解析rs</span></span><br><span class="line">            <span class="keyword">if</span>(rs.next())&#123;</span><br><span class="line">                <span class="type">T</span> <span class="variable">entity</span> <span class="operator">=</span> (T)entityClass.newInstance();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i&lt;columnCount;i++)&#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">columnName</span> <span class="operator">=</span> rsmd.getColumnName(i+<span class="number">1</span>);            <span class="comment">//fid   fname   price</span></span><br><span class="line">                    <span class="type">Object</span> <span class="variable">columnValue</span> <span class="operator">=</span> rs.getObject(i+<span class="number">1</span>);     <span class="comment">//33    苹果      5</span></span><br><span class="line">                    setValue(entity,columnName,columnValue);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> entity ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            close(rs,psmt,conn);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//执行查询，返回List</span></span><br><span class="line">    <span class="keyword">protected</span> List&lt;T&gt; <span class="title function_">executeQuery</span><span class="params">(String sql , Object... params)</span>&#123;</span><br><span class="line">        List&lt;T&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = getConn() ;</span><br><span class="line">            psmt = conn.prepareStatement(sql);</span><br><span class="line">            setParams(psmt,params);</span><br><span class="line">            rs = psmt.executeQuery();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//通过rs可以获取结果集的元数据</span></span><br><span class="line">            <span class="comment">//元数据：描述结果集数据的数据 , 简单讲，就是这个结果集有哪些列，什么类型等等</span></span><br><span class="line"></span><br><span class="line">            <span class="type">ResultSetMetaData</span> <span class="variable">rsmd</span> <span class="operator">=</span> rs.getMetaData();</span><br><span class="line">            <span class="comment">//获取结果集的列数</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">columnCount</span> <span class="operator">=</span> rsmd.getColumnCount();</span><br><span class="line">            <span class="comment">//6.解析rs</span></span><br><span class="line">            <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">                <span class="type">T</span> <span class="variable">entity</span> <span class="operator">=</span> (T)entityClass.newInstance();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i&lt;columnCount;i++)&#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">columnName</span> <span class="operator">=</span> rsmd.getColumnName(i+<span class="number">1</span>);            <span class="comment">//fid   fname   price</span></span><br><span class="line">                    <span class="type">Object</span> <span class="variable">columnValue</span> <span class="operator">=</span> rs.getObject(i+<span class="number">1</span>);     <span class="comment">//33    苹果      5</span></span><br><span class="line">                    setValue(entity,columnName,columnValue);</span><br><span class="line">                &#125;</span><br><span class="line">                list.add(entity);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            close(rs,psmt,conn);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ViewBaseServlet"><a href="#ViewBaseServlet" class="headerlink" title="ViewBaseServlet"></a>ViewBaseServlet</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ViewBaseServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TemplateEngine templateEngine;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.获取ServletContext对象</span></span><br><span class="line">        <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> <span class="built_in">this</span>.getServletContext();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.创建Thymeleaf解析器对象</span></span><br><span class="line">        <span class="type">ServletContextTemplateResolver</span> <span class="variable">templateResolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletContextTemplateResolver</span>(servletContext);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.给解析器对象设置参数</span></span><br><span class="line">        <span class="comment">// ①HTML是默认模式，明确设置是为了代码更容易理解</span></span><br><span class="line">        templateResolver.setTemplateMode(TemplateMode.HTML);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ②设置前缀</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">viewPrefix</span> <span class="operator">=</span> servletContext.getInitParameter(<span class="string">&quot;view-prefix&quot;</span>);</span><br><span class="line"></span><br><span class="line">        templateResolver.setPrefix(viewPrefix);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ③设置后缀</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">viewSuffix</span> <span class="operator">=</span> servletContext.getInitParameter(<span class="string">&quot;view-suffix&quot;</span>);</span><br><span class="line"></span><br><span class="line">        templateResolver.setSuffix(viewSuffix);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ④设置缓存过期时间（毫秒）</span></span><br><span class="line">        templateResolver.setCacheTTLMs(<span class="number">60000L</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ⑤设置是否缓存</span></span><br><span class="line">        templateResolver.setCacheable(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ⑥设置服务器端编码方式</span></span><br><span class="line">        templateResolver.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.创建模板引擎对象</span></span><br><span class="line">        templateEngine = <span class="keyword">new</span> <span class="title class_">TemplateEngine</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.给模板引擎对象设置模板解析器</span></span><br><span class="line">        templateEngine.setTemplateResolver(templateResolver);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">processTemplate</span><span class="params">(String templateName, HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1.设置响应体内容类型和字符集</span></span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.创建WebContext对象</span></span><br><span class="line">        <span class="type">WebContext</span> <span class="variable">webContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebContext</span>(req, resp, getServletContext());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.处理模板数据</span></span><br><span class="line">        templateEngine.process(templateName, webContext, resp.getWriter());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="StringUtil"><a href="#StringUtil" class="headerlink" title="StringUtil"></a>StringUtil</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringUtil</span> &#123;</span><br><span class="line">    <span class="comment">//判断字符串是否为null或者&quot;&quot;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">(String str)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> str==<span class="literal">null</span> || <span class="string">&quot;&quot;</span>.equals(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isNotEmpty</span><span class="params">(String str)</span>&#123; <span class="keyword">return</span> !isEmpty(str); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="9、增添查询功能"><a href="#9、增添查询功能" class="headerlink" title="9、增添查询功能"></a>9、增添查询功能</h3><p>查询功能：根据在form表单中输入关键字，发送至服务端，返回fname或remark中存在关键字的库存记录，还是按显示出来。</p>
<p>由于此功能除了与index基本相似，区别在于index查询显示全部数据，而这是通过查询匹配的关键的数据因此在index.html中增加form表单文本框，发送indexServlet</p>
<p><img src="/2022/09/30/JavaWeb/image-20220705111704829.png" alt="image-20220705111704829"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;border:0px solid red;width:60%;margin-left:20%;text-align:right;&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/index&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">style</span>=<span class="string">&quot;float:left;width:60%;margin-left:20%;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;oper&quot;</span> <span class="attr">value</span>=<span class="string">&quot;search&quot;</span>/&gt;</span></span><br><span class="line">      请输入关键字：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;keyword&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;session.keyword&#125;&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;查询&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/add.html&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;border:0px solid blue;margin-bottom:4px;&quot;</span>&gt;</span>添加新库存记录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>对应的sql修改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Fruit&gt; <span class="title function_">getFruitList</span><span class="params">(String keyword , Integer pageNo)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.executeQuery(<span class="string">&quot;select * from t_fruit where fname like ? or remark like ? limit ? , 5&quot;</span> ,<span class="string">&quot;%&quot;</span>+keyword+<span class="string">&quot;%&quot;</span>,<span class="string">&quot;%&quot;</span>+keyword+<span class="string">&quot;%&quot;</span>, (pageNo-<span class="number">1</span>)*<span class="number">5</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>index修改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexServlet</span> <span class="keyword">extends</span> <span class="title class_">ViewBaseServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doGet(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request , HttpServletResponse response)</span><span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">       <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession() ;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置当前页，默认值1</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">pageNo</span> <span class="operator">=</span> <span class="number">1</span> ;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">oper</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;oper&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果oper!=null 说明 通过表单的查询按钮点击过来的</span></span><br><span class="line">        <span class="comment">//如果oper是空的，说明 不是通过表单的查询按钮点击过来的</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">keyword</span> <span class="operator">=</span> <span class="literal">null</span> ;</span><br><span class="line">        <span class="keyword">if</span>(StringUtil.isNotEmpty(oper) &amp;&amp; <span class="string">&quot;search&quot;</span>.equals(oper))&#123;</span><br><span class="line">            <span class="comment">//说明是点击表单查询发送过来的请求</span></span><br><span class="line">            <span class="comment">//此时，pageNo应该还原为1 ， keyword应该从请求参数中获取</span></span><br><span class="line">            pageNo = <span class="number">1</span> ;</span><br><span class="line">            keyword = request.getParameter(<span class="string">&quot;keyword&quot;</span>);</span><br><span class="line">            <span class="comment">//如果keyword为null，需要设置为空字符串&quot;&quot;，否则查询时会拼接成 %null% , 我们期望的是 %%</span></span><br><span class="line">            <span class="keyword">if</span>(StringUtil.isEmpty(keyword))&#123;</span><br><span class="line">                keyword = <span class="string">&quot;&quot;</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//将keyword保存（覆盖）到session中，便于查找上一页或下一页时使用</span></span><br><span class="line">            session.setAttribute(<span class="string">&quot;keyword&quot;</span>,keyword);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//说明此处不是点击表单查询发送过来的请求（比如点击下面的上一页下一页或者直接在地址栏输入网址）</span></span><br><span class="line">            <span class="comment">//此时keyword应该从session作用域获取</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">pageNoStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;pageNo&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(StringUtil.isNotEmpty(pageNoStr))&#123;</span><br><span class="line">                pageNo = Integer.parseInt(pageNoStr);   <span class="comment">//如果从请求中读取到pageNo，则类型转换。否则，pageNo默认就是1</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//如果不是点击的查询按钮，那么查询是基于session中保存的现有keyword进行查询</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">keywordObj</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;keyword&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(keywordObj!=<span class="literal">null</span>)&#123;</span><br><span class="line">                keyword = (String)keywordObj ;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                keyword = <span class="string">&quot;&quot;</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 重新更新当前页的值</span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;pageNo&quot;</span>,pageNo);</span><br><span class="line"></span><br><span class="line">        <span class="type">FruitDAO</span> <span class="variable">fruitDAO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitDAOImpl</span>();</span><br><span class="line">        List&lt;Fruit&gt; fruitList = fruitDAO.getFruitList(keyword , pageNo);</span><br><span class="line">        session.setAttribute(<span class="string">&quot;fruitList&quot;</span>,fruitList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//总记录条数</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">fruitCount</span> <span class="operator">=</span> fruitDAO.getFruitCount(keyword);</span><br><span class="line">        <span class="comment">//总页数</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">pageCount</span> <span class="operator">=</span> (fruitCount+<span class="number">5</span>-<span class="number">1</span>)/<span class="number">5</span> ;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        总记录条数       总页数</span></span><br><span class="line"><span class="comment">        1               1</span></span><br><span class="line"><span class="comment">        5               1</span></span><br><span class="line"><span class="comment">        6               2</span></span><br><span class="line"><span class="comment">        10              2</span></span><br><span class="line"><span class="comment">        11              3</span></span><br><span class="line"><span class="comment">        fruitCount      (fruitCount+5-1)/5</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;pageCount&quot;</span>,pageCount);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//此处的视图名称是 index</span></span><br><span class="line">        <span class="comment">//那么thymeleaf会将这个 逻辑视图名称 对应到 物理视图 名称上去</span></span><br><span class="line">        <span class="comment">//逻辑视图名称 ：   index</span></span><br><span class="line">        <span class="comment">//物理视图名称 ：   view-prefix + 逻辑视图名称 + view-suffix</span></span><br><span class="line">        <span class="comment">//所以真实的视图名称是：      /       index       .html</span></span><br><span class="line">        <span class="built_in">super</span>.processTemplate(<span class="string">&quot;index&quot;</span>,request,response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="水果系统-优化1"><a href="#水果系统-优化1" class="headerlink" title="水果系统-优化1"></a>水果系统-优化1</h2><h3 id="原始项目简图"><a href="#原始项目简图" class="headerlink" title="原始项目简图"></a>原始项目简图</h3><p><img src="/2022/09/30/JavaWeb/image-20220705114314955.png" alt="image-20220705114314955"></p>
<blockquote>
<p>缺点是客户端需要向多个Servlet发送请求，结构混乱</p>
</blockquote>
<h3 id="优化1简图"><a href="#优化1简图" class="headerlink" title="优化1简图"></a>优化1简图</h3><p><img src="/2022/09/30/JavaWeb/image-20220705114518645.png" alt="image-20220705114518645"></p>
<blockquote>
<p>建立一个总Serlvet，根据请求中的operate调用相应Servlet</p>
</blockquote>
<h3 id="修改html"><a href="#修改html" class="headerlink" title="修改html"></a>修改html</h3><p><img src="/2022/09/30/JavaWeb/image-20220705115816559.png" alt="image-20220705115816559"></p>
<blockquote>
<p>提供operate信息，全部请求发送至fruit.do ，FruitServlet根据operate调用相关Servlet</p>
</blockquote>
<h3 id="优化1-编写FruitServlet-switch"><a href="#优化1-编写FruitServlet-switch" class="headerlink" title="优化1.编写FruitServlet-switch"></a>优化1.编写FruitServlet-switch</h3><p>这里使用switch进行区分不同操作而调用相应方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/fruit.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FruitServlet</span> <span class="keyword">extends</span> <span class="title class_">ViewBaseServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">FruitDAO</span> <span class="variable">fruitDAO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitDAOImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//设置编码</span></span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">operate</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;operate&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtil.isEmpty(operate))&#123; <span class="comment">//没有其余操作，默认跳转index</span></span><br><span class="line">            operate = <span class="string">&quot;index&quot;</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span>(operate)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;index&quot;</span>:</span><br><span class="line">                index(request,response);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;add&quot;</span>:</span><br><span class="line">                add(request,response);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;del&quot;</span>:</span><br><span class="line">                del(request,response);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;edit&quot;</span>:</span><br><span class="line">                edit(request,response);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;update&quot;</span>:</span><br><span class="line">                update(request,response);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;operate值非法!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1.设置编码</span></span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.获取参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fidStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fid&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">fid</span> <span class="operator">=</span> Integer.parseInt(fidStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">fname</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fname&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">priceStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;price&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">price</span> <span class="operator">=</span> Integer.parseInt(priceStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">fcountStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fcount&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">fcount</span> <span class="operator">=</span> Integer.parseInt(fcountStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">remark</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;remark&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.执行更新</span></span><br><span class="line">        fruitDAO.updateFruit(<span class="keyword">new</span> <span class="title class_">Fruit</span>(fid,fname, price ,fcount ,remark ));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.资源跳转</span></span><br><span class="line">        <span class="comment">//super.processTemplate(&quot;index&quot;,request,response);</span></span><br><span class="line">        <span class="comment">//request.getRequestDispatcher(&quot;index.html&quot;).forward(request,response);</span></span><br><span class="line">        <span class="comment">//此处需要重定向，目的是重新给IndexServlet发请求，重新获取furitList，然后覆盖到session中，这样index.html页面上显示的session中的数据才是最新的</span></span><br><span class="line">        response.sendRedirect(<span class="string">&quot;fruit.do&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">edit</span><span class="params">(HttpServletRequest request , HttpServletResponse response)</span><span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fidStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fid&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtil.isNotEmpty(fidStr))&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">fid</span> <span class="operator">=</span> Integer.parseInt(fidStr);</span><br><span class="line">            <span class="type">Fruit</span> <span class="variable">fruit</span> <span class="operator">=</span> fruitDAO.getFruitByFid(fid);</span><br><span class="line">            request.setAttribute(<span class="string">&quot;fruit&quot;</span>,fruit);</span><br><span class="line">            <span class="built_in">super</span>.processTemplate(<span class="string">&quot;edit&quot;</span>,request,response);  <span class="comment">//找到edit.html，将数据渲染上去</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">del</span><span class="params">(HttpServletRequest request , HttpServletResponse response)</span><span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fidStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fid&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtil.isNotEmpty(fidStr))&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">fid</span> <span class="operator">=</span> Integer.parseInt(fidStr);</span><br><span class="line">            fruitDAO.delFruit(fid);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//super.processTemplate(&quot;index&quot;,request,response);</span></span><br><span class="line">            response.sendRedirect(<span class="string">&quot;fruit.do&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">fname</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fname&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">price</span> <span class="operator">=</span> Integer.parseInt(request.getParameter(<span class="string">&quot;price&quot;</span>)) ;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">fcount</span> <span class="operator">=</span> Integer.parseInt(request.getParameter(<span class="string">&quot;fcount&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">remark</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;remark&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Fruit</span> <span class="variable">fruit</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="number">0</span>,fname , price , fcount , remark ) ;</span><br><span class="line"></span><br><span class="line">        fruitDAO.addFruit(fruit);</span><br><span class="line"></span><br><span class="line">        response.sendRedirect(<span class="string">&quot;fruit.do&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">index</span><span class="params">(HttpServletRequest request , HttpServletResponse response)</span><span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession() ;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置当前页，默认值1</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">pageNo</span> <span class="operator">=</span> <span class="number">1</span> ;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">oper</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;oper&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果oper!=null 说明 通过表单的查询按钮点击过来的</span></span><br><span class="line">        <span class="comment">//如果oper是空的，说明 不是通过表单的查询按钮点击过来的</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">keyword</span> <span class="operator">=</span> <span class="literal">null</span> ;</span><br><span class="line">        <span class="keyword">if</span>(StringUtil.isNotEmpty(oper) &amp;&amp; <span class="string">&quot;search&quot;</span>.equals(oper))&#123;</span><br><span class="line">            <span class="comment">//说明是点击表单查询发送过来的请求</span></span><br><span class="line">            <span class="comment">//此时，pageNo应该还原为1 ， keyword应该从请求参数中获取</span></span><br><span class="line">            pageNo = <span class="number">1</span> ;</span><br><span class="line">            keyword = request.getParameter(<span class="string">&quot;keyword&quot;</span>);</span><br><span class="line">            <span class="comment">//如果keyword为null，需要设置为空字符串&quot;&quot;，否则查询时会拼接成 %null% , 我们期望的是 %%</span></span><br><span class="line">            <span class="keyword">if</span>(StringUtil.isEmpty(keyword))&#123;</span><br><span class="line">                keyword = <span class="string">&quot;&quot;</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//将keyword保存（覆盖）到session中</span></span><br><span class="line">            session.setAttribute(<span class="string">&quot;keyword&quot;</span>,keyword);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//说明此处不是点击表单查询发送过来的请求（比如点击下面的上一页下一页或者直接在地址栏输入网址）</span></span><br><span class="line">            <span class="comment">//此时keyword应该从session作用域获取</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">pageNoStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;pageNo&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(StringUtil.isNotEmpty(pageNoStr))&#123;</span><br><span class="line">                pageNo = Integer.parseInt(pageNoStr);   <span class="comment">//如果从请求中读取到pageNo，则类型转换。否则，pageNo默认就是1</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//如果不是点击的查询按钮，那么查询是基于session中保存的现有keyword进行查询</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">keywordObj</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;keyword&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(keywordObj!=<span class="literal">null</span>)&#123;</span><br><span class="line">                keyword = (String)keywordObj ;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                keyword = <span class="string">&quot;&quot;</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 重新更新当前页的值</span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;pageNo&quot;</span>,pageNo);</span><br><span class="line"></span><br><span class="line">        <span class="type">FruitDAO</span> <span class="variable">fruitDAO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitDAOImpl</span>();</span><br><span class="line">        List&lt;Fruit&gt; fruitList = fruitDAO.getFruitList(keyword , pageNo);</span><br><span class="line">        session.setAttribute(<span class="string">&quot;fruitList&quot;</span>,fruitList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//总记录条数</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">fruitCount</span> <span class="operator">=</span> fruitDAO.getFruitCount(keyword);</span><br><span class="line">        <span class="comment">//总页数</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">pageCount</span> <span class="operator">=</span> (fruitCount+<span class="number">5</span>-<span class="number">1</span>)/<span class="number">5</span> ;</span><br><span class="line">       </span><br><span class="line">        session.setAttribute(<span class="string">&quot;pageCount&quot;</span>,pageCount);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//那么thymeleaf会将这个 逻辑视图名称 对应到 物理视图 名称上去</span></span><br><span class="line">        <span class="built_in">super</span>.processTemplate(<span class="string">&quot;index&quot;</span>,request,response); <span class="comment">//找到index.html，将数据渲染上去</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="优化1-5编写FruitServlet-反射"><a href="#优化1-5编写FruitServlet-反射" class="headerlink" title="优化1.5编写FruitServlet-反射"></a>优化1.5编写FruitServlet-反射</h2><p>由于优化1使用switch进行区分调用operate相应方法，如果方法很多，switch显得笨拙，这里将使用反射机制，将本类同名方法找出</p>
<p>只需要重写修改service方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//设置编码</span></span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">operate</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;operate&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtil.isEmpty(operate))&#123;</span><br><span class="line">            operate = <span class="string">&quot;index&quot;</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> <span class="built_in">this</span>.getClass().getDeclaredMethod(operate,HttpServletRequest.class,HttpServletResponse.class);</span><br><span class="line">            <span class="keyword">if</span>(method!=<span class="literal">null</span>)&#123;</span><br><span class="line">                method.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                method.invoke(<span class="built_in">this</span>,request,response);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;operate值非法!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>





<h2 id="水果系统-优化2"><a href="#水果系统-优化2" class="headerlink" title="水果系统-优化2"></a>水果系统-优化2</h2><h3 id="DispatcherServlet的引入"><a href="#DispatcherServlet的引入" class="headerlink" title="DispatcherServlet的引入"></a>DispatcherServlet的引入</h3><p><img src="/2022/09/30/JavaWeb/image-20220705171834121.png" alt="image-20220705171834121"></p>
<p>随着组件的增多，每个组件又有很多功能，因此将各个组件有中央控制器来控制调用</p>
<h3 id="DispatcherServlet"><a href="#DispatcherServlet" class="headerlink" title="DispatcherServlet"></a>DispatcherServlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;*.do&quot;)</span>  <span class="comment">//&quot;*&quot; 表任意字符，后带.do的可以匹配此Servlet</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DispatcherServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; beanMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DispatcherServlet</span><span class="params">()</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">//初始化方法：从xml中读取控制器（类名和位置），创建控制器实例，将所有实例保存至beanMap中</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> getClass().getClassLoader().getResourceAsStream(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">            <span class="comment">//1.创建DocumentBuilderFactory</span></span><br><span class="line">            <span class="type">DocumentBuilderFactory</span> <span class="variable">documentBuilderFactory</span> <span class="operator">=</span> DocumentBuilderFactory.newInstance();</span><br><span class="line">            <span class="comment">//2.创建DocumentBuilder对象</span></span><br><span class="line">            <span class="type">DocumentBuilder</span> <span class="variable">documentBuilder</span> <span class="operator">=</span> documentBuilderFactory.newDocumentBuilder() ;</span><br><span class="line">            <span class="comment">//3.创建Document对象</span></span><br><span class="line">            <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> documentBuilder.parse(inputStream);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//4.获取所有的bean节点</span></span><br><span class="line">            <span class="type">NodeList</span> <span class="variable">beanNodeList</span> <span class="operator">=</span> document.getElementsByTagName(<span class="string">&quot;bean&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i&lt;beanNodeList.getLength() ; i++)&#123;</span><br><span class="line">                <span class="type">Node</span> <span class="variable">beanNode</span> <span class="operator">=</span> beanNodeList.item(i);</span><br><span class="line">                <span class="keyword">if</span>(beanNode.getNodeType() == Node.ELEMENT_NODE)&#123;  <span class="comment">//是不是元素节点</span></span><br><span class="line">                    <span class="type">Element</span> <span class="variable">beanElement</span> <span class="operator">=</span> (Element)beanNode ;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">beanId</span> <span class="operator">=</span>  beanElement.getAttribute(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">                    <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> beanElement.getAttribute(<span class="string">&quot;class&quot;</span>);</span><br><span class="line">                    <span class="type">Class</span> <span class="variable">controllerBeanClass</span> <span class="operator">=</span> Class.forName(className);</span><br><span class="line">                    <span class="type">Object</span> <span class="variable">beanObj</span> <span class="operator">=</span> controllerBeanClass.newInstance() ;</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">//由于控制器没有setServletContext</span></span><br><span class="line">                    <span class="comment">//所以在这里顺便将setServletContext传给它</span></span><br><span class="line">                    <span class="type">Method</span> <span class="variable">setServletContextMethod</span> <span class="operator">=</span> controllerBeanClass.getDeclaredMethod(<span class="string">&quot;setServletContext&quot;</span>,ServletContext.class);</span><br><span class="line">                    setServletContextMethod.invoke(beanObj , <span class="built_in">this</span>.getServletContext());</span><br><span class="line"></span><br><span class="line">                    beanMap.put(beanId , beanObj) ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//设置编码</span></span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="comment">//假设url是：  http://localhost:8080/pro15/hello.do</span></span><br><span class="line">        <span class="comment">//那么servletPath是：    /hello.do</span></span><br><span class="line">        <span class="comment">// 我的思路是：</span></span><br><span class="line">        <span class="comment">// 第1步： /hello.do -&gt;   hello   或者  /fruit.do  -&gt; fruit</span></span><br><span class="line">        <span class="comment">// 第2步： hello -&gt; HelloController 或者 fruit -&gt; FruitController</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">servletPath</span> <span class="operator">=</span> request.getServletPath(); <span class="comment">//具体控制器名称</span></span><br><span class="line">        servletPath = servletPath.substring(<span class="number">1</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">lastDotIndex</span> <span class="operator">=</span> servletPath.lastIndexOf(<span class="string">&quot;.do&quot;</span>) ;</span><br><span class="line">        servletPath = servletPath.substring(<span class="number">0</span>,lastDotIndex); <span class="comment">// 去掉/ 和.do 的字符</span></span><br><span class="line">		</span><br><span class="line">    	<span class="comment">//用servletPath就可获取对应的对象</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">controllerBeanObj</span> <span class="operator">=</span> beanMap.get(servletPath);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">operate</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;operate&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtil.isEmpty(operate))&#123;</span><br><span class="line">            operate = <span class="string">&quot;index&quot;</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> controllerBeanObj.getClass().getDeclaredMethod(operate,HttpServletRequest.class,HttpServletResponse.class);</span><br><span class="line">            <span class="keyword">if</span>(method!=<span class="literal">null</span>)&#123;</span><br><span class="line">                method.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                method.invoke(controllerBeanObj,request,response);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;operate值非法!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ViewBaseServlet-1"><a href="#ViewBaseServlet-1" class="headerlink" title="ViewBaseServlet"></a>ViewBaseServlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ViewBaseServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TemplateEngine templateEngine;</span><br><span class="line">    <span class="keyword">private</span> ServletContext servletContext ;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ServletContext servletContext)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        <span class="built_in">this</span>.servletContext = servletContext ;</span><br><span class="line">        <span class="comment">// 1.获取ServletContext对象</span></span><br><span class="line">        <span class="comment">//ServletContext servletContext = this.getServletContext();</span></span><br><span class="line">        <span class="comment">// 2.创建Thymeleaf解析器对象</span></span><br><span class="line">        <span class="type">ServletContextTemplateResolver</span> <span class="variable">templateResolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletContextTemplateResolver</span>(servletContext);</span><br><span class="line">        <span class="comment">// 3.给解析器对象设置参数</span></span><br><span class="line">        <span class="comment">// ①HTML是默认模式，明确设置是为了代码更容易理解</span></span><br><span class="line">        templateResolver.setTemplateMode(TemplateMode.HTML);</span><br><span class="line">        <span class="comment">// ②设置前缀</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">viewPrefix</span> <span class="operator">=</span> servletContext.getInitParameter(<span class="string">&quot;view-prefix&quot;</span>);</span><br><span class="line">        templateResolver.setPrefix(viewPrefix);</span><br><span class="line">        <span class="comment">// ③设置后缀</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">viewSuffix</span> <span class="operator">=</span> servletContext.getInitParameter(<span class="string">&quot;view-suffix&quot;</span>);</span><br><span class="line">        templateResolver.setSuffix(viewSuffix);</span><br><span class="line">        <span class="comment">// ④设置缓存过期时间（毫秒）</span></span><br><span class="line">        templateResolver.setCacheTTLMs(<span class="number">60000L</span>);</span><br><span class="line">        <span class="comment">// ⑤设置是否缓存</span></span><br><span class="line">        templateResolver.setCacheable(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// ⑥设置服务器端编码方式</span></span><br><span class="line">        templateResolver.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        <span class="comment">// 4.创建模板引擎对象</span></span><br><span class="line">        templateEngine = <span class="keyword">new</span> <span class="title class_">TemplateEngine</span>();</span><br><span class="line">        <span class="comment">// 5.给模板引擎对象设置模板解析器</span></span><br><span class="line">        templateEngine.setTemplateResolver(templateResolver);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">processTemplate</span><span class="params">(String templateName, HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1.设置响应体内容类型和字符集</span></span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.创建WebContext对象</span></span><br><span class="line">        <span class="type">WebContext</span> <span class="variable">webContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebContext</span>(req, resp, <span class="built_in">this</span>.servletContext);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.处理模板数据</span></span><br><span class="line">        templateEngine.process(templateName, webContext, resp.getWriter());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="FruitController"><a href="#FruitController" class="headerlink" title="FruitController"></a>FruitController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FruitController</span> <span class="keyword">extends</span> <span class="title class_">ViewBaseServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//之前FruitServlet是一个Sevlet组件，那么其中的init方法一定会被调用 </span></span><br><span class="line">    <span class="comment">//之前的init方法内部会出现一句话：super.init();</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ServletContext servletContext ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setServletContext</span><span class="params">(ServletContext servletContext)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        <span class="built_in">this</span>.servletContext = servletContext;</span><br><span class="line">        <span class="built_in">super</span>.init(servletContext);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">FruitDAO</span> <span class="variable">fruitDAO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitDAOImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1.设置编码</span></span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.获取参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fidStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fid&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">fid</span> <span class="operator">=</span> Integer.parseInt(fidStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">fname</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fname&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">priceStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;price&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">price</span> <span class="operator">=</span> Integer.parseInt(priceStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">fcountStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fcount&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">fcount</span> <span class="operator">=</span> Integer.parseInt(fcountStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">remark</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;remark&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.执行更新</span></span><br><span class="line">        fruitDAO.updateFruit(<span class="keyword">new</span> <span class="title class_">Fruit</span>(fid,fname, price ,fcount ,remark ));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.资源跳转</span></span><br><span class="line">        <span class="comment">//super.processTemplate(&quot;index&quot;,request,response);</span></span><br><span class="line">        <span class="comment">//request.getRequestDispatcher(&quot;index.html&quot;).forward(request,response);</span></span><br><span class="line">        <span class="comment">//此处需要重定向，目的是重新给IndexServlet发请求，重新获取furitList，然后覆盖到session中，这样index.html页面上显示的session中的数据才是最新的</span></span><br><span class="line">        response.sendRedirect(<span class="string">&quot;fruit.do&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">edit</span><span class="params">(HttpServletRequest request , HttpServletResponse response)</span><span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fidStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fid&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtil.isNotEmpty(fidStr))&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">fid</span> <span class="operator">=</span> Integer.parseInt(fidStr);</span><br><span class="line">            <span class="type">Fruit</span> <span class="variable">fruit</span> <span class="operator">=</span> fruitDAO.getFruitByFid(fid);</span><br><span class="line">            request.setAttribute(<span class="string">&quot;fruit&quot;</span>,fruit);</span><br><span class="line">            <span class="built_in">super</span>.processTemplate(<span class="string">&quot;edit&quot;</span>,request,response);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">del</span><span class="params">(HttpServletRequest request , HttpServletResponse response)</span><span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fidStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fid&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtil.isNotEmpty(fidStr))&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">fid</span> <span class="operator">=</span> Integer.parseInt(fidStr);</span><br><span class="line">            fruitDAO.delFruit(fid);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//super.processTemplate(&quot;index&quot;,request,response);</span></span><br><span class="line">            response.sendRedirect(<span class="string">&quot;fruit.do&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">fname</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fname&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">price</span> <span class="operator">=</span> Integer.parseInt(request.getParameter(<span class="string">&quot;price&quot;</span>)) ;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">fcount</span> <span class="operator">=</span> Integer.parseInt(request.getParameter(<span class="string">&quot;fcount&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">remark</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;remark&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Fruit</span> <span class="variable">fruit</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="number">0</span>,fname , price , fcount , remark ) ;</span><br><span class="line"></span><br><span class="line">        fruitDAO.addFruit(fruit);</span><br><span class="line"></span><br><span class="line">        response.sendRedirect(<span class="string">&quot;fruit.do&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">index</span><span class="params">(HttpServletRequest request , HttpServletResponse response)</span><span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession() ;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置当前页，默认值1</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">pageNo</span> <span class="operator">=</span> <span class="number">1</span> ;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">oper</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;oper&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果oper!=null 说明 通过表单的查询按钮点击过来的</span></span><br><span class="line">        <span class="comment">//如果oper是空的，说明 不是通过表单的查询按钮点击过来的</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">keyword</span> <span class="operator">=</span> <span class="literal">null</span> ;</span><br><span class="line">        <span class="keyword">if</span>(StringUtil.isNotEmpty(oper) &amp;&amp; <span class="string">&quot;search&quot;</span>.equals(oper))&#123;</span><br><span class="line">            <span class="comment">//说明是点击表单查询发送过来的请求</span></span><br><span class="line">            <span class="comment">//此时，pageNo应该还原为1 ， keyword应该从请求参数中获取</span></span><br><span class="line">            pageNo = <span class="number">1</span> ;</span><br><span class="line">            keyword = request.getParameter(<span class="string">&quot;keyword&quot;</span>);</span><br><span class="line">            <span class="comment">//如果keyword为null，需要设置为空字符串&quot;&quot;，否则查询时会拼接成 %null% , 我们期望的是 %%</span></span><br><span class="line">            <span class="keyword">if</span>(StringUtil.isEmpty(keyword))&#123;</span><br><span class="line">                keyword = <span class="string">&quot;&quot;</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//将keyword保存（覆盖）到session中</span></span><br><span class="line">            session.setAttribute(<span class="string">&quot;keyword&quot;</span>,keyword);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//说明此处不是点击表单查询发送过来的请求（比如点击下面的上一页下一页或者直接在地址栏输入网址）</span></span><br><span class="line">            <span class="comment">//此时keyword应该从session作用域获取</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">pageNoStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;pageNo&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(StringUtil.isNotEmpty(pageNoStr))&#123;</span><br><span class="line">                pageNo = Integer.parseInt(pageNoStr);   <span class="comment">//如果从请求中读取到pageNo，则类型转换。否则，pageNo默认就是1</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//如果不是点击的查询按钮，那么查询是基于session中保存的现有keyword进行查询</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">keywordObj</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;keyword&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(keywordObj!=<span class="literal">null</span>)&#123;</span><br><span class="line">                keyword = (String)keywordObj ;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                keyword = <span class="string">&quot;&quot;</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 重新更新当前页的值</span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;pageNo&quot;</span>,pageNo);</span><br><span class="line"></span><br><span class="line">        <span class="type">FruitDAO</span> <span class="variable">fruitDAO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitDAOImpl</span>();</span><br><span class="line">        List&lt;Fruit&gt; fruitList = fruitDAO.getFruitList(keyword , pageNo);</span><br><span class="line">        session.setAttribute(<span class="string">&quot;fruitList&quot;</span>,fruitList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//总记录条数</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">fruitCount</span> <span class="operator">=</span> fruitDAO.getFruitCount(keyword);</span><br><span class="line">        <span class="comment">//总页数</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">pageCount</span> <span class="operator">=</span> (fruitCount+<span class="number">5</span>-<span class="number">1</span>)/<span class="number">5</span> ;</span><br><span class="line">      </span><br><span class="line">        session.setAttribute(<span class="string">&quot;pageCount&quot;</span>,pageCount);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">super</span>.processTemplate(<span class="string">&quot;index&quot;</span>,request,response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="applicationContext-xml"><a href="#applicationContext-xml" class="headerlink" title="applicationContext.xml"></a>applicationContext.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 这个bean标签的作用是 将来servletpath中涉及的名字对应的是fruit，那么就要FruitController这个类来处理 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;fruit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.fruit.controllers.FruitController&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">1.概念</span></span><br><span class="line"><span class="comment">HTML : 超文本标记语言</span></span><br><span class="line"><span class="comment">XML : 可扩展的标记语言 （标签名字可自定义）</span></span><br><span class="line"><span class="comment">HTML是XML的一个子集</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">2.XML包含三个部分：</span></span><br><span class="line"><span class="comment">1) XML声明 ， 而且声明这一行代码必须在XML文件的第一行</span></span><br><span class="line"><span class="comment">2) DTD 文档类型定义</span></span><br><span class="line"><span class="comment">3) XML正文</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="思路即问题的总结"><a href="#思路即问题的总结" class="headerlink" title="思路即问题的总结"></a>思路即问题的总结</h3><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>DispatcherServlet继承HttpServlet</p>
<ul>
<li>中央控制器接受所有客户端发来的操作请求</li>
<li>其中的init方法初始化方法：从xml中读取控制器（类名和位置），创建控制器实例，将所有实例保存至beanMap中</li>
<li>service方法将请求中的具体的“xxx.do”,“xxx”字符是具体的控制器名称，可在beanMap中得到相应实例，之后在获取请求中operate具体的操作进行调用实例中的方法</li>
</ul>
<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><ul>
<li>ServletContext在启动时自动调用init方法创建</li>
<li>FruitServlet是被DispatcherServlet调用的，不在是一个Sevlet组件，ServletContext没有被创建</li>
<li>在控制器自定义setServletContext方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//之前FruitServlet是一个Sevlet组件，那么其中的init方法一定会被调用 ，创建ServletContext</span></span><br><span class="line"><span class="comment">//之前的init方法内部会出现一句话：super.init();</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FruitController</span> <span class="keyword">extends</span> <span class="title class_">ViewBaseServlet</span> &#123;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span> ServletContext servletContext ;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setServletContext</span><span class="params">(ServletContext servletContext)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">    <span class="built_in">this</span>.servletContext = servletContext;</span><br><span class="line">    <span class="built_in">super</span>.init(servletContext);  <span class="comment">//将servletContext传ViewBaseServlet，thyemleaf为了渲染数据到网页</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>DispatcherServlet是一个Sevlet组件，在这里可以得到ServletContext，通过调用setServletContextMethod传给控制器</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">                    <span class="type">Class</span> <span class="variable">controllerBeanClass</span> <span class="operator">=</span> Class.forName(className);</span><br><span class="line">                    <span class="type">Object</span> <span class="variable">beanObj</span> <span class="operator">=</span> controllerBeanClass.newInstance() ; </span><br><span class="line"><span class="type">Method</span> <span class="variable">setServletContextMethod</span> <span class="operator">=</span> controllerBeanClass.getDeclaredMethod(<span class="string">&quot;setServletContext&quot;</span>,ServletContext.class);<span class="comment">//方法名 ，参数</span></span><br><span class="line">                    setServletContextMethod.invoke(beanObj , <span class="built_in">this</span>.getServletContext());</span><br></pre></td></tr></table></figure>





<h2 id="水果系统-优化2-5"><a href="#水果系统-优化2-5" class="headerlink" title="水果系统-优化2.5"></a>水果系统-优化2.5</h2><h3 id="DispatcherServlet-1"><a href="#DispatcherServlet-1" class="headerlink" title="DispatcherServlet"></a>DispatcherServlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;*.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DispatcherServlet</span> <span class="keyword">extends</span> <span class="title class_">ViewBaseServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; beanMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DispatcherServlet</span><span class="params">()</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        <span class="built_in">super</span>.init();  <span class="comment">//调用ViewBaseServlet方法进行初始化，为了渲染数据和重定向</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> getClass().getClassLoader().getResourceAsStream(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">            <span class="comment">//1.创建DocumentBuilderFactory</span></span><br><span class="line">            <span class="type">DocumentBuilderFactory</span> <span class="variable">documentBuilderFactory</span> <span class="operator">=</span> DocumentBuilderFactory.newInstance();</span><br><span class="line">            <span class="comment">//2.创建DocumentBuilder对象</span></span><br><span class="line">            <span class="type">DocumentBuilder</span> <span class="variable">documentBuilder</span> <span class="operator">=</span> documentBuilderFactory.newDocumentBuilder() ;</span><br><span class="line">            <span class="comment">//3.创建Document对象</span></span><br><span class="line">            <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> documentBuilder.parse(inputStream);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//4.获取所有的bean节点</span></span><br><span class="line">            <span class="type">NodeList</span> <span class="variable">beanNodeList</span> <span class="operator">=</span> document.getElementsByTagName(<span class="string">&quot;bean&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i&lt;beanNodeList.getLength() ; i++)&#123;</span><br><span class="line">                <span class="type">Node</span> <span class="variable">beanNode</span> <span class="operator">=</span> beanNodeList.item(i);</span><br><span class="line">                <span class="keyword">if</span>(beanNode.getNodeType() == Node.ELEMENT_NODE)&#123;</span><br><span class="line">                    <span class="type">Element</span> <span class="variable">beanElement</span> <span class="operator">=</span> (Element)beanNode ;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">beanId</span> <span class="operator">=</span>  beanElement.getAttribute(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">                    <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> beanElement.getAttribute(<span class="string">&quot;class&quot;</span>);</span><br><span class="line">                    <span class="type">Class</span> <span class="variable">controllerBeanClass</span> <span class="operator">=</span> Class.forName(className);</span><br><span class="line">                    <span class="type">Object</span> <span class="variable">beanObj</span> <span class="operator">=</span> controllerBeanClass.newInstance();</span><br><span class="line"></span><br><span class="line">                    beanMap.put(beanId , beanObj) ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//设置编码--统一设置编码</span></span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">servletPath</span> <span class="operator">=</span> request.getServletPath();</span><br><span class="line">        servletPath = servletPath.substring(<span class="number">1</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">lastDotIndex</span> <span class="operator">=</span> servletPath.lastIndexOf(<span class="string">&quot;.do&quot;</span>) ;</span><br><span class="line">        servletPath = servletPath.substring(<span class="number">0</span>,lastDotIndex);</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">controllerBeanObj</span> <span class="operator">=</span> beanMap.get(servletPath);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">operate</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;operate&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtil.isEmpty(operate))&#123;</span><br><span class="line">            operate = <span class="string">&quot;index&quot;</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">//operate和方法名一样，所以通过反射获取</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> controllerBeanObj.getClass().getDeclaredMethod(operate,HttpServletRequest.class);</span><br><span class="line">            <span class="keyword">if</span>(method!=<span class="literal">null</span>)&#123;</span><br><span class="line">                method.setAccessible(<span class="literal">true</span>); <span class="comment">//使其可访问</span></span><br><span class="line">                <span class="comment">//调用后得到返回值，进行解析，可知是服务器还是客户端转发</span></span><br><span class="line">                <span class="type">Object</span> <span class="variable">returnObj</span> <span class="operator">=</span> method.invoke(controllerBeanObj, request);</span><br><span class="line">				<span class="type">String</span> <span class="variable">methodReturnStr</span> <span class="operator">=</span> (String)returnObj;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(methodReturnStr.startsWith(<span class="string">&quot;Redirect:&quot;</span>))&#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">redirectStr</span> <span class="operator">=</span> methodReturnStr.substring(<span class="string">&quot;Redirect:&quot;</span>.length());</span><br><span class="line">                    response.sendRedirect(redirectStr);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="built_in">super</span>.processTemplate(methodReturnStr,request,response);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;operate值非法!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="FruitController-1"><a href="#FruitController-1" class="headerlink" title="FruitController"></a>FruitController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FruitController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">FruitDAO</span> <span class="variable">fruitDAO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitDAOImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">update</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">        <span class="comment">//1.设置编码 --中央控制器统一设置</span></span><br><span class="line">        <span class="comment">//request.setCharacterEncoding(&quot;utf-8&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.获取参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fidStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fid&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">fid</span> <span class="operator">=</span> Integer.parseInt(fidStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">fname</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fname&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">priceStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;price&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">price</span> <span class="operator">=</span> Integer.parseInt(priceStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">fcountStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fcount&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">fcount</span> <span class="operator">=</span> Integer.parseInt(fcountStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">remark</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;remark&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.执行更新</span></span><br><span class="line">        fruitDAO.updateFruit(<span class="keyword">new</span> <span class="title class_">Fruit</span>(fid,fname, price ,fcount ,remark ));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.资源跳转</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Redirect:fruit.do&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">edit</span><span class="params">(HttpServletRequest request )</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fidStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fid&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtil.isNotEmpty(fidStr))&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">fid</span> <span class="operator">=</span> Integer.parseInt(fidStr);</span><br><span class="line">            <span class="type">Fruit</span> <span class="variable">fruit</span> <span class="operator">=</span> fruitDAO.getFruitByFid(fid);</span><br><span class="line">            request.setAttribute(<span class="string">&quot;fruit&quot;</span>,fruit);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;edit&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">del</span><span class="params">(HttpServletRequest request )</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fidStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fid&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtil.isNotEmpty(fidStr))&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">fid</span> <span class="operator">=</span> Integer.parseInt(fidStr);</span><br><span class="line">            fruitDAO.delFruit(fid);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//super.processTemplate(&quot;index&quot;,request,response);</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Redirect:fruit.do&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">add</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">fname</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fname&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">price</span> <span class="operator">=</span> Integer.parseInt(request.getParameter(<span class="string">&quot;price&quot;</span>)) ;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">fcount</span> <span class="operator">=</span> Integer.parseInt(request.getParameter(<span class="string">&quot;fcount&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">remark</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;remark&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Fruit</span> <span class="variable">fruit</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="number">0</span>,fname , price , fcount , remark ) ;</span><br><span class="line"></span><br><span class="line">        fruitDAO.addFruit(fruit);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Redirect:fruit.do&quot;</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">index</span><span class="params">(HttpServletRequest request )</span>&#123;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession() ;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置当前页，默认值1</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">pageNo</span> <span class="operator">=</span> <span class="number">1</span> ;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">oper</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;oper&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果oper!=null 说明 通过表单的查询按钮点击过来的</span></span><br><span class="line">        <span class="comment">//如果oper是空的，说明 不是通过表单的查询按钮点击过来的</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">keyword</span> <span class="operator">=</span> <span class="literal">null</span> ;</span><br><span class="line">        <span class="keyword">if</span>(StringUtil.isNotEmpty(oper) &amp;&amp; <span class="string">&quot;search&quot;</span>.equals(oper))&#123;</span><br><span class="line">            <span class="comment">//说明是点击表单查询发送过来的请求</span></span><br><span class="line">            <span class="comment">//此时，pageNo应该还原为1 ， keyword应该从请求参数中获取</span></span><br><span class="line">            pageNo = <span class="number">1</span> ;</span><br><span class="line">            keyword = request.getParameter(<span class="string">&quot;keyword&quot;</span>);</span><br><span class="line">            <span class="comment">//如果keyword为null，需要设置为空字符串&quot;&quot;，否则查询时会拼接成 %null% , 我们期望的是 %%</span></span><br><span class="line">            <span class="keyword">if</span>(StringUtil.isEmpty(keyword))&#123;</span><br><span class="line">                keyword = <span class="string">&quot;&quot;</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//将keyword保存（覆盖）到session中</span></span><br><span class="line">            session.setAttribute(<span class="string">&quot;keyword&quot;</span>,keyword);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//说明此处不是点击表单查询发送过来的请求（比如点击下面的上一页下一页或者直接在地址栏输入网址）</span></span><br><span class="line">            <span class="comment">//此时keyword应该从session作用域获取</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">pageNoStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;pageNo&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(StringUtil.isNotEmpty(pageNoStr))&#123;</span><br><span class="line">                pageNo = Integer.parseInt(pageNoStr);   <span class="comment">//如果从请求中读取到pageNo，则类型转换。否则，pageNo默认就是1</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//如果不是点击的查询按钮，那么查询是基于session中保存的现有keyword进行查询</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">keywordObj</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;keyword&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(keywordObj!=<span class="literal">null</span>)&#123;</span><br><span class="line">                keyword = (String)keywordObj ;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                keyword = <span class="string">&quot;&quot;</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 重新更新当前页的值</span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;pageNo&quot;</span>,pageNo);</span><br><span class="line"></span><br><span class="line">        <span class="type">FruitDAO</span> <span class="variable">fruitDAO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitDAOImpl</span>();</span><br><span class="line">        List&lt;Fruit&gt; fruitList = fruitDAO.getFruitList(keyword , pageNo);</span><br><span class="line">        session.setAttribute(<span class="string">&quot;fruitList&quot;</span>,fruitList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//总记录条数</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">fruitCount</span> <span class="operator">=</span> fruitDAO.getFruitCount(keyword);</span><br><span class="line">        <span class="comment">//总页数</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">pageCount</span> <span class="operator">=</span> (fruitCount+<span class="number">5</span>-<span class="number">1</span>)/<span class="number">5</span> ;</span><br><span class="line"></span><br><span class="line">        session.setAttribute(<span class="string">&quot;pageCount&quot;</span>,pageCount);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="ViewBaseServlet-2"><a href="#ViewBaseServlet-2" class="headerlink" title="ViewBaseServlet"></a>ViewBaseServlet</h3><p>还原回原最初代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.myssm.myspringmvc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.TemplateEngine;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.context.WebContext;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.templatemode.TemplateMode;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.templateresolver.ServletContextTemplateResolver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ViewBaseServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TemplateEngine templateEngine;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.获取ServletContext对象</span></span><br><span class="line">        <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> <span class="built_in">this</span>.getServletContext();</span><br><span class="line">        <span class="comment">// 2.创建Thymeleaf解析器对象</span></span><br><span class="line">        <span class="type">ServletContextTemplateResolver</span> <span class="variable">templateResolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletContextTemplateResolver</span>(servletContext);</span><br><span class="line">        <span class="comment">// 3.给解析器对象设置参数</span></span><br><span class="line">        <span class="comment">// ①HTML是默认模式，明确设置是为了代码更容易理解</span></span><br><span class="line">        templateResolver.setTemplateMode(TemplateMode.HTML);</span><br><span class="line">        <span class="comment">// ②设置前缀</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">viewPrefix</span> <span class="operator">=</span> servletContext.getInitParameter(<span class="string">&quot;view-prefix&quot;</span>);</span><br><span class="line">        templateResolver.setPrefix(viewPrefix);</span><br><span class="line">        <span class="comment">// ③设置后缀</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">viewSuffix</span> <span class="operator">=</span> servletContext.getInitParameter(<span class="string">&quot;view-suffix&quot;</span>);</span><br><span class="line">        templateResolver.setSuffix(viewSuffix);</span><br><span class="line">        <span class="comment">// ④设置缓存过期时间（毫秒）</span></span><br><span class="line">        templateResolver.setCacheTTLMs(<span class="number">60000L</span>);</span><br><span class="line">        <span class="comment">// ⑤设置是否缓存</span></span><br><span class="line">        templateResolver.setCacheable(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// ⑥设置服务器端编码方式</span></span><br><span class="line">        templateResolver.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        <span class="comment">// 4.创建模板引擎对象</span></span><br><span class="line">        templateEngine = <span class="keyword">new</span> <span class="title class_">TemplateEngine</span>();</span><br><span class="line">        <span class="comment">// 5.给模板引擎对象设置模板解析器</span></span><br><span class="line">        templateEngine.setTemplateResolver(templateResolver);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">processTemplate</span><span class="params">(String templateName, HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1.设置响应体内容类型和字符集 --中央控制器设置也可以</span></span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">        <span class="comment">// 2.创建WebContext对象</span></span><br><span class="line">        <span class="type">WebContext</span> <span class="variable">webContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebContext</span>(req, resp, <span class="built_in">this</span>.getServletContext());</span><br><span class="line">        <span class="comment">// 3.处理模板数据</span></span><br><span class="line">        templateEngine.process(templateName, webContext, resp.getWriter());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><p>优化2.5在优化2上做出的改进，目的是将FruitController和DispatcherServlet低耦合，使FruitController尽量变成普通的类，使代码更加简洁</p>
<p>思路：</p>
<ul>
<li>DispatcherServlet继承ViewBaseServlet，它来调用init（），继续对数据的服务端数据的渲染和转发重定向</li>
<li>DispatcherServlet来进行重定向的调用，即要求控制器相关功能方法返回字符串（代表服务端或客户端转发）</li>
</ul>
<h2 id="水果系统-优化3"><a href="#水果系统-优化3" class="headerlink" title="水果系统-优化3"></a>水果系统-优化3</h2><h3 id="DispatcherServlet-2"><a href="#DispatcherServlet-2" class="headerlink" title="DispatcherServlet"></a>DispatcherServlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;*.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DispatcherServlet</span> <span class="keyword">extends</span> <span class="title class_">ViewBaseServlet</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; beanMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DispatcherServlet</span><span class="params">()</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        <span class="built_in">super</span>.init();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> getClass().getClassLoader().getResourceAsStream(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">            <span class="comment">//1.创建DocumentBuilderFactory</span></span><br><span class="line">            <span class="type">DocumentBuilderFactory</span> <span class="variable">documentBuilderFactory</span> <span class="operator">=</span> DocumentBuilderFactory.newInstance();</span><br><span class="line">            <span class="comment">//2.创建DocumentBuilder对象</span></span><br><span class="line">            <span class="type">DocumentBuilder</span> <span class="variable">documentBuilder</span> <span class="operator">=</span> documentBuilderFactory.newDocumentBuilder() ;</span><br><span class="line">            <span class="comment">//3.创建Document对象</span></span><br><span class="line">            <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> documentBuilder.parse(inputStream);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//4.获取所有的bean节点</span></span><br><span class="line">            <span class="type">NodeList</span> <span class="variable">beanNodeList</span> <span class="operator">=</span> document.getElementsByTagName(<span class="string">&quot;bean&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i&lt;beanNodeList.getLength() ; i++)&#123;</span><br><span class="line">                <span class="type">Node</span> <span class="variable">beanNode</span> <span class="operator">=</span> beanNodeList.item(i);</span><br><span class="line">                <span class="keyword">if</span>(beanNode.getNodeType() == Node.ELEMENT_NODE)&#123;</span><br><span class="line">                    <span class="type">Element</span> <span class="variable">beanElement</span> <span class="operator">=</span> (Element)beanNode ;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">beanId</span> <span class="operator">=</span>  beanElement.getAttribute(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">                    <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> beanElement.getAttribute(<span class="string">&quot;class&quot;</span>);</span><br><span class="line">                    <span class="type">Class</span> <span class="variable">controllerBeanClass</span> <span class="operator">=</span> Class.forName(className);</span><br><span class="line">                    <span class="type">Object</span> <span class="variable">beanObj</span> <span class="operator">=</span> controllerBeanClass.newInstance() ;</span><br><span class="line">                    beanMap.put(beanId , beanObj) ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//设置编码</span></span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">servletPath</span> <span class="operator">=</span> request.getServletPath();</span><br><span class="line">        servletPath = servletPath.substring(<span class="number">1</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">lastDotIndex</span> <span class="operator">=</span> servletPath.lastIndexOf(<span class="string">&quot;.do&quot;</span>) ;</span><br><span class="line">        servletPath = servletPath.substring(<span class="number">0</span>,lastDotIndex);</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">controllerBeanObj</span> <span class="operator">=</span> beanMap.get(servletPath);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">operate</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;operate&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtil.isEmpty(operate))&#123;</span><br><span class="line">            operate = <span class="string">&quot;index&quot;</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Method[] methods = controllerBeanObj.getClass().getDeclaredMethods();</span><br><span class="line">            <span class="keyword">for</span>(Method method : methods)&#123;</span><br><span class="line">                <span class="keyword">if</span>(operate.equals(method.getName()))&#123;</span><br><span class="line">                    <span class="comment">//1.统一获取请求参数</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">//1-1.获取当前方法的参数，返回参数数组</span></span><br><span class="line">                    Parameter[] parameters = method.getParameters();</span><br><span class="line">                    <span class="comment">//1-2.parameterValues 用来承载参数的值</span></span><br><span class="line">                    Object[] parameterValues = <span class="keyword">new</span> <span class="title class_">Object</span>[parameters.length];</span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; parameters.length; i++) &#123;</span><br><span class="line">                        <span class="type">Parameter</span> <span class="variable">parameter</span> <span class="operator">=</span> parameters[i];</span><br><span class="line">                        <span class="type">String</span> <span class="variable">parameterName</span> <span class="operator">=</span> parameter.getName() ;</span><br><span class="line">                        <span class="comment">//如果参数名是request,response,session 那么就不是通过请求中获取参数的方式了</span></span><br><span class="line">                        <span class="keyword">if</span>(<span class="string">&quot;request&quot;</span>.equals(parameterName))&#123;</span><br><span class="line">                            parameterValues[i] = request ;</span><br><span class="line">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;response&quot;</span>.equals(parameterName))&#123;</span><br><span class="line">                            parameterValues[i] = response ;</span><br><span class="line">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;session&quot;</span>.equals(parameterName))&#123;</span><br><span class="line">                            parameterValues[i] = request.getSession() ;</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            <span class="comment">//从请求中获取参数值</span></span><br><span class="line">                            <span class="type">String</span> <span class="variable">parameterValue</span> <span class="operator">=</span> request.getParameter(parameterName);</span><br><span class="line">                            <span class="type">String</span> <span class="variable">typeName</span> <span class="operator">=</span> parameter.getType().getName();</span><br><span class="line"></span><br><span class="line">                            <span class="type">Object</span> <span class="variable">parameterObj</span> <span class="operator">=</span> parameterValue ;</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">if</span>(parameterObj!=<span class="literal">null</span>) &#123; <span class="comment">//该项目只涉及Integer和String类型</span></span><br><span class="line">                                <span class="keyword">if</span> (<span class="string">&quot;java.lang.Integer&quot;</span>.equals(typeName)) &#123;</span><br><span class="line">                                    parameterObj = Integer.parseInt(parameterValue);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                            parameterValues[i] = parameterObj ;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//2.controller组件中的方法调用</span></span><br><span class="line">                    method.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                    <span class="type">Object</span> <span class="variable">returnObj</span> <span class="operator">=</span> method.invoke(controllerBeanObj,parameterValues);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//3.视图处理</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">methodReturnStr</span> <span class="operator">=</span> (String)returnObj ;</span><br><span class="line">                    <span class="keyword">if</span>(methodReturnStr.startsWith(<span class="string">&quot;redirect:&quot;</span>))&#123;        <span class="comment">//比如：  redirect:fruit.do</span></span><br><span class="line">                        <span class="type">String</span> <span class="variable">redirectStr</span> <span class="operator">=</span> methodReturnStr.substring(<span class="string">&quot;redirect:&quot;</span>.length());</span><br><span class="line">                        response.sendRedirect(redirectStr);</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="built_in">super</span>.processTemplate(methodReturnStr,request,response);    <span class="comment">// 比如：  &quot;edit&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">            &#125;else&#123;</span></span><br><span class="line"><span class="comment">                throw new RuntimeException(&quot;operate值非法!&quot;);</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 常见错误： IllegalArgumentException: argument type mismatch</span></span><br></pre></td></tr></table></figure>



<h3 id="FruitController-2"><a href="#FruitController-2" class="headerlink" title="FruitController"></a>FruitController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FruitController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">FruitDAO</span> <span class="variable">fruitDAO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitDAOImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">update</span><span class="params">(Integer fid , String fname , Integer price , Integer fcount , String remark )</span>&#123;</span><br><span class="line">        <span class="comment">//3.执行更新</span></span><br><span class="line">        fruitDAO.updateFruit(<span class="keyword">new</span> <span class="title class_">Fruit</span>(fid,fname, price ,fcount ,remark ));</span><br><span class="line">        <span class="comment">//4.资源跳转</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:fruit.do&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">edit</span><span class="params">(Integer fid , HttpServletRequest request)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(fid!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="type">Fruit</span> <span class="variable">fruit</span> <span class="operator">=</span> fruitDAO.getFruitByFid(fid);</span><br><span class="line">            request.setAttribute(<span class="string">&quot;fruit&quot;</span>,fruit);</span><br><span class="line">            <span class="comment">//super.processTemplate(&quot;edit&quot;,request,response);</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;edit&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;error&quot;</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">del</span><span class="params">(Integer fid  )</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(fid!=<span class="literal">null</span>)&#123;</span><br><span class="line">            fruitDAO.delFruit(fid);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;redirect:fruit.do&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">add</span><span class="params">(String fname , Integer price , Integer fcount , String remark )</span> &#123;</span><br><span class="line">        <span class="type">Fruit</span> <span class="variable">fruit</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="number">0</span>,fname , price , fcount , remark ) ;</span><br><span class="line">        fruitDAO.addFruit(fruit);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:fruit.do&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">index</span><span class="params">(String oper , String keyword , Integer pageNo , HttpServletRequest request )</span> &#123;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession() ;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(pageNo==<span class="literal">null</span>)&#123;</span><br><span class="line">            pageNo = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(StringUtil.isNotEmpty(oper) &amp;&amp; <span class="string">&quot;search&quot;</span>.equals(oper))&#123;</span><br><span class="line">            pageNo = <span class="number">1</span> ;</span><br><span class="line">            <span class="keyword">if</span>(StringUtil.isEmpty(keyword))&#123;</span><br><span class="line">                keyword = <span class="string">&quot;&quot;</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">            session.setAttribute(<span class="string">&quot;keyword&quot;</span>,keyword);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">keywordObj</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;keyword&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(keywordObj!=<span class="literal">null</span>)&#123;</span><br><span class="line">                keyword = (String)keywordObj ;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                keyword = <span class="string">&quot;&quot;</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 重新更新当前页的值</span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;pageNo&quot;</span>,pageNo);</span><br><span class="line"></span><br><span class="line">        <span class="type">FruitDAO</span> <span class="variable">fruitDAO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitDAOImpl</span>();</span><br><span class="line">        List&lt;Fruit&gt; fruitList = fruitDAO.getFruitList(keyword , pageNo);</span><br><span class="line">        session.setAttribute(<span class="string">&quot;fruitList&quot;</span>,fruitList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//总记录条数</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">fruitCount</span> <span class="operator">=</span> fruitDAO.getFruitCount(keyword);</span><br><span class="line">        <span class="comment">//总页数</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">pageCount</span> <span class="operator">=</span> (fruitCount+<span class="number">5</span>-<span class="number">1</span>)/<span class="number">5</span> ;</span><br><span class="line">        session.setAttribute(<span class="string">&quot;pageCount&quot;</span>,pageCount);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p>在优化2.5之上做出改进，将FruitController和DispatcherServlet实现低耦合，使FruitController变成普通的类，代码变得简洁，将冗余的操作放在中央控制器DispatcherServlet去执行</p>
<ul>
<li>获取参数名是request,response,session</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="string">&quot;request&quot;</span>.equals(parameterName))&#123;</span><br><span class="line">                      parameterValues[i] = request ;</span><br><span class="line">                  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;response&quot;</span>.equals(parameterName))&#123;</span><br><span class="line">                      parameterValues[i] = response ;</span><br><span class="line">                  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;session&quot;</span>.equals(parameterName))&#123;</span><br><span class="line">                      parameterValues[i] = request.getSession() ;</span><br><span class="line">                  &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>获取请求request中参数</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">parameterValue</span> <span class="operator">=</span> request.getParameter(parameterName); <span class="comment">//根据参数名获取参数值</span></span><br><span class="line">         <span class="type">String</span> <span class="variable">typeName</span> <span class="operator">=</span> parameter.getType().getName(); <span class="comment">//获取参数类型名</span></span><br><span class="line">         <span class="type">Object</span> <span class="variable">parameterObj</span> <span class="operator">=</span> parameterValue ;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">if</span>(parameterObj!=<span class="literal">null</span>) &#123; <span class="comment">//该项目只涉及Integer和String类型</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="string">&quot;java.lang.Integer&quot;</span>.equals(typeName)) &#123;<span class="comment">//将String类型的转为Integer类型</span></span><br><span class="line">                       parameterObj = Integer.parseInt(parameterValue);</span><br><span class="line">                  &#125;</span><br><span class="line">             &#125;</span><br><span class="line">                     parameterValues[i] = parameterObj ; <span class="comment">//放入参数数组</span></span><br><span class="line"> </span><br><span class="line">             <span class="comment">//2.controller组件中的方法调用</span></span><br><span class="line">             method.setAccessible(<span class="literal">true</span>);</span><br><span class="line">             <span class="type">Object</span> <span class="variable">returnObj</span> <span class="operator">=</span> method.invoke(controllerBeanObj,parameterValues);</span><br></pre></td></tr></table></figure>

<ul>
<li>问题：idea编译器默认是不编译参数的名称的，默认将参数名称变为arg0，arg1，arg2……..</li>
</ul>
<p>可在setting设置中进行修改编译器的编译信息，将参数名称添加到编译中</p>
<p><img src="/2022/09/30/JavaWeb/image-20220705231754207.png" alt="image-20220705231754207"></p>
<h2 id="复习总结"><a href="#复习总结" class="headerlink" title="复习总结"></a>复习总结</h2><p>review:</p>
<ol>
<li>最初的做法是： 一个请求对应一个Servlet，这样存在的问题是servlet太多了</li>
<li>把一些列的请求都对应一个Servlet，<br>IndexServlet&#x2F;AddServlet&#x2F;EditServlet&#x2F;DelServlet&#x2F;UpdateServlet -&gt; 合并成FruitServlet<br>通过一个operate的值来决定调用FruitServlet中的哪一个方法<br>使用的是switch-case</li>
<li>在上一个版本中，Servlet中充斥着大量的switch-case，试想一下，随着我们的项目的业务规模扩大，那么会有很多的Servlet，也就意味着会有很多的switch-case，这是一种代码冗余<br>因此，我们在servlet中使用了反射技术，我们规定operate的值和方法名一致，那么接收到operate的值是什么就表明我们需要调用对应的方法进行响应，如果找不到对应的方法，则抛异常</li>
<li>在上一个版本中我们使用了反射技术，但是其实还是存在一定的问题：每一个servlet中都有类似的反射技术的代码。因此继续抽取，设计了中央控制器类：DispatcherServlet<br>DispatcherServlet这个类的工作分为两大部分：<br>1.根据url定位到能够处理这个请求的controller组件：<br> 1)从url中提取servletPath : &#x2F;fruit.do -&gt; fruit<br> 2)根据fruit找到对应的组件:FruitController ， 这个对应的依据我们存储在applicationContext.xml中<br>   &lt;bean id&#x3D;”fruit” class&#x3D;”com.atguigu.fruit.controllers.FruitController&#x2F;&gt;<br>   通过DOM技术我们去解析XML文件，在中央控制器中形成一个beanMap容器，用来存放所有的Controller组件<br> 3)根据获取到的operate的值定位到我们FruitController中需要调用的方法<br>2.调用Controller组件中的方法：<ol>
<li>获取参数<br>获取即将要调用的方法的参数签名信息: Parameter[] parameters &#x3D; method.getParameters();<br>通过parameter.getName()获取参数的名称；<br>准备了Object[] parameterValues 这个数组用来存放对应参数的参数值<br>另外，我们需要考虑参数的类型问题，需要做类型转化的工作。通过parameter.getType()获取参数的类型</li>
<li>执行方法<br>Object returnObj &#x3D; method.invoke(controllerBean , parameterValues);</li>
<li>视图处理<br>String returnStr &#x3D; (String)returnObj;<br>if(returnStr.startWith(“redirect:”)){<br> ….<br>}else if…..</li>
</ol>
</li>
</ol>
<h1 id="再次学习Servlet的初始化方法"><a href="#再次学习Servlet的初始化方法" class="headerlink" title="再次学习Servlet的初始化方法"></a>再次学习Servlet的初始化方法</h1><ol>
<li>Servlet生命周期：实例化、初始化、服务、销毁</li>
</ol>
<ol start="2">
<li>Servlet中的初始化方法有两个：init() , init(config)<br>  其中带参数的方法代码如下： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line"><span class="built_in">this</span>.config = config ;</span><br><span class="line">init();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
  另外一个无参的init方法如下： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
  如果我们想要在Servlet初始化时做一些准备工作，那么我们可以重写init方法<br>  我们可以通过如下步骤去获取初始化设置的数据</li>
</ol>
<ul>
<li>获取config对象：ServletConfig config &#x3D; getServletConfig();</li>
<li>获取初始化参数值： config.getInitParameter(key);</li>
</ul>
<ol start="3">
<li><p>在web.xml文件中配置Servlet</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Demo01Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.atguigu.servlet.Demo01Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>world<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>uname<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>jim<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Demo01Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/demo01<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>也可以通过注解的方式进行配置：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(urlPatterns = &#123;&quot;/demo01&quot;&#125; ,</span></span><br><span class="line"><span class="meta">initParams = &#123;</span></span><br><span class="line"><span class="meta">    @WebInitParam(name=&quot;hello&quot;,value=&quot;world&quot;),</span></span><br><span class="line"><span class="meta">    @WebInitParam(name=&quot;uname&quot;,value=&quot;jim&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br></pre></td></tr></table></figure></li>
</ol>
<ol start="5">
<li>学习Servlet中的ServletContext和<context-param></context-param></li>
</ol>
<ul>
<li><p>获取ServletContext，有很多方法<br>在初始化方法中： ServletContxt servletContext &#x3D; getServletContext();<br>在服务方法中也可以通过request对象获取，也可以通过session获取：<br>request.getServletContext(); session.getServletContext()</p>
</li>
<li><p>获取初始化值：<br>servletContext.getInitParameter();</p>
</li>
</ul>
<h1 id="业务层"><a href="#业务层" class="headerlink" title="业务层"></a>业务层</h1><h2 id="MVC概念解释"><a href="#MVC概念解释" class="headerlink" title="MVC概念解释"></a>MVC概念解释</h2><p>MVC : Model（模型）、View（视图）、Controller（控制器）</p>
<ul>
<li>视图层：用于做数据展示以及和用户交互的一个界面</li>
<li>控制层：能够接受客户端的请求，具体的业务功能还是需要借助于模型组件来完成</li>
<li>模型层：模型分为很多种：<ul>
<li>数据访问模型（DAO）</li>
<li>业务逻辑模型（BO）</li>
<li>值对象模型（POJO&#x2F;vo(value object)）</li>
<li>数据传输对象（DTO）</li>
</ul>
</li>
</ul>
<h2 id="区分业务对象和数据访问对象"><a href="#区分业务对象和数据访问对象" class="headerlink" title="区分业务对象和数据访问对象"></a>区分业务对象和数据访问对象</h2><p>1） DAO中的方法都是单精度方法或者称之为细粒度方法。什么叫单精度？一个方法只考虑一个操作，比如添加，那就是insert操作、查询那就是select操作….<br>2） BO中的方法属于业务方法，也实际的业务是比较复杂的，因此业务方法的粒度是比较粗的</p>
<p>举例：</p>
<ul>
<li><p>注册这个功能属于业务功能，也就是说注册这个方法属于业务方法。那么这个业务方法中包含了多个DAO方法。也就是说注册这个业务功能需要通过多个DAO方法的组合调用，从而完成注册功能的开发。</p>
<p>注册DAO举例：</p>
<ul>
<li>检查用户名是否已经被注册 - DAO中的select操作</li>
<li>用户表新增一条新用户记录 - DAO中的insert操作</li>
<li>向用户积分表新增一条记录（新用户默认初始化积分100分） - DAO中的insert操作</li>
<li>向系统消息表新增一条记录（某某某新用户注册了，需要根据通讯录信息向他的联系人推送消息） - DAO中的insert操作</li>
<li>向系统日志表新增一条记录（某用户在某IP在某年某月某日某时某分某秒某毫秒注册） - DAO中的insert操作</li>
<li>….</li>
</ul>
</li>
</ul>
<h1 id="水果库存系统中添加业务层组件-优化4"><a href="#水果库存系统中添加业务层组件-优化4" class="headerlink" title="水果库存系统中添加业务层组件-优化4"></a>水果库存系统中添加业务层组件-优化4</h1><h2 id="简图1"><a href="#简图1" class="headerlink" title="简图1"></a>简图1</h2><p><img src="/2022/09/30/JavaWeb/image-20220706151602119.png" alt="image-20220706151602119"></p>
<h2 id="简图2"><a href="#简图2" class="headerlink" title="简图2"></a>简图2</h2><p><img src="/2022/09/30/JavaWeb/image-20220706160218945.png" alt="image-20220706160218945"></p>
<blockquote>
<p>尽然减少耦合和依赖，三者之间有依赖关系，这里将三者Fruit加入到applicationContext配置文件中，依赖关系也在这里呈现，最后由ClassPathXmlApplictionContext进行创建实例和建立他们的之间的依赖关系（即对属性赋值）</p>
</blockquote>
<h2 id="applicationContext"><a href="#applicationContext" class="headerlink" title="applicationContext"></a>applicationContext</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;fruitDAO&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.fruit.dao.impl.FruitDAOImpl&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;fruitService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.fruit.service.impl.FruitServiceImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- property标签用来表示属性；name表示属性名；ref表示引用其他bean的id值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;fruitDAO&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;fruitDAO&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;fruit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.fruit.controllers.FruitController&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;fruitService&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;fruitService&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">Node 节点</span></span><br><span class="line"><span class="comment">    Element 元素节点</span></span><br><span class="line"><span class="comment">    Text 文本节点</span></span><br><span class="line"><span class="comment">&lt;sname&gt;jim&lt;/sname&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="ClassPathXmlApplicationContext"><a href="#ClassPathXmlApplicationContext" class="headerlink" title="ClassPathXmlApplicationContext"></a>ClassPathXmlApplicationContext</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassPathXmlApplicationContext</span> <span class="keyword">implements</span> <span class="title class_">BeanFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; beanMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ClassPathXmlApplicationContext</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> getClass().getClassLoader().getResourceAsStream(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">            <span class="comment">//1.创建DocumentBuilderFactory</span></span><br><span class="line">            <span class="type">DocumentBuilderFactory</span> <span class="variable">documentBuilderFactory</span> <span class="operator">=</span> DocumentBuilderFactory.newInstance();</span><br><span class="line">            <span class="comment">//2.创建DocumentBuilder对象</span></span><br><span class="line">            <span class="type">DocumentBuilder</span> <span class="variable">documentBuilder</span> <span class="operator">=</span> documentBuilderFactory.newDocumentBuilder() ;</span><br><span class="line">            <span class="comment">//3.创建Document对象</span></span><br><span class="line">            <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> documentBuilder.parse(inputStream);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//4.获取所有的bean节点</span></span><br><span class="line">            <span class="type">NodeList</span> <span class="variable">beanNodeList</span> <span class="operator">=</span> document.getElementsByTagName(<span class="string">&quot;bean&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i&lt;beanNodeList.getLength() ; i++)&#123;</span><br><span class="line">                <span class="type">Node</span> <span class="variable">beanNode</span> <span class="operator">=</span> beanNodeList.item(i);</span><br><span class="line">                <span class="keyword">if</span>(beanNode.getNodeType() == Node.ELEMENT_NODE)&#123;</span><br><span class="line">                    <span class="type">Element</span> <span class="variable">beanElement</span> <span class="operator">=</span> (Element)beanNode ;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">beanId</span> <span class="operator">=</span>  beanElement.getAttribute(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">                    <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> beanElement.getAttribute(<span class="string">&quot;class&quot;</span>);</span><br><span class="line">                    <span class="type">Class</span> <span class="variable">beanClass</span> <span class="operator">=</span> Class.forName(className);</span><br><span class="line">                    <span class="comment">//创建bean实例</span></span><br><span class="line">                    <span class="type">Object</span> <span class="variable">beanObj</span> <span class="operator">=</span> beanClass.newInstance() ;</span><br><span class="line">                    <span class="comment">//将bean实例对象保存到map容器中</span></span><br><span class="line">                    beanMap.put(beanId , beanObj) ;</span><br><span class="line">                    <span class="comment">//到目前为止，此处需要注意的是，bean和bean之间的依赖关系还没有设置</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//5.组装bean之间的依赖关系</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i&lt;beanNodeList.getLength() ; i++)&#123;</span><br><span class="line">                <span class="type">Node</span> <span class="variable">beanNode</span> <span class="operator">=</span> beanNodeList.item(i);</span><br><span class="line">                <span class="keyword">if</span>(beanNode.getNodeType() == Node.ELEMENT_NODE) &#123;</span><br><span class="line">                    <span class="type">Element</span> <span class="variable">beanElement</span> <span class="operator">=</span> (Element) beanNode;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">beanId</span> <span class="operator">=</span> beanElement.getAttribute(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">                    <span class="type">NodeList</span> <span class="variable">beanChildNodeList</span> <span class="operator">=</span> beanElement.getChildNodes();</span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; beanChildNodeList.getLength() ; j++) &#123;</span><br><span class="line">                        <span class="type">Node</span> <span class="variable">beanChildNode</span> <span class="operator">=</span> beanChildNodeList.item(j);</span><br><span class="line">                        <span class="keyword">if</span>(beanChildNode.getNodeType()==Node.ELEMENT_NODE &amp;&amp; <span class="string">&quot;property&quot;</span>.equals(beanChildNode.getNodeName()))&#123;</span><br><span class="line">                            <span class="type">Element</span> <span class="variable">propertyElement</span> <span class="operator">=</span> (Element) beanChildNode;</span><br><span class="line">                            <span class="type">String</span> <span class="variable">propertyName</span> <span class="operator">=</span> propertyElement.getAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">                            <span class="type">String</span> <span class="variable">propertyRef</span> <span class="operator">=</span> propertyElement.getAttribute(<span class="string">&quot;ref&quot;</span>);</span><br><span class="line">                            <span class="comment">//1) 找到propertyRef对应的实例</span></span><br><span class="line">                            <span class="type">Object</span> <span class="variable">refObj</span> <span class="operator">=</span> beanMap.get(propertyRef);</span><br><span class="line">                            <span class="comment">//2) 将refObj设置到当前bean对应的实例的property属性上去</span></span><br><span class="line">                            <span class="type">Object</span> <span class="variable">beanObj</span> <span class="operator">=</span> beanMap.get(beanId);</span><br><span class="line">                            <span class="type">Class</span> <span class="variable">beanClazz</span> <span class="operator">=</span> beanObj.getClass();</span><br><span class="line">                            <span class="type">Field</span> <span class="variable">propertyField</span> <span class="operator">=</span> beanClazz.getDeclaredField(propertyName);</span><br><span class="line">                            propertyField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                            propertyField.set(beanObj,refObj); <span class="comment">//设置其属性值，完成他们的依赖关系</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getBean</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> beanMap.get(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="IOC"><a href="#IOC" class="headerlink" title="IOC"></a>IOC</h1><h2 id="耦合-x2F-依赖"><a href="#耦合-x2F-依赖" class="headerlink" title="耦合&#x2F;依赖"></a>耦合&#x2F;依赖</h2><p>依赖指的是某某某离不开某某某<br>在软件系统中，层与层之间是存在依赖的。我们也称之为耦合。<br>我们系统架构或者是设计的一个原则是： 高内聚低耦合。<br>层内部的组成应该是高度聚合的，而层与层之间的关系应该是低耦合的，最理想的情况0耦合（就是没有耦合）</p>
<h2 id="IOC-控制反转："><a href="#IOC-控制反转：" class="headerlink" title="IOC - 控制反转："></a>IOC - 控制反转：</h2><ol>
<li>之前在Servlet中，我们创建service对象 ， FruitService fruitService &#x3D; new FruitServiceImpl();<ul>
<li>这句话如果出现在servlet中的某个方法内部，那么这个fruitService的作用域（生命周期）应该就是这个方法级别；</li>
<li>如果这句话出现在servlet的类中，也就是说fruitService是一个成员变量，那么这个fruitService的作用域（生命周期）应该就是这个servlet实例级别</li>
</ul>
</li>
<li>之后我们在applicationContext.xml中定义了这个fruitService。然后通过解析XML，产生fruitService实例，存放在beanMap中，这个beanMap在一个BeanFactory中<br>因此，我们转移（改变）了之前的service实例、dao实例等等他们的生命周期。控制权从程序员转移到BeanFactory。这个现象我们称之为控制反转</li>
</ol>
<blockquote>
<p>之前对象在出现频繁创建和销毁，生命周期短暂，现在生命周期长，利用率高</p>
</blockquote>
<h2 id="DI-依赖注入："><a href="#DI-依赖注入：" class="headerlink" title="DI - 依赖注入："></a>DI - 依赖注入：</h2><ol>
<li><p>之前我们在控制层出现代码：FruitService fruitService &#x3D; new FruitServiceImpl()；<br>那么，控制层和service层存在耦合。</p>
</li>
<li><p>之后，我们将代码修改成FruitService fruitService &#x3D; null ;<br>然后，在applicationContext.xml配置文件中配置:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;fruit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;FruitController&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;fruitService&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;fruitService&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="过滤器Filter"><a href="#过滤器Filter" class="headerlink" title="过滤器Filter"></a>过滤器Filter</h1><h2 id="过滤器Filter概述"><a href="#过滤器Filter概述" class="headerlink" title="过滤器Filter概述"></a>过滤器Filter概述</h2><ol>
<li>Filter也属于Servlet规范</li>
<li>Filter开发步骤：新建类实现Filter接口，然后实现其中的三个方法：init、doFilter、destroy<br>配置Filter，可以用注解@WebFilter，也可以使用xml文件 <filter> <filter-mapping></filter-mapping></filter></li>
<li>Filter在配置时，和servlet一样，也可以配置通配符，例如 @WebFilter(“*.do”)表示拦截所有以.do结尾的请求</li>
<li>过滤器链<br>1）执行的顺序依次是： A B C demo03 C2 B2 A2<br>2）如果采取的是注解的方式进行配置，那么过滤器链的拦截顺序是<strong>按照全类名的先后顺序排序</strong>的<br>3）如果采取的是xml的方式进行配置，那么按照<strong>配置的先后顺序进行排序</strong></li>
</ol>
<h2 id="过滤器项目简图"><a href="#过滤器项目简图" class="headerlink" title="过滤器项目简图"></a>过滤器项目简图</h2><p><img src="/2022/09/30/JavaWeb/image-20220707122421570.png" alt="image-20220707122421570"></p>
<blockquote>
<p>客户端向servlet发送请求，需要先经过对应的Filter过滤器</p>
<p>Servlet向另外客户端相应还是原路经过Filter返回，类似递归</p>
</blockquote>
<h2 id="代码演示"><a href="#代码演示" class="headerlink" title="代码演示"></a>代码演示</h2><h3 id="Filter01"><a href="#Filter01" class="headerlink" title="Filter01"></a>Filter01</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebFilter(&quot;*.do&quot;)</span>  <span class="comment">//任何向.do结尾的Serlvet发送请求都会经过这</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Filter01</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;A&quot;</span>); <span class="comment">//客户端向Servelet发请求，执行完相应代码后放行</span></span><br><span class="line">        <span class="comment">//放行 --- 跳转至下一个过滤器或直接到达Servlet</span></span><br><span class="line">        filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">        System.out.println(<span class="string">&quot;A2&quot;</span>); <span class="comment">//Servlet向客户端响应，执行的代码</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Demo01Servlet"><a href="#Demo01Servlet" class="headerlink" title="Demo01Servlet"></a>Demo01Servlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo01.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01Servlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;demo01 service.....&quot;</span>);</span><br><span class="line">        request.getRequestDispatcher(<span class="string">&quot;succ.html&quot;</span>).forward(request,response); <span class="comment">//重定向还是要经过过滤器</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="过滤器的简单应用–设置编码"><a href="#过滤器的简单应用–设置编码" class="headerlink" title="过滤器的简单应用–设置编码"></a>过滤器的简单应用–设置编码</h2><h3 id="图示"><a href="#图示" class="headerlink" title="图示"></a>图示</h3><p><img src="/2022/09/30/JavaWeb/image-20220707123727361.png" alt="image-20220707123727361"></p>
<h3 id="CharacterEncodingFilter"><a href="#CharacterEncodingFilter" class="headerlink" title="CharacterEncodingFilter"></a>CharacterEncodingFilter</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebFilter(urlPatterns = &#123;&quot;*.do&quot;&#125;,</span></span><br><span class="line"><span class="meta">		initParams = &#123;@WebInitParam(name = &quot;encoding&quot;,value = &quot;UTF-8&quot;)&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CharacterEncodingFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">encoding</span> <span class="operator">=</span> <span class="string">&quot;UTF-8&quot;</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">encodingStr</span> <span class="operator">=</span> filterConfig.getInitParameter(<span class="string">&quot;encoding&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtil.isNotEmpty(encodingStr))&#123;</span><br><span class="line">            encoding = encodingStr ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        </span><br><span class="line">        ((HttpServletRequest)servletRequest).setCharacterEncoding(encoding);</span><br><span class="line">        </span><br><span class="line">        filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>利用配置文件或注解可以为Request自定义编码集</p>
</blockquote>
<h1 id="事务管理"><a href="#事务管理" class="headerlink" title="事务管理"></a>事务管理</h1><h2 id="编程式管理事务"><a href="#编程式管理事务" class="headerlink" title="编程式管理事务"></a>编程式管理事务</h2><p><strong>事务管理之前</strong></p>
<p><img src="/2022/09/30/JavaWeb/image-20220707160516225.png" alt="image-20220707160516225"></p>
<blockquote>
<p>当前Service中包含了三个DAO操作</p>
<p>之前的DAO的事务管理的基本API是右边写的方式</p>
<p>这样的方式的带来的问题是DAO01执行成功-提交，DAO02执行失败-回滚，DAO03执行成功-提交</p>
<p>此时service操作是成功还是失败？？ service的操作应该是一个整体，不能部分成功部分失败。</p>
<p>因此，service是一个整体，要么都成功，要么都失败 –  得出结论：事务管理不能以DAO层的单精度方法为单位，而应该以业务层的方法为单位</p>
</blockquote>
<p><strong>事务管理前置之后</strong></p>
<p><img src="/2022/09/30/JavaWeb/image-20220707161136914.png" alt="image-20220707161136914"></p>
<h2 id="水果系统在优化-5"><a href="#水果系统在优化-5" class="headerlink" title="水果系统在优化-5"></a>水果系统在优化-5</h2><h3 id="事务管理前置到过滤器"><a href="#事务管理前置到过滤器" class="headerlink" title="事务管理前置到过滤器"></a>事务管理前置到过滤器</h3><p><img src="/2022/09/30/JavaWeb/image-20220707161647857.png" alt="image-20220707161647857"></p>
<p>解决难点：需要这三个组件中的操作都是用同一个Connection，就是使用ThreadLocal，能够将连接保存在Map&lt;&gt;中，使用时获取，关闭连接时在关闭就ok，此时新建一个ConnUtil工具类进行实现创建连接和关闭连接的方法</p>
<h3 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h3><p>get() , set(obj)</p>
<p>ThreadLocal称之为本地线程 。 我们可以通过set方法在当前线程上存储数据、通过get方法在当前线程上获取数据</p>
<h4 id="set方法源码分析："><a href="#set方法源码分析：" class="headerlink" title="set方法源码分析："></a>set方法源码分析：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T value)</span> &#123;</span><br><span class="line"><span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread(); <span class="comment">//获取当前的线程</span></span><br><span class="line"><span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);    <span class="comment">//每一个线程都维护各自的一个容器（ThreadLocalMap）</span></span><br><span class="line"><span class="keyword">if</span> (map != <span class="literal">null</span>)</span><br><span class="line">    map.set(<span class="built_in">this</span>, value);          <span class="comment">//这里的key对应的是ThreadLocal，因为我们的组件中需要传输（共享）的对象可能会有多个（不止Connection）</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    createMap(t, value);           <span class="comment">//默认情况下map是没有初始化的，那么第一次往其中添加数据时，会去初始化</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h4 id="get方法源码分析："><a href="#get方法源码分析：" class="headerlink" title="get方法源码分析："></a>get方法源码分析：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> T <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread(); <span class="comment">//获取当前的线程</span></span><br><span class="line"><span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);    <span class="comment">//获取和这个线程（企业）相关的ThreadLocalMap（也就是工作纽带的集合）</span></span><br><span class="line"><span class="keyword">if</span> (map != <span class="literal">null</span>) &#123;</span><br><span class="line">    ThreadLocalMap.<span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> map.getEntry(<span class="built_in">this</span>);   <span class="comment">//this指的是ThreadLocal对象，通过它才能知道是哪一个工作纽带</span></span><br><span class="line">    <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">        <span class="type">T</span> <span class="variable">result</span> <span class="operator">=</span> (T)e.value;     <span class="comment">//entry.value就可以获取到工具箱了</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> setInitialValue();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>当前线程可比作一个企业，本地线程则可比作企业的一个工作，一个工作只有一个工具箱（如连接Connection）一个企业中可有多个工作</p>
</blockquote>
<h3 id="ConnUtil–统一连接"><a href="#ConnUtil–统一连接" class="headerlink" title="ConnUtil–统一连接"></a>ConnUtil–统一连接</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConnUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;Connection&gt; threadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//private static ThreadLocal&lt;Object&gt; threadLocal2 = new ThreadLocal&lt;&gt;();</span></span><br><span class="line">    <span class="comment">//private static ThreadLocal&lt;Object&gt; threadLocal3 = new ThreadLocal&lt;&gt;();</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DRIVER</span> <span class="operator">=</span> <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span> ;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">URL</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/fruitdb?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">USER</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PWD</span> <span class="operator">=</span> <span class="string">&quot;123456&quot;</span> ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Connection <span class="title function_">createConn</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1.加载驱动</span></span><br><span class="line">            Class.forName(DRIVER);</span><br><span class="line">            <span class="comment">//2.通过驱动管理器获取连接对象</span></span><br><span class="line">            <span class="keyword">return</span> DriverManager.getConnection(URL, USER, PWD);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException | SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConn</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> threadLocal.get();</span><br><span class="line">        <span class="keyword">if</span>(conn==<span class="literal">null</span>)&#123;</span><br><span class="line">            conn =createConn();</span><br><span class="line">            threadLocal.set(conn);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> threadLocal.get() ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">closeConn</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> threadLocal.get();</span><br><span class="line">        <span class="keyword">if</span>(conn==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!conn.isClosed())&#123;</span><br><span class="line">            conn.close();</span><br><span class="line">            threadLocal.set(<span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="过滤器无法捕获异常"><a href="#过滤器无法捕获异常" class="headerlink" title="过滤器无法捕获异常"></a>过滤器无法捕获异常</h3><p>问题：如果所有异常都向上抛出，之后统一在过滤器中被发现并处理，但是出现异常的位置就难以定位，所以得在异常处进行处理（try-catch），然后在向上抛出自定义异常</p>
<p>例如在BaseDAO中进行捕获异常在抛出自定义异常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DAOException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DAOException</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/09/30/JavaWeb/image-20220707164807611.png" alt="image-20220707164807611"></p>
<h3 id="TransactionManager"><a href="#TransactionManager" class="headerlink" title="TransactionManager"></a>TransactionManager</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransactionManager</span> &#123;</span><br><span class="line">	<span class="comment">//三个操作获取的都是统一连接，进行开启、提交、回归操作</span></span><br><span class="line">    <span class="comment">//开启事务</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">beginTrans</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        ConnUtil.getConn().setAutoCommit(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//提交事务</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">commit</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> ConnUtil.getConn();</span><br><span class="line">        conn.commit();</span><br><span class="line">        ConnUtil.closeConn();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//回滚事务</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">rollback</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> ConnUtil.getConn();</span><br><span class="line">        conn.rollback();</span><br><span class="line">        ConnUtil.closeConn();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="OpenSessionInViewFilter"><a href="#OpenSessionInViewFilter" class="headerlink" title="OpenSessionInViewFilter"></a>OpenSessionInViewFilter</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebFilter(&quot;*.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OpenSessionInViewFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            TransactionManager.beginTrans(); <span class="comment">//将连接的自动提交改为false</span></span><br><span class="line">            System.out.println(<span class="string">&quot;开启事务....&quot;</span>);</span><br><span class="line">                filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">                TransactionManager.commit();</span><br><span class="line">                System.out.println(<span class="string">&quot;提交事务...&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    TransactionManager.rollback();</span><br><span class="line">                    System.out.println(<span class="string">&quot;回滚事务....&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException ex) &#123;</span><br><span class="line">                    ex.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h3><p>此次水果系统优化，统一了多个DAO方法的事务管理，统一在过滤器中处理，如有异常则回滚，否则可以提交。此方式的改进中需要统一DAO使用的数据库连接，因此编写ConnUtil，利用ThreadLocal，能够将连接保存在Map&lt;&gt;中，使用时获取</p>
<h1 id="监听器"><a href="#监听器" class="headerlink" title="监听器"></a>监听器</h1><h2 id="监听器类型"><a href="#监听器类型" class="headerlink" title="监听器类型"></a>监听器类型</h2><ol>
<li>ServletContextListener - 监听ServletContext对象的创建和销毁的过程</li>
<li>HttpSessionListener - 监听HttpSession对象的创建和销毁的过程</li>
<li>ServletRequestListener - 监听ServletRequest对象的创建和销毁的过程</li>
<li>ServletContextAttributeListener - 监听ServletContext的保存作用域的改动(add,remove,replace)</li>
<li>HttpSessionAttributeListener - 监听HttpSession的保存作用域的改动(add,remove,replace)</li>
<li>ServletRequestAttributeListener - 监听ServletRequest的保存作用域的改动(add,remove,replace)</li>
<li>HttpSessionBindingListener - 监听某个对象在Session域中的创建与移除</li>
<li>HttpSessionActivationListener - 监听某个对象在Session域中的序列化和反序列化</li>
</ol>
<h2 id="监听器的使用"><a href="#监听器的使用" class="headerlink" title="监听器的使用"></a>监听器的使用</h2><p>1、监听器需要实现对应的监听器接口，并重写初始和销毁方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebListener</span> <span class="comment">//使用注解配置监听器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContextLoaderListener</span> <span class="keyword">implements</span> <span class="title class_">ServletContextListener</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextInitialized</span><span class="params">(ServletContextEvent servletContextEvent)</span> &#123;</span><br><span class="line">        <span class="comment">//该方法在上下文被创建时调用</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextDestroyed</span><span class="params">(ServletContextEvent servletContextEvent)</span> &#123;</span><br><span class="line">		<span class="comment">//该方法在上下文被销毁时调用</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、识别监听器存在可在web.xml配置文件中添加，也可使用注解添加</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>com.atguigu.listener.MyServletContextListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="水果系统在优化-6"><a href="#水果系统在优化-6" class="headerlink" title="水果系统在优化-6"></a>水果系统在优化-6</h2><h3 id="获取配置文件名的封装"><a href="#获取配置文件名的封装" class="headerlink" title="获取配置文件名的封装"></a>获取配置文件名的封装</h3><h3 id="applicationContext-xml-1"><a href="#applicationContext-xml-1" class="headerlink" title="applicationContext.xml"></a>applicationContext.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>在配置文件中添加上下文参数，在初始时可以通过上下文获取，其目的是避免在java代码中写死配置文件名，可在配置文件中指定配置文件名</p>
</blockquote>
<h3 id="监听器的加入：ContextLoaderListener"><a href="#监听器的加入：ContextLoaderListener" class="headerlink" title="监听器的加入：ContextLoaderListener"></a>监听器的加入：ContextLoaderListener</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//监听上下文启动，在上下文启动的时候去创建IOC容器,然后将其保存到application作用域</span></span><br><span class="line"><span class="comment">//后面中央控制器再从application作用域中去获取IOC容器</span></span><br><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContextLoaderListener</span> <span class="keyword">implements</span> <span class="title class_">ServletContextListener</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextInitialized</span><span class="params">(ServletContextEvent servletContextEvent)</span> &#123;</span><br><span class="line">        <span class="comment">//1.获取ServletContext对象</span></span><br><span class="line">        <span class="type">ServletContext</span> <span class="variable">application</span> <span class="operator">=</span> servletContextEvent.getServletContext();</span><br><span class="line">        <span class="comment">//2.获取上下文的初始化参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> application.getInitParameter(<span class="string">&quot;contextConfigLocation&quot;</span>);</span><br><span class="line">        <span class="comment">//3.创建IOC容器</span></span><br><span class="line">        <span class="type">BeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(path);</span><br><span class="line">        <span class="comment">//4.将IOC容器保存到application作用域                     path是配置文件名</span></span><br><span class="line">        application.setAttribute(<span class="string">&quot;beanFactory&quot;</span>,beanFactory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextDestroyed</span><span class="params">(ServletContextEvent servletContextEvent)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>之前IOC容器是在中央控制器DispatcherServlet中创建的，由于IOC容器承装着所有组件需要使用的实例，因此需要将IOC容器创建时间提前，即在初始Servlet上下文时创建，又因ServletContextListener监听器在Servlet上下文初始时会调用其内部的方法，因此可以重写此方法进行上下文的创建</p>
</blockquote>
<h3 id="DispatcherServlet中构造器"><a href="#DispatcherServlet中构造器" class="headerlink" title="DispatcherServlet中构造器"></a>DispatcherServlet中构造器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;*.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DispatcherServlet</span> <span class="keyword">extends</span> <span class="title class_">ViewBaseServlet</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">    <span class="built_in">super</span>.init();</span><br><span class="line">    <span class="comment">//之前是在此处主动创建IOC容器的</span></span><br><span class="line">    <span class="comment">//现在优化为从application作用域去获取</span></span><br><span class="line">    <span class="comment">//beanFactory = new ClassPathXmlApplicationContext();</span></span><br><span class="line">    <span class="type">ServletContext</span> <span class="variable">application</span> <span class="operator">=</span> getServletContext();</span><br><span class="line">    <span class="type">Object</span> <span class="variable">beanFactoryObj</span> <span class="operator">=</span> application.getAttribute(<span class="string">&quot;beanFactory&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(beanFactoryObj!=<span class="literal">null</span>)&#123;</span><br><span class="line">        beanFactory = (BeanFactory)beanFactoryObj ;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;IOC容器获取失败！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ServletContext即Servlet上下文</p>
</blockquote>
<h1 id="水果系统总结"><a href="#水果系统总结" class="headerlink" title="水果系统总结"></a>水果系统总结</h1><h2 id="MVC各层的设计"><a href="#MVC各层的设计" class="headerlink" title="MVC各层的设计"></a>MVC各层的设计</h2><p><img src="/2022/09/30/JavaWeb/image-20220707235431197.png" alt="image-20220707235431197"></p>
<h1 id="qqZone项目"><a href="#qqZone项目" class="headerlink" title="qqZone项目"></a>qqZone项目</h1><h2 id="1-熟悉QQZone业务需求"><a href="#1-熟悉QQZone业务需求" class="headerlink" title="1.熟悉QQZone业务需求"></a>1.熟悉QQZone业务需求</h2><ol>
<li><p>用户登录</p>
</li>
<li><p>登录成功，显示主界面。左侧显示好友列表；上端显示欢迎词。如果不是自己的空间，显示超链接：返回自己的空间；下端显示日志列表</p>
   <img src="/2022/09/30/JavaWeb/image-20220711100050088.png" alt="image-20220711100050088" style="zoom:50%;"></li>
</ol>
<ol start="3">
<li><p>查看日志详情：</p>
<ul>
<li>日志本身的信息（作者头像、昵称、日志标题、日志内容、日志的日期）</li>
<li>回复列表（回复者的头像、昵称、回复内容、回复日期）</li>
<li>主人回复信息</li>
</ul>
   <img src="/2022/09/30/JavaWeb/image-20220711100334588.png" alt="image-20220711100334588" style="zoom:50%;"></li>
</ol>
<ol start="4">
<li><p>删除日志（主页面标签）</p>
</li>
<li><p>删除特定回复（删除时应该是检查是否有被主人回复过，有则先删除主人回复在删除此回复）</p>
</li>
<li><p>删除特定主人回复</p>
</li>
<li><p>添加日志、添加回复、添加主人回复</p>
</li>
<li><p>点击左侧好友链接，进入好友的空间</p>
</li>
</ol>
<h2 id="2-数据库设计"><a href="#2-数据库设计" class="headerlink" title="2.数据库设计"></a>2.数据库设计</h2><h3 id="1-抽取实体"><a href="#1-抽取实体" class="headerlink" title="1.抽取实体"></a>1.抽取实体</h3><ul>
<li>用户登录信息</li>
<li>用户详情信息</li>
<li>日志 </li>
<li>回贴  </li>
<li>主人回复</li>
</ul>
<h3 id="2-分析其中的属性"><a href="#2-分析其中的属性" class="headerlink" title="2.分析其中的属性"></a>2.分析其中的属性</h3><ul>
<li><p>用户登录信息：账号、密码、头像、昵称</p>
</li>
<li><p>用户详情信息：真实姓名、星座、血型、邮箱、手机号…..</p>
</li>
<li><p>日志：标题、内容、日期、作者</p>
</li>
</ul>
<ul>
<li>回复：内容、日期、作者、日志</li>
<li>主人回复：内容、日期、作者、回复</li>
</ul>
<h3 id="3-分析实体之间的关系"><a href="#3-分析实体之间的关系" class="headerlink" title="3.分析实体之间的关系"></a>3.分析实体之间的关系</h3><ul>
<li>用户登录信息 ： 用户详情信息      1：1 PK</li>
<li>用户 ： 日志                   1：N</li>
<li>日志 ： 回复                   1：N</li>
<li>回复 ： 主人回复                1：1 UK</li>
<li>用户 ： 好友                   M ： N</li>
</ul>
<h3 id="4-QQZone-ER图"><a href="#4-QQZone-ER图" class="headerlink" title="4.QQZone-ER图"></a>4.QQZone-ER图</h3><p><img src="/2022/09/30/JavaWeb/image-20220711112329855.png" alt="image-20220711112329855"></p>
<h3 id="5-数据库的范式"><a href="#5-数据库的范式" class="headerlink" title="5.数据库的范式"></a>5.数据库的范式</h3><p>1） 第一范式：列不可再分<br>2） 第二范式：一张表只表达一层含义（只描述一件事情）<br>3） 第三范式：表中的每一列和主键都是直接依赖关系，而不是间接依赖<br>4.数据库设计的范式和数据库的查询性能很多时候是相悖的，我们需要根据实际的业务情况做一个选择：</p>
<ul>
<li>查询频次不高的情况下，我们更倾向于提高数据库的设计范式，从而提高存储效率</li>
<li>查询频次较高的情形，我们更倾向于牺牲数据库的规范度，降低数据库设计的范式，允许特定的冗余，从而提高查询的性能</li>
</ul>
<h3 id="6-查询好友列表"><a href="#6-查询好友列表" class="headerlink" title="6.查询好友列表"></a>6.查询好友列表</h3><p><img src="/2022/09/30/JavaWeb/image-20220711112727972.png" alt="image-20220711112727972"></p>
<h2 id="3-项目初始化工作"><a href="#3-项目初始化工作" class="headerlink" title="3.项目初始化工作"></a>3.项目初始化工作</h2><p>1.创建JavaWeb工程配置tomcat，导入MySQL的jar包驱动和thyenleaf的jar包，将其设置为library，将在library添加到该工程依赖</p>
<p>2.将myssm加入进来</p>
<img src="/2022/09/30/JavaWeb/image-20220711114002663.png" alt="image-20220711114002663" style="zoom: 67%;">

<p><strong>监听器listeners</strong>：在上下文创建时即Tomcat开启时，调用其中的contextInitialized初始方法</p>
<ul>
<li><p>创建IOC容器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(path);</span><br></pre></td></tr></table></figure>
</li>
<li><p>将IOC容器保存到application作用域</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">application.setAttribute(<span class="string">&quot;beanFactory&quot;</span>,beanFactory);</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>ioc</strong>：通过读取配置文件applicationContext，为其中的类和即类的属性创建实例，并保存在beanMap中（容器）</p>
<p><strong>filters过滤器</strong>：设置编码、开启事务、提交事务、回滚事务</p>
<p><strong>basedao</strong>：ConnUtil创建数据库连接，BaseDAO提供操作数据的基本接口实现</p>
<p><strong>myspringmvc</strong>：</p>
<ul>
<li><p>DispatcherServlet中央控制器：获取客户端发来的请求，首先提取请求中xxx.do，从application作用域中保存的IOC容器里取出xxx对应的实例，在提取请求中operate和方法参数，实现xxx实例中operate对应的方法</p>
</li>
<li><p>ViewBaseServlet：通过加入前后缀找到指定页面，配合thyemleaf将数据渲染在指定页面上，响应给客户端</p>
</li>
<li><p>pageController：由于有些页面直接访问xxx.html，没有经过服务器ViewBaseServlet，没有创建thyemleaf实例，无法使用thyemleaf语法，因此改进，将这些直接访问的页面都先发送至这个页面（page.do）</p>
<p>请求：<a target="_blank" rel="noopener" href="http://localhost:8080/pro22/page.do?operate=page&amp;page=login">http://localhost:8080/pro22/page.do?operate=page&amp;page=login</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageController</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">page</span><span class="params">(String page)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> page ;       <span class="comment">// frames/left</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="4-功能一实现"><a href="#4-功能一实现" class="headerlink" title="4.功能一实现"></a>4.功能一实现</h2><h3 id="功能一"><a href="#功能一" class="headerlink" title="功能一"></a>功能一</h3><ul>
<li>登录页面</li>
<li>登录成功后的页面，显示好友列表，日志列表，顶端的欢迎信息</li>
<li>点击好友名称超链接可进入其空间</li>
<li>显示好友空间中的日志列表，顶端欢迎信息和返回自己空间的超链接</li>
</ul>
<h3 id="login-html"><a href="#login-html" class="headerlink" title="login.html"></a>login.html</h3><img src="/2022/09/30/JavaWeb/image-20220711100006670.png" alt="image-20220711100006670" style="zoom:50%;">



<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;center&quot;</span>&gt;</span>用户登录1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/user.do&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;operate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;login&quot;</span>/&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">th</span>&gt;</span>用户名：<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;loginId&quot;</span> <span class="attr">value</span>=<span class="string">&quot;u001&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">th</span>&gt;</span>密码：<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;pwd&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ok&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">th</span> <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">                          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;登录&quot;</span>/&gt;</span></span><br><span class="line">                          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;还没有账号？&quot;</span>/&gt;</span></span><br><span class="line">                      <span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>发送至user.do，operate为login，loginId&#x3D;u001，pwd&#x3D;ok</p>
</blockquote>
<h3 id="UserController"><a href="#UserController" class="headerlink" title="UserController"></a>UserController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserBasicService userBasicService ;</span><br><span class="line">    <span class="keyword">private</span> TopicService topicService ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">login</span><span class="params">(String loginId , String pwd , HttpSession session)</span>&#123;</span><br><span class="line">        <span class="comment">//1.登录验证</span></span><br><span class="line">        <span class="type">UserBasic</span> <span class="variable">userBasic</span> <span class="operator">=</span> userBasicService.login(loginId, pwd); <span class="comment">//查找数据库是否有</span></span><br><span class="line">        <span class="keyword">if</span>(userBasic!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//1-1 获取相关的好友信息</span></span><br><span class="line">            List&lt;UserBasic&gt; friendList = userBasicService.getFriendList(userBasic);</span><br><span class="line">            <span class="comment">//1-2 获取相关的日志列表信息(但是，日志只有id，没有其他信息）</span></span><br><span class="line">            List&lt;Topic&gt; topicList = topicService.getTopicList(userBasic);</span><br><span class="line"></span><br><span class="line">            userBasic.setFriendList(friendList);</span><br><span class="line">            userBasic.setTopicList(topicList);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//userBasic这个key保存的是登陆者的信息</span></span><br><span class="line">            <span class="comment">//friend这个key保存的是当前进入的是谁的空间</span></span><br><span class="line">            session.setAttribute(<span class="string">&quot;userBasic&quot;</span>,userBasic);</span><br><span class="line">            session.setAttribute(<span class="string">&quot;friend&quot;</span>,userBasic);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>; <span class="comment">//成功后返回到中央控制器，将响应index.html给客户端</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">friend</span><span class="params">(Integer id, HttpSession session)</span>&#123;</span><br><span class="line">        <span class="comment">//1.根据id获取指定的用户信息</span></span><br><span class="line">        <span class="type">UserBasic</span> <span class="variable">currFriend</span> <span class="operator">=</span> userBasicService.getUserBasicById(id);</span><br><span class="line">		<span class="comment">//2.查询对应日志列表</span></span><br><span class="line">        List&lt;Topic&gt; topicList = topicService.getTopicList(currFriend);</span><br><span class="line">		<span class="comment">//3.添加赋值</span></span><br><span class="line">        currFriend.setTopicList(topicList);</span><br><span class="line">		<span class="comment">//4.覆盖session中friend</span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;friend&quot;</span>,currFriend);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>UserController中有两个业务属性，为控制器服务</p>
<h3 id="index-html"><a href="#index-html" class="headerlink" title="index.html"></a>index.html</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_top&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">iframe</span>  <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/page.do?operate=page&amp;page=frames/top&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_left&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/page.do?operate=page&amp;page=frames/left&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_main&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/page.do?operate=page&amp;page=frames/main&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_bottom&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;center&quot;</span> &gt;</span>版权所有<span class="symbol">&amp;reg;</span>，欢迎盗版<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>index页面中有四个板块div_top、div_left、div_main、div_bottom</p>
<p>其中三个div_top、div_left、div_main页面会再去请求响应的页面</p>
<h3 id="main-html"><a href="#main-html" class="headerlink" title="main.html"></a>main.html</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_topic_list&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_to_add&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;right8&quot;</span>&gt;</span>发表新日志<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">&quot;tbl_topic_list&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>标题<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>日期<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;#lists.isEmpty(session.friend.topicList)&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span> <span class="attr">colspan</span>=<span class="string">&quot;4&quot;</span>&gt;</span>暂无日志列表<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:unless</span>=<span class="string">&quot;$&#123;#lists.isEmpty(session.friend.topicList)&#125;&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;topic : $&#123;session.friend.topicList&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;topic.id&#125;&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;topic.title&#125;&quot;</span>&gt;</span>我乔峰要走，你们谁可阻拦<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;topic.topicDate&#125;&quot;</span>&gt;</span>2021-09-01 12:30:55<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;删除&quot;</span> &lt;/<span class="attr">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>topicList从session中friend获取，无论自己和别人的空间，topicList都是对应的，而friendList只显示自己的好友列表</p>
<p>这里删除日志功能还未实现，下面实现</p>
</blockquote>
<h3 id="left-html"><a href="#left-html" class="headerlink" title="left.html"></a>left.html</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_friendList&quot;</span> &gt;</span></span><br><span class="line">       我的好友<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;#lists.isEmpty(session.userBasic.friendList)&#125;&quot;</span>&gt;</span>一个好友也没有<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:unless</span>=<span class="string">&quot;$&#123;#lists.isEmpty(session.userBasic.friendList)&#125;&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;friend : $&#123;session.userBasic.friendList&#125;&quot;</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;|/user.do?operate=friend&amp;id=$&#123;friend.id&#125;|&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;friend.nickName&#125;&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_top&quot;</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>friendList从session中userBasic获取</p>
<p>名字设置超链接，可进入别人的空间。</p>
<p>发送请求：&#x2F;user.do?operate&#x3D;friend&amp;id&#x3D;${friend.id} ，重新覆盖friend，更新其id和日志列表</p>
</blockquote>
<h3 id="top-html"><a href="#top-html" class="headerlink" title="top.html"></a>top.html</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;top_title&quot;</span> &gt;</span>欢迎来到QQZone1！<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;top_link_div&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;|欢迎进入$&#123;session.friend.nickName&#125;的空间！|&quot;</span>&gt;</span>欢迎进入Jim的空间！<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        判断进入的是否是自己的空间的依据是：</span></span><br><span class="line"><span class="comment">        userBasic和friend这两个key中保存的UserBasic是否一致</span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment">        userBasic:&lt;span th:text=&quot;$&#123;session.userBasic.id&#125;&quot;&gt;&lt;/span&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="comment">        friend:&lt;span th:text=&quot;$&#123;session.friend.id&#125;&quot;&gt;&lt;/span&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;session.userBasic.id!=session.friend.id&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;|/user.do?operate=friend&amp;id=$&#123;session.userBasic.id&#125;|&#125;&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_top&quot;</span>&gt;</span>返回自己的空间!<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>top.html页面显示登录者昵称、判断是否是自己的空间<br>1)显示登录者昵称： ${session.userBasic.nickName}<br>2)判断是否是自己的空间 : ${session.userBasic.id!&#x3D;session.friend.id}</p>
<p>如果这里不是自己空间，则session.userBasic.id不等于session.friend.id，，显示“返回自己空间！”的文字超链接 </p>
<p>点击后发送&#x2F;user.do?operate&#x3D;friend&amp;id&#x3D;${session.userBasic.id} ,重写覆盖friend，更新其id和日志列表</p>
</blockquote>
<h3 id="实现功能一的问题"><a href="#实现功能一的问题" class="headerlink" title="实现功能一的问题"></a>实现功能一的问题</h3><p>1）URL没修改，用的还是fruitdb<br>2）忘记别名，userBasic属性中没有fid，只有id属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;UserBasic&gt; <span class="title function_">getUserBasicList</span><span class="params">(UserBasic userBasic)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT fid as &#x27;id&#x27; FROM t_friend WHERE uid = ?&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.executeQuery(sql,userBasic.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 3）rsmd.getColumnName：只能显示列名、rsmd.getColumnLabel()：有别名显示别名，没有别名显示列名<br> 4）Can not set com.atguigu.qqzone.pojo.UserBasic field com.atguigu.qqzone.pojo.Topic.author to java.lang.Integer</p>
<p>5）left.html页面没有样式，同时数据也不展示，原因是：我们是直接去请求的静态页面资源，那么并没有执行super.processTemplate()，也就是thymeleaf没有起作用<br>(之前的表单也是这个原因)<br>解决方法：</p>
<ul>
<li><p>新增PageController，添加page方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">page</span><span class="params">(String page)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> page ;       <span class="comment">// frames/left</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>目的是执行super.processTemplate()方法，让thymeleaf生效</p>
</li>
</ul>
<p>6）点击左侧的好友链接，进入好友空间</p>
<ol>
<li>根据id获取指定userBasic信息，查询这个userBasic的topicList，然后覆盖friend对应的value</li>
<li>main页面应该展示friend中的topicList，而不是userBasic中的topicList</li>
<li>跳转后，在左侧（left）中显示整个index页面<ul>
<li>问题：在left页面显示整个index布局</li>
<li>解决：给超链接添加target属性：   target&#x3D;”_top” 保证在顶层窗口显示整个index页面</li>
</ul>
</li>
<li>top.html页面需要修改： “欢迎进入${session.friend}”<br>top.html页面的返回自己空间的超链接需要修改：<a th:href="@{|/user.do?operate=friend&id=${session.userBasic.id}|}" target="_top"></a></li>
</ol>
<p>7）补充target用法</p>
<p><img src="/2022/09/30/JavaWeb/image-20220710105146793.png" alt="image-20220710105146793"></p>
<h2 id="5-功能二实现"><a href="#5-功能二实现" class="headerlink" title="5.功能二实现"></a>5.功能二实现</h2><h3 id="功能二"><a href="#功能二" class="headerlink" title="功能二"></a>功能二</h3><p>显示日志详情页面（detail.html）****</p>
<ul>
<li>日志作者和作者头像、日志标题、日志内容、日志发布时间</li>
<li>回复作者和作者头像、回复标题、回复内容、回复时间</li>
</ul>
<p><strong>日志详情页面实现和解决问题</strong></p>
<ol>
<li>已知topic的id，需要根据topic的id获取特定topic</li>
<li>获取这个topic关联的所有的回复</li>
<li>如果某个回复有主人回复，需要查询出来</li>
</ol>
<ul>
<li>在TopicController中获取指定的topic</li>
<li>具体这个topic中关联多少个Reply，由ReplyService内部实现</li>
</ul>
<ol start="4">
<li>获取到的topic中的author只有id，那么需要在topicService的getTopic方法中封装，在查询topic本身信息时，同时调用userBasicService中的获取getuserBasic方法，给author属性赋值</li>
<li>同理，在reply类中也有author，而且这个author也是只有id，那么我们也需要根据id查询得到author，最后设置关联</li>
</ol>
<h3 id="main-html-1"><a href="#main-html-1" class="headerlink" title="main.html"></a>main.html</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:unless</span>=<span class="string">&quot;$&#123;#lists.isEmpty(session.friend.topicList)&#125;&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;topic : $&#123;session.friend.topicList&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;topic.id&#125;&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;|/topic.do?operate=topicDetail&amp;id=$&#123;topic.id&#125;|&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;topic.title&#125;&quot;</span>&gt;</span>我乔峰要走，你们谁可阻拦<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;topic.topicDate&#125;&quot;</span>&gt;</span>2021-09-01 12:30:55<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;删除&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;session.userBasic.id==session.friend.id&#125;&quot;</span> <span class="attr">th:onclick</span>=<span class="string">&quot;|delTopic($&#123;topic.id&#125;)|&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在日志标题加入超链接，连接至topic.do?operate&#x3D;topicDetail&amp;id&#x3D;${topic.id}</p>
<h3 id="TopicController"><a href="#TopicController" class="headerlink" title="TopicController"></a>TopicController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TopicController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> TopicService topicService ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">topicDetail</span><span class="params">(Integer id , HttpSession session)</span>&#123;</span><br><span class="line">        <span class="type">Topic</span> <span class="variable">topic</span> <span class="operator">=</span> topicService.getTopicById(id);<span class="comment">//</span></span><br><span class="line"></span><br><span class="line">        session.setAttribute(<span class="string">&quot;topic&quot;</span>,topic); <span class="comment">//detail.html中通过topic获取数据</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;frames/detail&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="关键方法：获取回复列表"><a href="#关键方法：获取回复列表" class="headerlink" title="关键方法：获取回复列表"></a>关键方法：获取回复列表</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReplyServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ReplyService</span> &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Reply&gt; <span class="title function_">getReplyListByTopicId</span><span class="params">(Integer topicId)</span> &#123;</span><br><span class="line">    List&lt;Reply&gt; replyList = replyDAO.getReplyList(<span class="keyword">new</span> <span class="title class_">Topic</span>(topicId));</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; replyList.size(); i++) &#123;</span><br><span class="line">        <span class="type">Reply</span> <span class="variable">reply</span> <span class="operator">=</span> replyList.get(i);</span><br><span class="line">        <span class="comment">//1.将关联的作者设置进去</span></span><br><span class="line">        <span class="type">UserBasic</span> <span class="variable">author</span> <span class="operator">=</span> userBasicService.getUserBasicById(reply.getAuthor().getId());</span><br><span class="line">        reply.setAuthor(author);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.将关联的HostReply设置进去</span></span><br><span class="line">        <span class="type">HostReply</span> <span class="variable">hostReply</span> <span class="operator">=</span> hostReplyService.getHostReplyByReplyId(reply.getId());</span><br><span class="line">        reply.setHostReply(hostReply);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> replyList ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="detail-html"><a href="#detail-html" class="headerlink" title="detail.html"></a>detail.html</h3><img src="/2022/09/30/JavaWeb/image-20220711100334588.png" alt="image-20220711100334588" style="zoom:50%;">

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_topic_info&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;|/imgs/$&#123;session.topic.author.headImg&#125;|&#125;&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;session.topic.author.nickName&#125;&quot;</span>&gt;</span>乔峰<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;session.topic.title&#125;&quot;</span>&gt;</span>《萧某今天就和天下群雄决一死战，你们一起上吧！》<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;session.topic.topicDate&#125;&quot;</span>&gt;</span>2021-09-01 12:30:55<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;session.topic.content&#125;&quot;</span>&gt;</span>杀母大仇, 岂可当作买卖交易？此仇能报便报, 如不能报, 则我父子毕命于此便了。这等肮脏之事, 岂是我萧氏父子所屑为？<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_reply_list&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;tbl_reply_info&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;reply : $&#123;session.topic.replyList&#125;&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;img48&quot;</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;|/imgs/$&#123;reply.author.headImg&#125;|&#125;&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;h32 center&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:100%;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;reply.author.nickName&#125;&quot;</span>&gt;</span>段誉<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"> <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;|回复：$&#123;session.topic.title&#125;|&quot;</span>&gt;</span>萧某今天就和天下群雄决一死战，你们一起上吧！<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;title_date_right&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;reply.replyDate&#125;&quot;</span>&gt;</span>2021-09-01 14:35:15<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;reply.content&#125;&quot;</span>&gt;</span>你可曾见过边关之上、宋辽相互仇杀的惨状？可曾见过宋人辽人妻离子散、家破人亡的情景？宋辽之间好容易罢兵数十年, 倘若刀兵再起, 契丹铁骑侵入南朝, 你可知将有多少宋人惨遭横死？多少辽人死于非命？!<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">  </span><br><span class="line"> <span class="tag">&lt;<span class="name">ul</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;reply.hostReply!=null&#125;&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;reply.hostReply.content&#125;&quot;</span>&gt;</span>你以为我是慕容复的人，所以和我比试？段兄弟年纪轻轻，就有如此武学修为，实属罕见！武林早已盛传大理段氏有一门绝学，叫六脉神剑，能以无形剑气杀人，果然真有此门神功！<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">li</span>  <span class="attr">th:text</span>=<span class="string">&quot;|主人回复于$&#123;reply.hostReply.hostReplyDate&#125;|&quot;</span>&gt;</span>主人回复于2021/10/01 11:50:30<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:id</span>=<span class="string">&quot;|a$&#123;reply.id&#125;|&quot;</span> <span class="attr">th:unless</span>=<span class="string">&quot;$&#123;reply.hostReply!=null&#125;&quot;</span>  <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">style</span>=<span class="string">&quot;float: right;display: none;&quot;</span>&gt;</span>主人回复<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>主人回复操作本项目没有实现，留给同学们实现</p>
</blockquote>
<h2 id="6-功能三实现"><a href="#6-功能三实现" class="headerlink" title="6.功能三实现"></a>6.功能三实现</h2><h3 id="功能三"><a href="#功能三" class="headerlink" title="功能三"></a>功能三</h3><ol>
<li>添加回复</li>
<li>删除回复<ol>
<li>如果回复有关联的主人回复，需要先删除主人回复</li>
<li>删除回复<br>Cannot delete or update a parent row: a foreign key constraint fails<br>(<code>qqzonedb</code>.<code>t_host_reply</code>, CONSTRAINT <code>FK_host_reply</code> FOREIGN KEY (<code>reply</code>) REFERENCES <code>t_reply</code> (<code>id</code>))<br> 我们在删除回复表记录时，发现删除失败，原因是：在主人回复表中仍然有记录引用待删除的回复这条记录<br> 如果需要删除主表数据，需要首先删除子表数据</li>
</ol>
</li>
</ol>
<h3 id="detail-html–添加回复"><a href="#detail-html–添加回复" class="headerlink" title="detail.html–添加回复"></a>detail.html–添加回复</h3><img src="/2022/09/30/JavaWeb/image-20220711100334588.png" alt="image-20220711100334588" style="zoom:50%;">

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_add_reply&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;add_reply_title&quot;</span>&gt;</span>添加回复<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;reply.do&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;operate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;addReply&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;topicId&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;session.topic.id&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span> <span class="attr">style</span>=<span class="string">&quot;width: 25%&quot;</span>&gt;</span>回复日志：<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;|《$&#123;session.topic.title&#125;》|&quot;</span> <span class="attr">value</span>=<span class="string">&quot;《萧某今天就和天下群雄决一死战，你们一起上吧！》&quot;</span> <span class="attr">readonly</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>回复内容1：<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">&quot;content&quot;</span> <span class="attr">rows</span>=<span class="string">&quot;3&quot;</span>&gt;</span>这里是另一个回复！<span class="tag">&lt;/<span class="name">textarea</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span> <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot; 回 复 &quot;</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;reset&quot;</span> <span class="attr">value</span>=<span class="string">&quot; 重 置 &quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>将发送这些数据值服务器ReplyController：</p>
<p>reply.do ,operate&#x3D;addReply，两个属性：name&#x3D;”topicId” th:value&#x3D;”${session.topic.id}”  name&#x3D;”content”</p>
</blockquote>
<h3 id="ReplyController"><a href="#ReplyController" class="headerlink" title="ReplyController"></a>ReplyController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReplyController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ReplyService replyService ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">addReply</span><span class="params">(String content ,Integer topicId , HttpSession session)</span>&#123;</span><br><span class="line">        <span class="type">UserBasic</span> <span class="variable">author</span> <span class="operator">=</span> (UserBasic)session.getAttribute(<span class="string">&quot;userBasic&quot;</span>);</span><br><span class="line">        <span class="type">Reply</span> <span class="variable">reply</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Reply</span>(content , <span class="keyword">new</span> <span class="title class_">Date</span>() , author , <span class="keyword">new</span> <span class="title class_">Topic</span>(topicId));</span><br><span class="line">        replyService.addReply(reply);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:topic.do?operate=topicDetail&amp;id=&quot;</span>+topicId;</span><br><span class="line">        <span class="comment">// 不能直接跳转detail.html，因为刚加入的回复session中的topic还没更新，所以得重新查一遍</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">delReply</span><span class="params">(Integer replyId , Integer topicId)</span>&#123;</span><br><span class="line">        replyService.delReply(replyId);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:topic.do?operate=topicDetail&amp;id=&quot;</span>+topicId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="detail-html–删除回复"><a href="#detail-html–删除回复" class="headerlink" title="detail.html–删除回复"></a>detail.html–删除回复</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;JavaScript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">showDelImg</span>(<span class="params">imgId</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> obj = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(imgId) ;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(obj)&#123;</span></span><br><span class="line"><span class="language-javascript">                obj.<span class="property">style</span>.<span class="property">display</span>=<span class="string">&#x27;inline&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">hiddenDelImg</span>(<span class="params">imgId</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> obj = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(imgId) ;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(obj)&#123;</span></span><br><span class="line"><span class="language-javascript">                obj.<span class="property">style</span>.<span class="property">display</span>=<span class="string">&#x27;none&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">delReply</span>(<span class="params">replyId , topicId</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(<span class="variable language_">window</span>.<span class="title function_">confirm</span>(<span class="string">&quot;是否确认删除？&quot;</span>))&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&#x27;reply.do?operate=delReply&amp;replyId=&#x27;</span>+replyId+<span class="string">&#x27;&amp;topicId=&#x27;</span>+topicId;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_reply_list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;reply_title&quot;</span> <span class="attr">th:onmouseover</span>=<span class="string">&quot;|showDelImg(&#x27;img$&#123;reply.id&#125;&#x27;)|&quot;</span> <span class="attr">th:onmouseout</span>=<span class="string">&quot;|hiddenDelImg(&#x27;img$&#123;reply.id&#125;&#x27;)|&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;|回复：$&#123;session.topic.title&#125;|&quot;</span>&gt;</span>萧某今天就和天下群雄决一死战，你们一起上吧！<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">                            出现删除这个小图标的条件：</span></span><br><span class="line"><span class="comment">                            1. 在我自己的空间（那当然我对自己的空间拥有所有的操作权限）</span></span><br><span class="line"><span class="comment">                            2. 当前回复的作者就是我（那我可以删除自己的回复）</span></span><br><span class="line"><span class="comment">                         --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;session.userBasic.id==session.friend.id || session.userBasic.id==reply.author.id&#125;&quot;</span> <span class="attr">th:id</span>=<span class="string">&quot;|img$&#123;reply.id&#125;|&quot;</span> <span class="attr">class</span>=<span class="string">&quot;delReplyImg&quot;</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/imgs/del.jpg&#125;&quot;</span> <span class="attr">th:onclick</span>=<span class="string">&quot;|delReply($&#123;reply.id&#125; , $&#123;session.topic.id&#125;)|&quot;</span>/&gt;</span></span><br><span class="line">       </span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;title_date_right&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;reply.replyDate&#125;&quot;</span>&gt;</span>2021-09-01 14:35:15<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>每个日志的删除图标的id都不同，因为JavaScript会创建对象之后寻找对于id的标签进行操作</p>
<p>JavaScript方法：delReply(replyId , topicId)  </p>
<ul>
<li>发送请求：’reply.do?operate&#x3D;delReply&amp;replyId&#x3D;’+replyId+’&amp;topicId&#x3D;’+topicId;</li>
</ul>
</blockquote>
<h3 id="ReplyController-1"><a href="#ReplyController-1" class="headerlink" title="ReplyController"></a>ReplyController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReplyController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ReplyService replyService ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">delReply</span><span class="params">(Integer replyId , Integer topicId)</span>&#123;</span><br><span class="line">        replyService.delReply(replyId);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:topic.do?operate=topicDetail&amp;id=&quot;</span>+topicId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ReplyServiceImpl"><a href="#ReplyServiceImpl" class="headerlink" title="ReplyServiceImpl"></a>ReplyServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReplyServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ReplyService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ReplyDAO replyDAO ;</span><br><span class="line">    <span class="comment">//此处引入的是其他POJO对应的Service接口，而不是DAO接口</span></span><br><span class="line">    <span class="comment">//其他POJO对应的业务逻辑是封装在service层的，我需要调用别人的业务逻辑方法，而不要去深入考虑人家内部的细节</span></span><br><span class="line">    <span class="keyword">private</span> HostReplyService hostReplyService ;</span><br><span class="line">    <span class="keyword">private</span> UserBasicService userBasicService ;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delReply</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="comment">//1.根据id获取到reply</span></span><br><span class="line">        <span class="type">Reply</span> <span class="variable">reply</span> <span class="operator">=</span> replyDAO.getReply(id);</span><br><span class="line">        <span class="keyword">if</span>(reply!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//2.如果reply有关联的hostReply，则先删除hostReply</span></span><br><span class="line">            <span class="type">HostReply</span> <span class="variable">hostReply</span> <span class="operator">=</span> hostReplyService.getHostReplyByReplyId(reply.getId());</span><br><span class="line">            <span class="keyword">if</span>(hostReply!=<span class="literal">null</span>)&#123;</span><br><span class="line">                hostReplyService.delHostReply(hostReply.getId());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//3.删除reply</span></span><br><span class="line">            replyDAO.delReply(id);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>delReply方法：如果回复有关联的主人回复，需要先删除主人回复</p>
</blockquote>
<h2 id="功能四实现"><a href="#功能四实现" class="headerlink" title="功能四实现"></a>功能四实现</h2><h3 id="功能四"><a href="#功能四" class="headerlink" title="功能四"></a>功能四</h3><p>删除日志</p>
<ol>
<li>删除日志，首先需要考虑是否有关联的回复</li>
<li>删除回复，首先需要考虑是否有关联的主人回复</li>
<li>另外，如果不是自己的空间，则不能删除日志</li>
</ol>
<h3 id="main-html-2"><a href="#main-html-2" class="headerlink" title="main.html"></a>main.html</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;JavaScript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">delTopic</span>(<span class="params">topicId</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(<span class="variable language_">window</span>.<span class="title function_">confirm</span>(<span class="string">&quot;是否确认删除日志？&quot;</span>))&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&quot;topic.do?operate=delTopic&amp;topicId=&quot;</span>+topicId;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;#lists.isEmpty(session.friend.topicList)&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span> <span class="attr">colspan</span>=<span class="string">&quot;4&quot;</span>&gt;</span>暂无日志列表<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:unless</span>=<span class="string">&quot;$&#123;#lists.isEmpty(session.friend.topicList)&#125;&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;topic : $&#123;session.friend.topicList&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;删除&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;session.userBasic.id==session.friend.id&#125;&quot;</span> <span class="attr">th:onclick</span>=<span class="string">&quot;|delTopic($&#123;topic.id&#125;)|&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="TopicController-1"><a href="#TopicController-1" class="headerlink" title="TopicController"></a>TopicController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TopicController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TopicService topicService ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">delTopic</span><span class="params">(Integer topicId)</span>&#123;</span><br><span class="line">        topicService.delTopic(topicId);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:topic.do?operate=getTopicList&quot;</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getTopicList</span><span class="params">(HttpSession session)</span>&#123;</span><br><span class="line">        <span class="comment">//从session中获取当前用户信息</span></span><br><span class="line">        <span class="type">UserBasic</span> <span class="variable">userBasic</span> <span class="operator">=</span> (UserBasic)session.getAttribute(<span class="string">&quot;userBasic&quot;</span>);</span><br><span class="line">        <span class="comment">//再次查询当前用户关联的所有的日志</span></span><br><span class="line">        List&lt;Topic&gt; topicList = topicService.getTopicList(userBasic);</span><br><span class="line">        <span class="comment">//设置一下关联的日志列表(因为之前session中关联的friend的topicList和此刻数据库中不一致）</span></span><br><span class="line">        userBasic.setTopicList(topicList);</span><br><span class="line">        <span class="comment">//重新覆盖一下friend中的信息(为什么不覆盖userbasic中？因为main.html页面迭代的是friend这个key中的数据)</span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;friend&quot;</span>,userBasic);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;frames/main&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里是删除完日志后不能直接访问main.html，因为其中session中friend的topicList还没更新，所以再次请求，完成getTopicList方法，更新topicList</p>
</blockquote>
<h3 id="TopicServiceImpl"><a href="#TopicServiceImpl" class="headerlink" title="TopicServiceImpl"></a>TopicServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TopicServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">TopicService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">TopicDAO</span> <span class="variable">topicDAO</span> <span class="operator">=</span> <span class="literal">null</span> ;</span><br><span class="line">    <span class="comment">//此处引用的是replyService，而不是replyDAO</span></span><br><span class="line">    <span class="keyword">private</span> ReplyService replyService ;</span><br><span class="line">    <span class="keyword">private</span> UserBasicService userBasicService ;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delTopic</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">    <span class="type">Topic</span> <span class="variable">topic</span> <span class="operator">=</span> topicDAO.getTopic(id);</span><br><span class="line">    <span class="keyword">if</span>(topic!=<span class="literal">null</span>)&#123;</span><br><span class="line">        replyService.delReplyList(topic); <span class="comment">//删除日志先删除回复列表</span></span><br><span class="line">        topicDAO.delTopic(topic);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ReplyServiceImpl-1"><a href="#ReplyServiceImpl-1" class="headerlink" title="ReplyServiceImpl"></a>ReplyServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReplyServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ReplyService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ReplyDAO replyDAO ;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delReplyList</span><span class="params">(Topic topic)</span> &#123;</span><br><span class="line">    List&lt;Reply&gt; replyList = replyDAO.getReplyList(topic);</span><br><span class="line">    <span class="keyword">if</span>(replyList!=<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(Reply reply : replyList)&#123; <span class="comment">//逐个删除回复</span></span><br><span class="line">            delReply(reply.getId()); <span class="comment">//删除该条回复，包括回复关联有主人回复的回复</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="复习总结-1"><a href="#复习总结-1" class="headerlink" title="复习总结"></a>复习总结</h2><h3 id="1-日期和字符串之间的格式化"><a href="#1-日期和字符串之间的格式化" class="headerlink" title="1.日期和字符串之间的格式化"></a>1.日期和字符串之间的格式化</h3><p> String -&gt; java.util.Date</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">dateStr1</span> <span class="operator">=</span> <span class="string">&quot;2021-12-30 12:59:59&quot;</span>;</span><br><span class="line"><span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">Date</span> <span class="variable">date1</span> <span class="operator">=</span> sdf.parse(dateStr1);</span><br><span class="line">&#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Date -&gt; String</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Date</span> <span class="variable">date2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="type">String</span> <span class="variable">dateStr2</span> <span class="operator">=</span> sdf.format(date2);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>thymeleaf中使用#dates这个公共的内置对象，进行修改网页显示的时间格式<br>$</p>
</blockquote>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Qinghai2021</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2022/09/30/JavaWeb/">http://example.com/2022/09/30/JavaWeb/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Qinghai2021·博客</a>！</span></div></div><div class="tag_share"><div class="post_share"><div class="social-share" data-image="/images/background.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://fastly.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/10/02/%E5%B0%9A%E7%A1%85%E8%B0%B7java%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/"><img class="prev-cover" src="/images/background.jpg" onerror="onerror=null;src='https://api.ixiaowai.cn/gqapi/gqapi.php'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Java编程基础</div></div></a></div><div class="next-post pull-right"><a href="/2022/09/30/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"><img class="next-cover" src="/images/background.jpg" onerror="onerror=null;src='https://api.ixiaowai.cn/gqapi/gqapi.php'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">计算机网络</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E4%BD%93%E7%B3%BB%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.</span> <span class="toc-text">课程体系设计</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%BE%E4%BB%B6"><span class="toc-number">2.</span> <span class="toc-text">课件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86"><span class="toc-number">3.</span> <span class="toc-text">前端知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#HTML"><span class="toc-number">3.1.</span> <span class="toc-text">HTML</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HTML%E4%B8%AD%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A0%87%E7%AD%BE"><span class="toc-number">3.1.1.</span> <span class="toc-text">HTML中的基础标签</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CSS"><span class="toc-number">3.2.</span> <span class="toc-text">CSS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CSS%E7%9A%84%E8%AF%AD%E6%B3%95"><span class="toc-number">3.2.1.</span> <span class="toc-text">CSS的语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%92%E5%AD%90%E6%A8%A1%E5%9E%8B"><span class="toc-number">3.2.2.</span> <span class="toc-text">盒子模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CSS%E5%B8%83%E5%B1%80"><span class="toc-number">3.2.3.</span> <span class="toc-text">CSS布局</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#javascript"><span class="toc-number">3.3.</span> <span class="toc-text">javascript</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.3.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JavaScript%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.3.2.</span> <span class="toc-text">JavaScript数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%A3%B0%E6%98%8E"><span class="toc-number">3.3.3.</span> <span class="toc-text">函数声明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BC%A0%E6%A0%87%E6%82%AC%E6%B5%AE%E5%92%8C%E7%A6%BB%E5%BC%80"><span class="toc-number">3.3.4.</span> <span class="toc-text">鼠标悬浮和离开</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80"><span class="toc-number">3.3.4.1.</span> <span class="toc-text">方法一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C"><span class="toc-number">3.3.4.2.</span> <span class="toc-text">方法二</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%8D%95%E4%BB%B7-%E5%B0%8F%E8%AE%A1-%E6%80%BB%E8%AE%A1"><span class="toc-number">3.3.4.3.</span> <span class="toc-text">更新单价-小计-总计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%8C%87%E5%AE%9A%E8%A1%8C%E5%92%8C%E6%8E%A7%E5%88%B6%E9%94%AE%E7%9B%98%E7%9A%84%E8%BE%93%E5%85%A5"><span class="toc-number">3.3.4.4.</span> <span class="toc-text">删除指定行和控制键盘的输入</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CS%E5%92%8CBS%E7%9A%84%E5%BC%82%E5%90%8C%E7%82%B9"><span class="toc-number">3.4.</span> <span class="toc-text">CS和BS的异同点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Tomcat"><span class="toc-number">3.5.</span> <span class="toc-text">Tomcat</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Tomcat%E7%9A%84%E9%83%A8%E7%BD%B2%E8%BF%90%E8%A1%8C"><span class="toc-number">3.5.1.</span> <span class="toc-text">Tomcat的部署运行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tomcat%E9%83%A8%E7%BD%B2%E8%BF%90%E8%A1%8C%E5%9C%A8idea"><span class="toc-number">3.5.2.</span> <span class="toc-text">Tomcat部署运行在idea</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Servlet"><span class="toc-number">4.</span> <span class="toc-text">Servlet</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81Servlet%E6%A6%82%E8%BF%B0"><span class="toc-number">4.1.</span> <span class="toc-text">1、Servlet概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Servlet%E5%90%8D%E5%AD%97"><span class="toc-number">4.1.1.</span> <span class="toc-text">1.Servlet名字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Servlet%E5%9C%A8%E6%95%B4%E4%B8%AAWeb%E5%BA%94%E7%94%A8%E4%B8%AD%E8%B5%B7%E5%88%B0%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">4.1.2.</span> <span class="toc-text">2.Servlet在整个Web应用中起到的作用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81Servlet%E5%85%A5%E9%97%A8%E5%AE%9E%E4%BE%8B"><span class="toc-number">4.2.</span> <span class="toc-text">2、Servlet入门实例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E7%BC%96%E7%A0%81%E9%97%AE%E9%A2%98"><span class="toc-number">4.2.1.</span> <span class="toc-text">设置编码问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81Servlet%E7%9A%84%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB%E5%8F%8A%E6%A0%B8%E5%BF%83%E6%96%B9%E6%B3%95"><span class="toc-number">4.3.</span> <span class="toc-text">3、Servlet的继承关系及核心方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Servlet%E7%9A%84%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB"><span class="toc-number">4.3.1.</span> <span class="toc-text">1.Servlet的继承关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-service-%E6%96%B9%E6%B3%95"><span class="toc-number">4.3.2.</span> <span class="toc-text">2.service( )方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%86%85%E9%83%A8%E8%BD%AC%E5%8F%91%E4%BB%A5%E5%8F%8A%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">4.4.</span> <span class="toc-text">7、服务器内部转发以及客户端重定向</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E3%80%81Thymeleaf-%E8%A7%86%E5%9B%BE%E6%A8%A1%E6%9D%BF%E6%8A%80%E6%9C%AF"><span class="toc-number">4.5.</span> <span class="toc-text">8、Thymeleaf - 视图模板技术</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%E3%80%81%E4%BF%9D%E5%AD%98%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">4.6.</span> <span class="toc-text">9、保存作用域</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10%E3%80%81%E8%B7%AF%E5%BE%84%E9%97%AE%E9%A2%98"><span class="toc-number">4.7.</span> <span class="toc-text">10、路径问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B0%B4%E6%9E%9C%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE"><span class="toc-number">5.</span> <span class="toc-text">水果系统项目</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B0%B4%E6%9E%9C%E7%B3%BB%E7%BB%9F"><span class="toc-number">5.1.</span> <span class="toc-text">水果系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%BB%BA%E7%AB%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E8%A1%A8"><span class="toc-number">5.1.1.</span> <span class="toc-text">1.建立数据库和表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BAJavaWbe%E9%A1%B9%E7%9B%AE%E6%A8%A1%E5%9D%97"><span class="toc-number">5.1.2.</span> <span class="toc-text">2.创建JavaWbe项目模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E4%B8%BB%E7%B4%A2%E5%BC%95index%E9%A1%B5%E9%9D%A2"><span class="toc-number">5.1.3.</span> <span class="toc-text">3、主索引index页面</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82"><span class="toc-number">5.1.3.1.</span> <span class="toc-text">需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E7%BC%96%E5%86%99index-html%E9%A1%B5%E9%9D%A2"><span class="toc-number">5.1.3.2.</span> <span class="toc-text">1）编写index.html页面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E7%BC%96%E5%86%99index-css"><span class="toc-number">5.1.3.3.</span> <span class="toc-text">2）编写index.css</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89%E7%BC%96%E5%86%99index-js"><span class="toc-number">5.1.3.4.</span> <span class="toc-text">3）编写index.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%EF%BC%89%E7%BC%96%E5%86%99indexServlet"><span class="toc-number">5.1.3.5.</span> <span class="toc-text">4）编写indexServlet</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E4%B8%80%EF%BC%9ATomcat%E7%83%AD%E9%83%A8%E7%BD%B2"><span class="toc-number">5.1.3.6.</span> <span class="toc-text">问题一：Tomcat热部署</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E6%B7%BB%E5%8A%A0add%E6%93%8D%E4%BD%9C"><span class="toc-number">5.1.4.</span> <span class="toc-text">4、添加add操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E7%BC%96%E5%86%99add-html%E9%A1%B5%E9%9D%A2"><span class="toc-number">5.1.4.1.</span> <span class="toc-text">1）编写add.html页面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E7%BC%96%E5%86%99add-css%E6%A0%B7%E5%BC%8F"><span class="toc-number">5.1.4.2.</span> <span class="toc-text">2）编写add.css样式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89%E7%BC%96%E5%86%99addServlet"><span class="toc-number">5.1.4.3.</span> <span class="toc-text">3）编写addServlet</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E4%B8%80%EF%BC%9A%E5%8F%8D%E5%B0%84%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E5%A4%B1%E8%B4%A5"><span class="toc-number">5.1.5.</span> <span class="toc-text">问题一：反射类型转换失败</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E7%BC%96%E8%BE%91edit%E6%93%8D%E4%BD%9C"><span class="toc-number">5.1.6.</span> <span class="toc-text">5、编辑edit操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E7%BC%96%E5%86%99edit-html%E9%A1%B5%E9%9D%A2"><span class="toc-number">5.1.6.1.</span> <span class="toc-text">1）编写edit.html页面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E7%BC%96%E5%86%99edit-css"><span class="toc-number">5.1.6.2.</span> <span class="toc-text">2）编写edit.css</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89%E7%BC%96%E5%86%99editServlet"><span class="toc-number">5.1.6.3.</span> <span class="toc-text">3）编写editServlet</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E6%9B%B4%E6%96%B0update%E6%93%8D%E4%BD%9C"><span class="toc-number">5.1.7.</span> <span class="toc-text">6、更新update操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81%E5%88%A0%E9%99%A4delete%E6%93%8D%E4%BD%9C"><span class="toc-number">5.1.8.</span> <span class="toc-text">7、删除delete操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%E3%80%81%E6%95%B4%E4%BD%93%E7%9A%84%E7%9B%AE%E5%BD%95%E5%92%8C%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">5.1.9.</span> <span class="toc-text">8、整体的目录和工具类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#BaseDAO"><span class="toc-number">5.1.9.1.</span> <span class="toc-text">BaseDAO</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ViewBaseServlet"><span class="toc-number">5.1.9.2.</span> <span class="toc-text">ViewBaseServlet</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#StringUtil"><span class="toc-number">5.1.9.3.</span> <span class="toc-text">StringUtil</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%E3%80%81%E5%A2%9E%E6%B7%BB%E6%9F%A5%E8%AF%A2%E5%8A%9F%E8%83%BD"><span class="toc-number">5.1.10.</span> <span class="toc-text">9、增添查询功能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B0%B4%E6%9E%9C%E7%B3%BB%E7%BB%9F-%E4%BC%98%E5%8C%961"><span class="toc-number">5.2.</span> <span class="toc-text">水果系统-优化1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E9%A1%B9%E7%9B%AE%E7%AE%80%E5%9B%BE"><span class="toc-number">5.2.1.</span> <span class="toc-text">原始项目简图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%961%E7%AE%80%E5%9B%BE"><span class="toc-number">5.2.2.</span> <span class="toc-text">优化1简图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9html"><span class="toc-number">5.2.3.</span> <span class="toc-text">修改html</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%961-%E7%BC%96%E5%86%99FruitServlet-switch"><span class="toc-number">5.2.4.</span> <span class="toc-text">优化1.编写FruitServlet-switch</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%961-5%E7%BC%96%E5%86%99FruitServlet-%E5%8F%8D%E5%B0%84"><span class="toc-number">5.3.</span> <span class="toc-text">优化1.5编写FruitServlet-反射</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B0%B4%E6%9E%9C%E7%B3%BB%E7%BB%9F-%E4%BC%98%E5%8C%962"><span class="toc-number">5.4.</span> <span class="toc-text">水果系统-优化2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DispatcherServlet%E7%9A%84%E5%BC%95%E5%85%A5"><span class="toc-number">5.4.1.</span> <span class="toc-text">DispatcherServlet的引入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DispatcherServlet"><span class="toc-number">5.4.2.</span> <span class="toc-text">DispatcherServlet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ViewBaseServlet-1"><span class="toc-number">5.4.3.</span> <span class="toc-text">ViewBaseServlet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FruitController"><span class="toc-number">5.4.4.</span> <span class="toc-text">FruitController</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#applicationContext-xml"><span class="toc-number">5.4.5.</span> <span class="toc-text">applicationContext.xml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF%E5%8D%B3%E9%97%AE%E9%A2%98%E7%9A%84%E6%80%BB%E7%BB%93"><span class="toc-number">5.4.6.</span> <span class="toc-text">思路即问题的总结</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">5.4.6.1.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">5.4.6.2.</span> <span class="toc-text">问题</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B0%B4%E6%9E%9C%E7%B3%BB%E7%BB%9F-%E4%BC%98%E5%8C%962-5"><span class="toc-number">5.5.</span> <span class="toc-text">水果系统-优化2.5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DispatcherServlet-1"><span class="toc-number">5.5.1.</span> <span class="toc-text">DispatcherServlet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FruitController-1"><span class="toc-number">5.5.2.</span> <span class="toc-text">FruitController</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ViewBaseServlet-2"><span class="toc-number">5.5.3.</span> <span class="toc-text">ViewBaseServlet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="toc-number">5.5.4.</span> <span class="toc-text">总结：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B0%B4%E6%9E%9C%E7%B3%BB%E7%BB%9F-%E4%BC%98%E5%8C%963"><span class="toc-number">5.6.</span> <span class="toc-text">水果系统-优化3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DispatcherServlet-2"><span class="toc-number">5.6.1.</span> <span class="toc-text">DispatcherServlet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FruitController-2"><span class="toc-number">5.6.2.</span> <span class="toc-text">FruitController</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-number">5.6.3.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%8D%E4%B9%A0%E6%80%BB%E7%BB%93"><span class="toc-number">5.7.</span> <span class="toc-text">复习总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%8D%E6%AC%A1%E5%AD%A6%E4%B9%A0Servlet%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%E6%96%B9%E6%B3%95"><span class="toc-number">6.</span> <span class="toc-text">再次学习Servlet的初始化方法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E5%B1%82"><span class="toc-number">7.</span> <span class="toc-text">业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MVC%E6%A6%82%E5%BF%B5%E8%A7%A3%E9%87%8A"><span class="toc-number">7.1.</span> <span class="toc-text">MVC概念解释</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%BA%E5%88%86%E4%B8%9A%E5%8A%A1%E5%AF%B9%E8%B1%A1%E5%92%8C%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E5%AF%B9%E8%B1%A1"><span class="toc-number">7.2.</span> <span class="toc-text">区分业务对象和数据访问对象</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B0%B4%E6%9E%9C%E5%BA%93%E5%AD%98%E7%B3%BB%E7%BB%9F%E4%B8%AD%E6%B7%BB%E5%8A%A0%E4%B8%9A%E5%8A%A1%E5%B1%82%E7%BB%84%E4%BB%B6-%E4%BC%98%E5%8C%964"><span class="toc-number">8.</span> <span class="toc-text">水果库存系统中添加业务层组件-优化4</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%9B%BE1"><span class="toc-number">8.1.</span> <span class="toc-text">简图1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%9B%BE2"><span class="toc-number">8.2.</span> <span class="toc-text">简图2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#applicationContext"><span class="toc-number">8.3.</span> <span class="toc-text">applicationContext</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ClassPathXmlApplicationContext"><span class="toc-number">8.4.</span> <span class="toc-text">ClassPathXmlApplicationContext</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#IOC"><span class="toc-number">9.</span> <span class="toc-text">IOC</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%80%A6%E5%90%88-x2F-%E4%BE%9D%E8%B5%96"><span class="toc-number">9.1.</span> <span class="toc-text">耦合&#x2F;依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IOC-%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC%EF%BC%9A"><span class="toc-number">9.2.</span> <span class="toc-text">IOC - 控制反转：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DI-%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%EF%BC%9A"><span class="toc-number">9.3.</span> <span class="toc-text">DI - 依赖注入：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8Filter"><span class="toc-number">10.</span> <span class="toc-text">过滤器Filter</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8Filter%E6%A6%82%E8%BF%B0"><span class="toc-number">10.1.</span> <span class="toc-text">过滤器Filter概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8%E9%A1%B9%E7%9B%AE%E7%AE%80%E5%9B%BE"><span class="toc-number">10.2.</span> <span class="toc-text">过滤器项目简图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA"><span class="toc-number">10.3.</span> <span class="toc-text">代码演示</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Filter01"><span class="toc-number">10.3.1.</span> <span class="toc-text">Filter01</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Demo01Servlet"><span class="toc-number">10.3.2.</span> <span class="toc-text">Demo01Servlet</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8%E7%9A%84%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8%E2%80%93%E8%AE%BE%E7%BD%AE%E7%BC%96%E7%A0%81"><span class="toc-number">10.4.</span> <span class="toc-text">过滤器的简单应用–设置编码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E7%A4%BA"><span class="toc-number">10.4.1.</span> <span class="toc-text">图示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CharacterEncodingFilter"><span class="toc-number">10.4.2.</span> <span class="toc-text">CharacterEncodingFilter</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-number">11.</span> <span class="toc-text">事务管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E5%BC%8F%E7%AE%A1%E7%90%86%E4%BA%8B%E5%8A%A1"><span class="toc-number">11.1.</span> <span class="toc-text">编程式管理事务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B0%B4%E6%9E%9C%E7%B3%BB%E7%BB%9F%E5%9C%A8%E4%BC%98%E5%8C%96-5"><span class="toc-number">11.2.</span> <span class="toc-text">水果系统在优化-5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E5%89%8D%E7%BD%AE%E5%88%B0%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">11.2.1.</span> <span class="toc-text">事务管理前置到过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ThreadLocal"><span class="toc-number">11.2.2.</span> <span class="toc-text">ThreadLocal</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#set%E6%96%B9%E6%B3%95%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%9A"><span class="toc-number">11.2.2.1.</span> <span class="toc-text">set方法源码分析：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#get%E6%96%B9%E6%B3%95%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%9A"><span class="toc-number">11.2.2.2.</span> <span class="toc-text">get方法源码分析：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ConnUtil%E2%80%93%E7%BB%9F%E4%B8%80%E8%BF%9E%E6%8E%A5"><span class="toc-number">11.2.3.</span> <span class="toc-text">ConnUtil–统一连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8%E6%97%A0%E6%B3%95%E6%8D%95%E8%8E%B7%E5%BC%82%E5%B8%B8"><span class="toc-number">11.2.4.</span> <span class="toc-text">过滤器无法捕获异常</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TransactionManager"><span class="toc-number">11.2.5.</span> <span class="toc-text">TransactionManager</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenSessionInViewFilter"><span class="toc-number">11.2.6.</span> <span class="toc-text">OpenSessionInViewFilter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-2"><span class="toc-number">11.2.7.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%91%E5%90%AC%E5%99%A8"><span class="toc-number">12.</span> <span class="toc-text">监听器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%91%E5%90%AC%E5%99%A8%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.1.</span> <span class="toc-text">监听器类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%91%E5%90%AC%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">12.2.</span> <span class="toc-text">监听器的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B0%B4%E6%9E%9C%E7%B3%BB%E7%BB%9F%E5%9C%A8%E4%BC%98%E5%8C%96-6"><span class="toc-number">12.3.</span> <span class="toc-text">水果系统在优化-6</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%90%8D%E7%9A%84%E5%B0%81%E8%A3%85"><span class="toc-number">12.3.1.</span> <span class="toc-text">获取配置文件名的封装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#applicationContext-xml-1"><span class="toc-number">12.3.2.</span> <span class="toc-text">applicationContext.xml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%91%E5%90%AC%E5%99%A8%E7%9A%84%E5%8A%A0%E5%85%A5%EF%BC%9AContextLoaderListener"><span class="toc-number">12.3.3.</span> <span class="toc-text">监听器的加入：ContextLoaderListener</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DispatcherServlet%E4%B8%AD%E6%9E%84%E9%80%A0%E5%99%A8"><span class="toc-number">12.3.4.</span> <span class="toc-text">DispatcherServlet中构造器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B0%B4%E6%9E%9C%E7%B3%BB%E7%BB%9F%E6%80%BB%E7%BB%93"><span class="toc-number">13.</span> <span class="toc-text">水果系统总结</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MVC%E5%90%84%E5%B1%82%E7%9A%84%E8%AE%BE%E8%AE%A1"><span class="toc-number">13.1.</span> <span class="toc-text">MVC各层的设计</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#qqZone%E9%A1%B9%E7%9B%AE"><span class="toc-number">14.</span> <span class="toc-text">qqZone项目</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%86%9F%E6%82%89QQZone%E4%B8%9A%E5%8A%A1%E9%9C%80%E6%B1%82"><span class="toc-number">14.1.</span> <span class="toc-text">1.熟悉QQZone业务需求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1"><span class="toc-number">14.2.</span> <span class="toc-text">2.数据库设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%8A%BD%E5%8F%96%E5%AE%9E%E4%BD%93"><span class="toc-number">14.2.1.</span> <span class="toc-text">1.抽取实体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%86%E6%9E%90%E5%85%B6%E4%B8%AD%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">14.2.2.</span> <span class="toc-text">2.分析其中的属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%88%86%E6%9E%90%E5%AE%9E%E4%BD%93%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">14.2.3.</span> <span class="toc-text">3.分析实体之间的关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-QQZone-ER%E5%9B%BE"><span class="toc-number">14.2.4.</span> <span class="toc-text">4.QQZone-ER图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%8C%83%E5%BC%8F"><span class="toc-number">14.2.5.</span> <span class="toc-text">5.数据库的范式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E6%9F%A5%E8%AF%A2%E5%A5%BD%E5%8F%8B%E5%88%97%E8%A1%A8"><span class="toc-number">14.2.6.</span> <span class="toc-text">6.查询好友列表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E9%A1%B9%E7%9B%AE%E5%88%9D%E5%A7%8B%E5%8C%96%E5%B7%A5%E4%BD%9C"><span class="toc-number">14.3.</span> <span class="toc-text">3.项目初始化工作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%8A%9F%E8%83%BD%E4%B8%80%E5%AE%9E%E7%8E%B0"><span class="toc-number">14.4.</span> <span class="toc-text">4.功能一实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E4%B8%80"><span class="toc-number">14.4.1.</span> <span class="toc-text">功能一</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#login-html"><span class="toc-number">14.4.2.</span> <span class="toc-text">login.html</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UserController"><span class="toc-number">14.4.3.</span> <span class="toc-text">UserController</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#index-html"><span class="toc-number">14.4.4.</span> <span class="toc-text">index.html</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#main-html"><span class="toc-number">14.4.5.</span> <span class="toc-text">main.html</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#left-html"><span class="toc-number">14.4.6.</span> <span class="toc-text">left.html</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#top-html"><span class="toc-number">14.4.7.</span> <span class="toc-text">top.html</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%8A%9F%E8%83%BD%E4%B8%80%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">14.4.8.</span> <span class="toc-text">实现功能一的问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%8A%9F%E8%83%BD%E4%BA%8C%E5%AE%9E%E7%8E%B0"><span class="toc-number">14.5.</span> <span class="toc-text">5.功能二实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E4%BA%8C"><span class="toc-number">14.5.1.</span> <span class="toc-text">功能二</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#main-html-1"><span class="toc-number">14.5.2.</span> <span class="toc-text">main.html</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TopicController"><span class="toc-number">14.5.3.</span> <span class="toc-text">TopicController</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E6%96%B9%E6%B3%95%EF%BC%9A%E8%8E%B7%E5%8F%96%E5%9B%9E%E5%A4%8D%E5%88%97%E8%A1%A8"><span class="toc-number">14.5.4.</span> <span class="toc-text">关键方法：获取回复列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#detail-html"><span class="toc-number">14.5.5.</span> <span class="toc-text">detail.html</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%8A%9F%E8%83%BD%E4%B8%89%E5%AE%9E%E7%8E%B0"><span class="toc-number">14.6.</span> <span class="toc-text">6.功能三实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E4%B8%89"><span class="toc-number">14.6.1.</span> <span class="toc-text">功能三</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#detail-html%E2%80%93%E6%B7%BB%E5%8A%A0%E5%9B%9E%E5%A4%8D"><span class="toc-number">14.6.2.</span> <span class="toc-text">detail.html–添加回复</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ReplyController"><span class="toc-number">14.6.3.</span> <span class="toc-text">ReplyController</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#detail-html%E2%80%93%E5%88%A0%E9%99%A4%E5%9B%9E%E5%A4%8D"><span class="toc-number">14.6.4.</span> <span class="toc-text">detail.html–删除回复</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ReplyController-1"><span class="toc-number">14.6.5.</span> <span class="toc-text">ReplyController</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ReplyServiceImpl"><span class="toc-number">14.6.6.</span> <span class="toc-text">ReplyServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E5%9B%9B%E5%AE%9E%E7%8E%B0"><span class="toc-number">14.7.</span> <span class="toc-text">功能四实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E5%9B%9B"><span class="toc-number">14.7.1.</span> <span class="toc-text">功能四</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#main-html-2"><span class="toc-number">14.7.2.</span> <span class="toc-text">main.html</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TopicController-1"><span class="toc-number">14.7.3.</span> <span class="toc-text">TopicController</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TopicServiceImpl"><span class="toc-number">14.7.4.</span> <span class="toc-text">TopicServiceImpl</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ReplyServiceImpl-1"><span class="toc-number">14.7.5.</span> <span class="toc-text">ReplyServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%8D%E4%B9%A0%E6%80%BB%E7%BB%93-1"><span class="toc-number">14.8.</span> <span class="toc-text">复习总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%97%A5%E6%9C%9F%E5%92%8C%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B9%8B%E9%97%B4%E7%9A%84%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-number">14.8.1.</span> <span class="toc-text">1.日期和字符串之间的格式化</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Qinghai2021</div><div class="author-info__description">阳光宅男💛</div></div><div class="card-info-social-icons is-center"><a class="social-icon" href="//github.com/Qinghai2021?tab=repositories" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:xxxxxx@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">来的都是大哥！</div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/10/05/Java%E9%AB%98%E7%BA%A7-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-%E5%8F%8D%E5%B0%84-8%E6%96%B0%E7%89%B9%E6%80%A7/" title="Java网络编程-反射-8新特性">Java网络编程-反射-8新特性</a><time datetime="2022-10-04T16:00:00.000Z" title="发表于 2022-10-05 00:00:00">2022-10-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/10/04/Java%E9%AB%98%E7%BA%A7-%E9%9B%86%E5%90%88-%E6%B3%9B%E5%9E%8B-IO%E6%B5%81/" title="Java集合-泛型-IO流">Java集合-泛型-IO流</a><time datetime="2022-10-03T16:00:00.000Z" title="发表于 2022-10-04 00:00:00">2022-10-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/10/03/Java%E9%AB%98%E7%BA%A7-%E5%A4%9A%E7%BA%BF%E7%A8%8B-%E5%B8%B8%E7%94%A8%E7%B1%BB-%E6%9E%9A%E4%B8%BE%E7%B1%BB%E4%B8%8E%E6%B3%A8%E8%A7%A3/" title="Java多线程-常用类-枚举类与注解">Java多线程-常用类-枚举类与注解</a><time datetime="2022-10-02T16:00:00.000Z" title="发表于 2022-10-03 00:00:00">2022-10-03</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/10/02/%E5%B0%9A%E7%A1%85%E8%B0%B7java%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/" title="Java编程基础">Java编程基础</a><time datetime="2022-10-01T16:00:00.000Z" title="发表于 2022-10-02 00:00:00">2022-10-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/09/30/JavaWeb/" title="JavaWeb笔记">JavaWeb笔记</a><time datetime="2022-09-29T16:00:00.000Z" title="发表于 2022-09-30 00:00:00">2022-09-30</time></div></div></div></div></div></div></main><footer id="footer" style="background: #FFFFFF"><div id="footer-wrap"><div class="copyright">&copy;2022 By Qinghai2021</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/chenxz21/hexo-theme-bcxm">Bcxm</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://fastly.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><div class="js-pjax"></div><script type="text/javascript" src="https://fastly.jsdelivr.net/npm/leancloud-storage@4.10.0/dist/av-min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://fastly.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script id="click-heart" src="https://fastly.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>